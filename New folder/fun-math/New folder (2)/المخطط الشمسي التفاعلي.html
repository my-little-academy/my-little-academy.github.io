<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مخطط شمسي ثلاثي الأبعاد</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        #container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            text-align: right;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border-right: 5px solid #4bc0c0;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        p {
            color: #555;
            line-height: 1.6;
        }
        .percentage {
            font-weight: bold;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info">
        <h2>المخطط الشمسي التفاعلي</h2>
        <div id="card-container">
            <p>حرك مؤشر الفأرة فوق القطاعات لعرض التفاصيل</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.11.4/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <script>
        // تهيئة المشهد
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        // إعداد الكاميرا
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        // إعداد العارض (Renderer)
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('container').appendChild(renderer.domElement);

        // إضافة التحكم بالمشهد
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 3;
        controls.maxDistance = 10;

        // إضافة إضاءة
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight2.position.set(-1, -1, -1);
        scene.add(directionalLight2);

        // بيانات المخطط الشمسي
        const data = [
            { value: 25, color: 0xff6384, label: "التعليم", info: "برامج تعليمية وتدريبية للمدارس والجامعات مع توفير منح دراسية للطلاب المتفوقين." },
            { value: 20, color: 0x36a2eb, label: "الصحة", info: "تطوير المستشفيات ومراكز الرعاية الصحية الأولية وتوفير الأدوية الأساسية مجانًا." },
            { value: 15, color: 0xffce56, label: "البنية التحتية", info: "إنشاء طرق جديدة وصيانة الجسور وتطوير شبكات المياه والكهرباء في المناطق النائية." },
            { value: 10, color: 0x4bc0c0, label: "الزراعة", info: "دعم المزارعين الصغار وتوفير التقنيات الحديثة لزيادة الإنتاجية وتحسين جودة المحاصيل." },
            { value: 30, color: 0x9966ff, label: "التكنولوجيا", info: "استثمارات في البحث العلمي وتطوير البنية التحتية الرقمية وريادة الأعمال التكنولوجية." }
        ];

        // إنشاء المخطط الشمسي ثلاثي الأبعاد
        const create3DPieChart = () => {
            const group = new THREE.Group();
            let startAngle = 0;
            const total = data.reduce((sum, item) => sum + item.value, 0);
            const radius = 2;
            const height = 0.5;
            const bevelSize = 0.1;
            
            data.forEach((item, index) => {
                const angle = (item.value / total) * Math.PI * 2;
                const endAngle = startAngle + angle;
                const midAngle = startAngle + angle / 2;
                
                // إنشاء الشكل الهندسي للقطاع
                const shape = new THREE.Shape();
                shape.moveTo(0, 0);
                shape.lineTo(radius * Math.cos(startAngle), radius * Math.sin(startAngle));
                
                for (let theta = startAngle; theta <= endAngle; theta += 0.05) {
                    shape.lineTo(radius * Math.cos(theta), radius * Math.sin(theta));
                }
                
                shape.lineTo(radius * Math.cos(endAngle), radius * Math.sin(endAngle));
                shape.lineTo(0, 0);
                
                // إضافة العمق ثلاثي الأبعاد مع حافة مائلة
                const extrudeSettings = {
                    depth: height,
                    bevelEnabled: true,
                    bevelThickness: bevelSize,
                    bevelSize: bevelSize,
                    bevelSegments: 3
                };
                
                const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
                
                const material = new THREE.MeshPhongMaterial({
                    color: item.color,
                    specular: 0x111111,
                    shininess: 50,
                    transparent: true,
                    opacity: 0.95
                });
                
                const mesh = new THREE.Mesh(geometry, material);
                mesh.userData = item; // حفظ البيانات للتفاعل
                
                // إضافة نص للقطاع
                const labelRadius = radius * 0.7;
                const labelPos = new THREE.Vector3(
                    labelRadius * Math.cos(midAngle),
                    labelRadius * Math.sin(midAngle),
                    height + 0.1
                );
                
                // إعداد تأثيرات التفاعل
                mesh.originalPosition = new THREE.Vector3();
                mesh.originalRotation = new THREE.Euler();
                
                mesh.onHover = () => {
                    gsap.to(mesh.position, {
                        z: 0.3,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                    gsap.to(mesh.scale, {
                        x: 1.1,
                        y: 1.1,
                        z: 1.1,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                    gsap.to(mesh.rotation, {
                        x: -0.1,
                        y: 0.1,
                        duration: 0.5,
                        ease: "elastic.out(1, 0.5)"
                    });
                };
                
                mesh.onHoverOut = () => {
                    gsap.to(mesh.position, {
                        z: 0,
                        duration: 0.5,
                        ease: "bounce.out"
                    });
                    gsap.to(mesh.scale, {
                        x: 1,
                        y: 1,
                        z: 1,
                        duration: 0.5,
                        ease: "bounce.out"
                    });
                    gsap.to(mesh.rotation, {
                        x: 0,
                        y: 0,
                        duration: 0.7,
                        ease: "elastic.out(1, 0.3)"
                    });
                };
                
                group.add(mesh);
                startAngle = endAngle;
            });
            
            return group;
        };

        const pieChart = create3DPieChart();
        scene.add(pieChart);

        // إضافة تفاعل مع المخطط
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let intersectedObject = null;

        function onMouseMove(event) {
            // حساب موضع المؤشر
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            
            // تحديث Raycaster
            raycaster.setFromCamera(mouse, camera);
            
            // حساب التقاطعات
            const intersects = raycaster.intersectObjects(pieChart.children);
            
            if (intersects.length > 0) {
                if (intersectedObject !== intersects[0].object) {
                    if (intersectedObject) intersectedObject.onHoverOut();
                    
                    intersectedObject = intersects[0].object;
                    intersectedObject.onHover();
                    
                    // عرض بطاقة المعلومات
                    showInfoCard(intersectedObject.userData);
                }
            } else {
                if (intersectedObject) {
                    intersectedObject.onHoverOut();
                    intersectedObject = null;
                    hideInfoCard();
                }
            }
        }

        function showInfoCard(data) {
            const cardContainer = document.getElementById('card-container');
            cardContainer.innerHTML = `
                <div class="card">
                    <h3>${data.label}</h3>
                    <p>النسبة: <span class="percentage">${data.value}%</span> من الميزانية</p>
                    <p>${data.info}</p>
                </div>
            `;
        }

        function hideInfoCard() {
            document.getElementById('card-container').innerHTML = 
                '<p>حرك مؤشر الفأرة فوق القطاعات لعرض التفاصيل</p>';
        }

        window.addEventListener('mousemove', onMouseMove, false);
        window.addEventListener('click', (event) => {
            if (intersectedObject) {
                // تأثير النقر
                gsap.to(intersectedObject.scale, {
                    x: 0.9,
                    y: 0.9,
                    z: 0.9,
                    duration: 0.1,
                    yoyo: true,
                    repeat: 1
                });
            }
        });

        // جعل المشهد متجاوبًا مع تغير حجم النافذة
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // تدوير المخطط تلقائياً ببطء
        function autoRotate() {
            pieChart.rotation.y += 0.001;
        }

        // دورة التصيير (الرندر)
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            autoRotate();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>