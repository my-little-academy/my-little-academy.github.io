<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة تمثيل الأعداد - نسخة مبسطة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* General Styling */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 10px;
            direction: rtl; /* Right-to-left for Arabic */
            text-align: right;
            line-height: 1.6;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            box-sizing: border-box;
            overflow-x: hidden; /* Prevent horizontal scroll from falling flowers */
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 2em;
        }

        p {
            font-size: 1em;
            color: #555;
            max-width: 800px;
            margin: 0 auto;
        }

        main {
            flex-grow: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
        }

        /* Grid Layout for Clickable Items (Horizontal) */
        .grid-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #fcfcfc;
            flex-wrap: wrap;
        }

        .grid-cell {
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            width: 180px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .grid-cell:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .grid-cell h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        /* Clickable Items Styles */
        .clickable-item {
            cursor: pointer;
            border-radius: 4px;
            display: grid; /* Use grid for internal structure */
            position: relative;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s ease-out, opacity 0.2s;
            border: 0.5px solid rgba(0, 0, 0, 0.1);
        }

        .clickable-item:active {
            transform: scale(1.03);
        }
        .clickable-item:hover {
            opacity: 0.9;
        }

        /* Individual square for inner grid */
        .inner-square {
            width: 8px; /* Base unit size */
            height: 8px; /* Base unit size */
            box-sizing: border-box; /* Include padding/border in size */
            border: 0.25px solid rgba(255, 255, 255, 0.3); /* Subtle internal borders */
        }

        /* Unit: 8x8px Red Square */
        .unit {
            width: 8px;
            height: 8px;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr;
        }
        .unit .inner-square {
            background-color: #e74c3c; /* Red */
        }

        /* Ten: Column of 10 small squares, Orange */
        .ten {
            width: 8px; /* 1 column of 8px */
            height: 80px; /* 10 * 8px */
            grid-template-columns: 1fr;
            grid-template-rows: repeat(10, 1fr);
        }
        .ten .inner-square {
            background-color: #e67e22; /* Orange */
        }

        /* Hundred: 10x10 Grid of small squares, Blue */
        .hundred {
            width: 80px; /* 10 * 8px */
            height: 80px; /* 10 * 8px */
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
        }
        .hundred .inner-square {
            background-color: #3498db; /* Blue */
        }

        /* Thousand: 20x20 Grid of small squares, Green */
        .thousand {
            width: 160px; /* 20 * 8px */
            height: 160px; /* 20 * 8px */
            grid-template-columns: repeat(20, 1fr);
            grid-template-rows: repeat(20, 1fr);
        }
        .thousand .inner-square {
            background-color: #2ecc71; /* Green */
        }


        /* Drop Zone - Now 'Number Building Area' */
        .drop-zone {
            background-color: #ecf0f1;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            min-height: 180px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: flex-start;
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            position: relative;
            flex-grow: 1;
        }

        .drop-zone h3 {
            width: 100%;
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        /* Empty message in drop zone */
        .drop-zone .empty-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #aaa;
            font-size: 1.1em;
            pointer-events: none;
            text-align: center;
            width: 90%;
        }

        /* Style for copied items in drop zone */
        .drop-zone .copied-item {
            cursor: default;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
            opacity: 0.95;
            transition: opacity 0.2s ease-in-out;
            margin: 5px;
            flex-shrink: 0;
            display: grid; /* Maintain grid display for copied items */
            border: 0.5px solid rgba(0, 0, 0, 0.1); /* Subtle border for all shapes */
        }
        .drop-zone .unit.copied-item { width: 8px; height: 8px; grid-template-columns: 1fr; grid-template-rows: 1fr; }
        .drop-zone .ten.copied-item { width: 8px; height: 80px; grid-template-columns: 1fr; grid-template-rows: repeat(10, 1fr); }
        .drop-zone .hundred.copied-item { width: 80px; height: 80px; grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); }
        .drop-zone .thousand.copied-item { width: 160px; height: 160px; grid-template-columns: repeat(20, 1fr); grid-template-rows: repeat(20, 1fr); }


        /* Delete button on copied items */
        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #f00;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;

            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none;
            z-index: 10;
        }

        .drop-zone .copied-item:hover .delete-btn {
            opacity: 1;
            pointer-events: all;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .action-buttons button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        #check-answer-button {
            background-color: #3498db;
            color: #fff;
        }

        #check-answer-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        #reset-button {
            background-color: #e74c3c;
            color: #fff;
        }

        #reset-button:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        #undo-button {
            background-color: #f39c12;
            color: #fff;
        }
        #undo-button:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }


        /* Feedback Message */
        #feedback-message {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 25px;
        }
        .feedback-success {
            color: #27ae60;
        }
        .feedback-error {
            color: #c0392b;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header {
                margin-bottom: 15px;
            }
            h1 {
                font-size: 1.6em;
            }
            p {
                font-size: 0.9em;
            }
            main {
                padding: 10px;
                gap: 15px;
            }
            .grid-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            .grid-cell {
                width: 90%;
                min-height: 120px;
                padding: 10px;
            }
            .drop-zone {
                min-height: 150px;
                padding: 10px;
            }
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .action-buttons button {
                width: 100%;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.4em;
            }
            p {
                font-size: 0.85em;
            }
            .grid-cell h2 {
                font-size: 1.1em;
            }
        }

        /* --- Flower Animation CSS --- */
        .flower {
            position: fixed;
            top: -20px; /* Start above the screen */
            width: 15px;
            height: 15px;
            background-color: #ffb6c1; /* Light pink */
            border-radius: 50%;
            opacity: 0;
            pointer-events: none; /* Make them unclickable */
            box-shadow: 0 0 5px rgba(255, 182, 193, 0.7);
            animation: fall linear forwards; /* Apply falling animation */
            z-index: 1000; /* Ensure they are on top */
        }

        .flower:nth-child(2n) {
            background-color: #add8e6; /* Light blue */
            box-shadow: 0 0 5px rgba(173, 216, 230, 0.7);
        }

        .flower:nth-child(3n) {
            background-color: #98fb98; /* Pale green */
            box-shadow: 0 0 5px rgba(152, 251, 152, 0.7);
        }

        .flower:nth-child(4n) {
            background-color: #ffe4b5; /* Moccasin */
            box-shadow: 0 0 5px rgba(255, 228, 181, 0.7);
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg); /* Fall to bottom, rotate */
                opacity: 0;
            }
        }
        /* --- End Flower Animation CSS --- */
    </style>
</head>
<body>
    <header>
        <h1>لعبة تمثيل الأعداد - نسخة مبسطة</h1>
        <p>مرحباً بك في لعبة تمثيل الأعداد! اضغط على الأشكال (الوحدات، العشرات، المئات، الآلاف) لإضافتها إلى منطقة "تركيب الأعداد". حاول تمثيل العدد المطلوب. بعد الانتهاء، اضغط على زر "التحقق من الإجابة". يمكنك حذف شكل واحد بالنقر على "X" أو التراجع عن آخر إضافة بزر "تراجع"، أو مسح كل الأشكال بزر "مسح الكل".</p>
    </header>

    <main>
        <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="color: #27ae60;">العدد المطلوب تمثيله: <span id="target-number">0</span></h2>
            <button id="generate-number-button" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin-top: 10px;">توليد عدد جديد</button>
        </div>

        <div class="grid-container">
            <div class="grid-cell" id="units-cell">
                <h2>الوحدات</h2>
                <div class="clickable-item unit" data-value="1" data-type="unit">
                    <div class="inner-square"></div>
                </div>
            </div>
            <div class="grid-cell" id="tens-cell">
                <h2>العشرات</h2>
                <div class="clickable-item ten" data-value="10" data-type="ten">
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                </div>
            </div>
            <div class="grid-cell" id="hundreds-cell">
                <h2>المئات</h2>
                <div class="clickable-item hundred" data-value="100" data-type="hundred">
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                    <div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div><div class="inner-square"></div>
                </div>
            </div>
            <div class="grid-cell" id="thousands-cell">
                <h2>الآلاف</h2>
                <div class="clickable-item thousand" data-value="1000" data-type="thousand">
                    </div>
            </div>
        </div>

        <div class="drop-zone" id="drop-zone">
            <h3>منطقة تركيب الأعداد</h3>
            <div class="empty-message" id="empty-message">قم بإضافة الأشكال هنا...</div>
        </div>

        <div class="action-buttons">
            <button id="check-answer-button">التحقق من الإجابة</button>
            <button id="undo-button">تراجع</button>
            <button id="reset-button">مسح كل الأشكال</button>
        </div>

        <div id="feedback-message"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const clickableItems = document.querySelectorAll('.clickable-item');
            const dropZone = document.getElementById('drop-zone');
            const resetButton = document.getElementById('reset-button');
            const undoButton = document.getElementById('undo-button');
            const checkAnswerButton = document.getElementById('check-answer-button');
            const emptyMessage = document.getElementById('empty-message');
            const feedbackMessage = document.getElementById('feedback-message');
            const targetNumberSpan = document.getElementById('target-number');
            const generateNumberButton = document.getElementById('generate-number-button');

            let targetNumber = 0;
            let lastAddedItem = null;

            // Function to update empty message visibility
            const updateEmptyMessage = () => {
                if (dropZone.querySelectorAll('.copied-item').length === 0) {
                    emptyMessage.style.display = 'block';
                    undoButton.disabled = true;
                } else {
                    emptyMessage.style.display = 'none';
                    undoButton.disabled = false;
                }
            };

            // Generate a new random target number
            const generateTargetNumber = () => {
                targetNumber = Math.floor(Math.random() * 9999) + 1; // Number between 1 and 9999
                targetNumberSpan.textContent = targetNumber;
                feedbackMessage.textContent = '';
                resetDropZone();
            };

            // Reset drop zone and update message
            const resetDropZone = () => {
                dropZone.querySelectorAll('.copied-item').forEach(item => item.remove());
                updateEmptyMessage();
                feedbackMessage.textContent = '';
                lastAddedItem = null;
            };

            // Dynamic population of inner squares for Thousand
            const populateDynamicSquares = () => {
                const thousandDiv = document.querySelector('.thousand');
                if (thousandDiv && thousandDiv.children.length === 0) {
                    for (let i = 0; i < 400; i++) { // 20x20 = 400
                        const square = document.createElement('div');
                        square.className = 'inner-square';
                        thousandDiv.appendChild(square);
                    }
                }
            };
            populateDynamicSquares(); // Call on load to ensure these are present

            // Initial call to set message visibility and generate initial target
            updateEmptyMessage();
            generateTargetNumber();

            // Event listener for generating a new number
            generateNumberButton.addEventListener('click', generateTargetNumber);

            // Add item directly on click
            clickableItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    const originalItem = e.target.closest('.clickable-item');
                    if (!originalItem) return;

                    const clonedItem = originalItem.cloneNode(true); // Clone with all children
                    clonedItem.classList.remove('clickable-item');
                    clonedItem.classList.add('copied-item');

                    // Add delete button to the cloned item
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'X';
                    deleteBtn.title = 'حذف هذا الشكل';
                    deleteBtn.addEventListener('click', () => {
                        clonedItem.remove();
                        if (lastAddedItem === clonedItem) {
                            // Find the new last added item by looking at the last child of dropZone
                            const allCopiedItems = dropZone.querySelectorAll('.copied-item');
                            lastAddedItem = allCopiedItems.length > 0 ? allCopiedItems[allCopiedItems.length - 1] : null;
                        }
                        updateEmptyMessage();
                        feedbackMessage.textContent = '';
                    });
                    clonedItem.appendChild(deleteBtn);

                    // Show/hide delete button on hover
                    clonedItem.addEventListener('mouseenter', () => {
                        deleteBtn.style.opacity = '1';
                        deleteBtn.style.pointerEvents = 'all';
                    });
                    clonedItem.addEventListener('mouseleave', () => {
                        deleteBtn.style.opacity = '0';
                        deleteBtn.style.pointerEvents = 'none';
                    });

                    dropZone.appendChild(clonedItem);
                    lastAddedItem = clonedItem;
                    updateEmptyMessage();
                    feedbackMessage.textContent = '';
                });
            });

            // Undo button click
            undoButton.addEventListener('click', () => {
                if (lastAddedItem && dropZone.contains(lastAddedItem)) {
                    lastAddedItem.remove();
                    // Find the new last added item
                    const allCopiedItems = dropZone.querySelectorAll('.copied-item');
                    if (allCopiedItems.length > 0) {
                        lastAddedItem = allCopiedItems[allCopiedItems.length - 1];
                    } else {
                        lastAddedItem = null;
                    }
                    updateEmptyMessage();
                    feedbackMessage.textContent = '';
                }
            });

            // --- Flower animation logic ---
            function createFlower() {
                const flower = document.createElement('div');
                flower.className = 'flower';
                // Randomize starting position
                flower.style.left = `${Math.random() * 100}vw`;
                // Randomize animation duration
                flower.style.animationDuration = `${Math.random() * 3 + 2}s`; // 2 to 5 seconds
                // Randomize initial delay for staggered fall
                flower.style.animationDelay = `${Math.random() * 0.5}s`; // 0 to 0.5 seconds
                document.body.appendChild(flower);

                // Remove flower after animation ends
                flower.addEventListener('animationend', () => {
                    flower.remove();
                });
            }

            function triggerFlowers(count = 50) { // Default 50 flowers
                for (let i = 0; i < count; i++) {
                    setTimeout(createFlower, i * 50); // Stagger creation every 50ms
                }
            }
            // --- End Flower animation logic ---


            // Check Answer Button
            checkAnswerButton.addEventListener('click', () => {
                let calculatedSum = 0;
                dropZone.querySelectorAll('.copied-item').forEach(item => {
                    const value = parseInt(item.dataset.value);
                    if (!isNaN(value)) {
                        calculatedSum += value;
                    }
                });

                if (calculatedSum === targetNumber) {
                    feedbackMessage.textContent = `أحسنت! العدد ${targetNumber} تم تمثيله بشكل صحيح.`;
                    feedbackMessage.className = 'feedback-success';
                    triggerFlowers(); // Trigger the flower animation!
                } else {
                    feedbackMessage.textContent = `للأسف، إجابتك غير صحيحة. العدد الذي مثلته هو ${calculatedSum} بينما المطلوب هو ${targetNumber}.`;
                    feedbackMessage.className = 'feedback-error';
                }
            });

            // Prevent text selection on the whole body
            document.body.onselectstart = function() { return false; };
            document.body.ondragstart = function() { return false; };
        });
    </script>
</body>
</html>>
