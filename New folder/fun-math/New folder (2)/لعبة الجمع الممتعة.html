<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù…ØªØ¹Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- Ø£ÙƒÙˆØ§Ø¯ CSS Ù‡Ù†Ø§ --- */
        body {
            font-family: 'Cairo', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(to right, #87CEEB, #ADD8E6); /* Ø£Ù„ÙˆØ§Ù† Ø³Ù…Ø§ÙˆÙŠØ© ÙØ§ØªØ­Ø© */
            color: #333;
            direction: rtl; /* Ù„Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± */
            text-align: right;
        }

        .game-container {
            background-color: #FFFACD; /* Ù„ÙˆÙ† Ø¨ÙŠØ¬ ÙØ§ØªØ­ Ø¬Ø°Ø§Ø¨ */
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 600px;
            width: 90%;
            margin: 20px;
        }

        h1 {
            color: #FF69B4; /* ÙˆØ±Ø¯ÙŠ Ø²Ø§Ù‡ÙŠ */
            font-size: 2.5em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #4CAF50; /* Ø£Ø®Ø¶Ø± Ù…Ø¨Ù‡Ø¬ */
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .level-selection button,
        .action-button {
            background-color: #FFD700; /* Ø°Ù‡Ø¨ÙŠ Ù„Ø§Ù…Ø¹ */
            color: #8B4513; /* Ø¨Ù†ÙŠ ØºØ§Ù…Ù‚ Ø¬Ø°Ø§Ø¨ */
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .level-selection button:hover,
        .action-button:hover {
            background-color: #FFC107; /* Ø°Ù‡Ø¨ÙŠ Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
            transform: translateY(-3px);
        }

        .level-button {
            min-width: 180px; /* Ù„Ø¶Ù…Ø§Ù† Ø­Ø¬Ù… Ù…ØªÙ†Ø§Ø³Ù‚ Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
        }

        .game-area {
            margin-top: 30px;
            border: 3px dashed #FFA07A; /* Ø®Ø·ÙˆØ· Ù…ØªÙ‚Ø·Ø¹Ø© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© Ø¬Ø°Ø§Ø¨Ø© */
            padding: 20px;
            border-radius: 15px;
            background-color: #FFEBCD; /* Ù„ÙˆÙ† Ø®ÙˆØ®ÙŠ ÙØ§ØªØ­ */
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            font-size: 1.4em;
            color: #4682B4; /* Ø£Ø²Ø±Ù‚ ÙÙˆÙ„Ø§Ø°ÙŠ */
            margin-bottom: 20px;
            background-color: #E0FFFF; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .problem-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 3em;
            font-weight: bold;
            color: #8A2BE2; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ø£Ø²Ø±Ù‚ Ø¬Ø°Ø§Ø¨ */
            margin-bottom: 20px;
            position: relative; /* Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ + */
        }

        .problem-display .number {
            margin: -10px 0; /* Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø¨Ø¹Ø¶Ù‡Ø§ */
            min-width: 150px; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ ÙƒØ§ÙÙ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            text-align: center;
        }

        .problem-display .operator {
            position: absolute;
            left: 20px; /* Ø¶Ø¹ + Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… + */
        }

        hr {
            border: 2px solid #D2691E; /* Ø®Ø· Ø¨Ù†ÙŠ Ø¯Ø§ÙƒÙ† */
            width: 80%;
            margin: 15px 0;
        }

        .answer-input-container {
            display: flex;
            justify-content: center; /* Ù„ØªÙˆØ³ÙŠØ· Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© */
            margin-top: 15px;
        }

        .answer-input {
            width: 60px;
            height: 60px;
            font-size: 2em;
            text-align: center;
            margin: 0 5px;
            border: 3px solid #6A5ACD; /* Ù„ÙˆÙ† Ø¨Ù†ÙØ³Ø¬ÙŠ Ù…Ø²Ø±Ù‚ */
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
            color: #333;
        }

        .answer-input:focus {
            border-color: #FF4500; /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù…Ø­Ù…Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        }

        .feedback {
            margin-top: 20px;
            font-size: 1.5em;
            font-weight: bold;
            min-height: 40px; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„ØªØ®Ø·ÙŠØ· */
        }

        .feedback.correct {
            color: #32CD32; /* Ø£Ø®Ø¶Ø± Ù„ÙŠÙ…ÙˆÙ†ÙŠ */
        }

        .feedback.incorrect {
            color: #FF0000; /* Ø£Ø­Ù…Ø± Ù†Ø§Ø±ÙŠ */
        }

        .explanation-area {
            background-color: #F0F8FF; /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
            border: 2px solid #6495ED; /* Ø£Ø²Ø±Ù‚ ÙƒÙˆØ±Ù† ÙÙ„Ø§ÙˆØ± */
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: right;
        }

        .explanation-area h3 {
            color: #483D8B; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¯Ø§ÙƒÙ† */
            margin-bottom: 10px;
        }

        .explanation-area p {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
        }

        .help-section {
            margin-top: 30px;
            width: 100%;
        }

        .help-button {
            background-color: #9370DB; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ù…ØªÙˆØ³Ø· */
            color: white;
            font-size: 1.2em;
        }

        .help-content {
            background-color: #F8F8FF; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
            border: 2px solid #B0C4DE; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            text-align: right;
        }

        .help-content h3 {
            color: #6A5ACD; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ø£Ø²Ø±Ù‚ */
            margin-bottom: 15px;
        }

        .help-content p {
            font-size: 1.1em;
            line-height: 1.6;
            color: #444;
            margin-bottom: 10px;
        }

        .help-content pre {
            background-color: #E6E6FA; /* Ø¨Ù†ÙØ³Ø¬ÙŠ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
            font-size: 0.9em;
            text-align: left; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯ */
            direction: ltr; /* Ù„ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙƒÙˆØ¯ */
        }

        .help-content ol {
            padding-right: 25px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„ØªØ±Ù‚ÙŠÙ… */
            color: #555;
        }

        .help-content ol li {
            margin-bottom: 8px;
        }

        /* For smaller screens */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            .level-selection button {
                font-size: 1em;
                padding: 12px 20px;
                margin: 8px;
            }
            .problem-display {
                font-size: 2.5em;
            }
            .answer-input {
                width: 50px;
                height: 50px;
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù…ØªØ¹Ø©</h1>

        <div class="level-selection">
            <h2>Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</h2>
            <button id="easyBtn" class="level-button">Ù…Ø¨ØªØ¯Ø¦ (Ø¬Ù…Ø¹ Ø¨Ø¯ÙˆÙ† Ø§Ø­ØªÙØ§Ø¸)</button>
            <button id="mediumBtn" class="level-button">Ù…ØªÙˆØ³Ø· (Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³ÙŠØ·)</button>
            <button id="hardBtn" class="level-button">Ù…ØªÙ‚Ø¯Ù… (Ø§Ø­ØªÙØ§Ø¸ Ù…ØªØ¹Ø¯Ø¯)</button>
        </div>

        <div class="game-area" style="display: none;">
            <div class="score-board">
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
                <span>Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="stars">0</span> â­</span>
            </div>

            <div class="problem-display">
                <p class="number" id="num1"></p>
                <p class="operator">+</p>
                <p class="number" id="num2"></p>
                <hr>
                <div class="answer-input-container">
                    </div>
                <button id="checkAnswerBtn" class="action-button">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
                <button id="nextProblemBtn" class="action-button" style="display: none;">Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
            </div>

            <div class="feedback" id="feedback"></div>
            <button id="showExplanationBtn" class="action-button" style="display: none;">Ø´Ø±Ø­ Ø§Ù„Ø­Ù„</button>

            <div class="explanation-area" id="explanationArea" style="display: none;">
                <h3>Ø´Ø±Ø­ Ø§Ù„Ø­Ù„:</h3>
                <div id="explanationContent"></div>
            </div>
        </div>

        <div class="help-section" id="helpSection">
            <button id="showHelpBtn" class="action-button help-button">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            <div class="help-content" style="display: none;">
                <h3>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©: ÙÙ‡Ù… Ø§Ù„Ø¬Ù…Ø¹ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸</h3>
                <p>Ø§Ù„Ø¬Ù…Ø¹ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ù‚Ø¯ ÙŠØ¨Ø¯Ùˆ ØµØ¹Ø¨Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ù„ÙƒÙ†Ù‡ ÙÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø³Ù‡Ù„ Ø¬Ø¯Ù‹Ø§ ÙˆÙ…Ù…ØªØ¹!</p>
                <p>ØªØ®ÙŠÙ„ Ø£Ù† Ù„Ø¯ÙŠÙƒ 7 Ø£Ù‚Ù„Ø§Ù… ÙˆØªØ¶ÙŠÙ Ø¥Ù„ÙŠÙ‡Ø§ 5 Ø£Ù‚Ù„Ø§Ù… Ø£Ø®Ø±Ù‰. Ø¥Ø°Ø§ Ø¬Ù…Ø¹ØªÙ‡Ø§ Ù…Ø¹Ù‹Ø§ØŒ Ø³ÙŠØµØ¨Ø­ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ 12 Ù‚Ù„Ù…Ù‹Ø§.</p>
                <p>Ø¹Ù†Ø¯Ù…Ø§ Ù†ÙƒØªØ¨ 12ØŒ ÙØ¥Ù† Ø§Ù„Ø±Ù‚Ù… 2 ÙŠÙƒÙˆÙ† ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯ (ÙŠÙ…Ø«Ù„ Ù‚Ù„Ù…ÙŠÙ’Ù†)ØŒ ÙˆØ§Ù„Ø±Ù‚Ù… 1 ÙŠÙƒÙˆÙ† ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª (ÙŠÙ…Ø«Ù„ 10 Ø£Ù‚Ù„Ø§Ù…).</p>
                <p>Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØŒ Ù†Ø¨Ø¯Ø£ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† (Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯). Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯ 10 Ø£Ùˆ Ø£ÙƒØ«Ø±ØŒ ÙØ¥Ù†Ù†Ø§ "Ù†Ø­ØªÙØ¸" Ø¨Ø§Ù„Ø¹Ø´Ø±Ø§Øª ÙˆÙ†Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ù„ÙŠ.</p>
                <p><strong>Ù…Ø«Ø§Ù„:</strong></p>
                <pre>
   2  7
+  1  5
-----
                </pre>
                <ol>
                    <li><strong>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¢Ø­Ø§Ø¯:</strong> 7 + 5 = 12.</li>
                    <li><strong>Ø§Ø­ØªÙØ¸:</strong> Ø§ÙƒØªØ¨ 2 ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯ ØªØ­Øª Ø§Ù„Ø®Ø·ØŒ ÙˆØ§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ù€ 1 (ÙˆÙ‡ÙŠ ØªÙ…Ø«Ù„ Ø¹Ø´Ø±Ø© ÙˆØ§Ø­Ø¯Ø©) ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙÙˆÙ‚ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª.</li>
                    <li><strong>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø´Ø±Ø§Øª:</strong> Ø§Ù„Ø¢Ù† Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§ØªØŒ ÙˆÙ„Ø§ ØªÙ†Ø³Ù Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø§Ø­ØªÙØ¸Øª Ø¨Ù‡: 1 (Ø§Ù„Ø°ÙŠ Ø§Ø­ØªÙØ¸Ù†Ø§ Ø¨Ù‡) + 2 + 1 = 4.</li>
                    <li><strong>Ø§Ù„Ù†Ø§ØªØ¬:</strong> 42.</li>
                </ol>
                <button id="hideHelpBtn" class="action-button">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            </div>
        </div>
    </div>

    <script>
        // --- Ø£ÙƒÙˆØ§Ø¯ JavaScript Ù‡Ù†Ø§ ---
        document.addEventListener('DOMContentLoaded', () => {
            const easyBtn = document.getElementById('easyBtn');
            const mediumBtn = document.getElementById('mediumBtn');
            const hardBtn = document.getElementById('hardBtn');
            const levelSelection = document.querySelector('.level-selection');
            const gameArea = document.querySelector('.game-area');
            const num1Display = document.getElementById('num1');
            const num2Display = document.getElementById('num2');
            const answerInputContainer = document.querySelector('.answer-input-container');
            const checkAnswerBtn = document.getElementById('checkAnswerBtn');
            const nextProblemBtn = document.getElementById('nextProblemBtn');
            const feedbackDisplay = document.getElementById('feedback');
            const scoreDisplay = document.getElementById('score');
            const starsDisplay = document.getElementById('stars');
            const showExplanationBtn = document.getElementById('showExplanationBtn');
            const explanationArea = document.getElementById('explanationArea');
            const explanationContent = document.getElementById('explanationContent');
            const showHelpBtn = document.getElementById('showHelpBtn');
            const hideHelpBtn = document.getElementById('hideHelpBtn');
            const helpContent = document.querySelector('.help-content');

            let currentLevel = 'easy';
            let currentNum1, currentNum2, correctAnswer;
            let score = 0;
            let stars = 0;
            let problemDigits = 2; // Default for easy (tens place)

            // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---

            function generateProblem() {
                feedbackDisplay.textContent = '';
                explanationArea.style.display = 'none';
                showExplanationBtn.style.display = 'none';
                nextProblemBtn.style.display = 'none';
                checkAnswerBtn.style.display = 'inline-block';

                let maxVal;
                let minVal = 10; // Minimum value to ensure two-digit numbers for visual alignment

                if (currentLevel === 'easy') {
                    maxVal = 40; // Numbers that typically don't require carrying for two digits
                    problemDigits = 2;
                    // Ensure no carrying for easy level
                    do {
                        currentNum1 = Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
                        currentNum2 = Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
                    } while ((currentNum1 % 10) + (currentNum2 % 10) >= 10); // Check for carrying in units
                } else if (currentLevel === 'medium') {
                    maxVal = 99; // Up to two digits, simple carrying
                    problemDigits = 2;
                    do { // Ensure at least one carry for medium
                        currentNum1 = Math.floor(Math.random() * (maxVal - 10 + 1)) + 10;
                        currentNum2 = Math.floor(Math.random() * (maxVal - 10 + 1)) + 10;
                    } while ((currentNum1 % 10) + (currentNum2 % 10) < 10);
                } else if (currentLevel === 'hard') {
                    maxVal = 999; // Up to three digits, multiple carrying
                    minVal = 100;
                    problemDigits = 3;
                    currentNum1 = Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
                    currentNum2 = Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
                }

                correctAnswer = currentNum1 + currentNum2;

                num1Display.textContent = currentNum1;
                num2Display.textContent = currentNum2;

                createAnswerInputs();
            }

            function createAnswerInputs() {
                answerInputContainer.innerHTML = '';
                const answerString = String(correctAnswer);
                const maxLen = Math.max(String(currentNum1).length, String(currentNum2).length, answerString.length);

                // Create inputs from right to left (units, tens, hundreds...)
                for (let i = 0; i < maxLen; i++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.max = '9';
                    input.maxLength = '1';
                    input.classList.add('answer-input');
                    input.dataset.digitIndex = maxLen - 1 - i; // Index from left (0 for leftmost digit)
                    answerInputContainer.prepend(input); // Add to the beginning to maintain right-to-left order visually
                    
                    // Add event listener for auto-tabbing
                    input.addEventListener('input', function() {
                        if (this.value.length >= this.maxLength) {
                            const nextInput = this.nextElementSibling;
                            if (nextInput) {
                                nextInput.focus();
                            } else {
                                // If it's the last input, focus on check button
                                checkAnswerBtn.focus();
                            }
                        }
                        // Clear any non-digit input
                        this.value = this.value.replace(/\D/g, '');
                    });
                }
                answerInputContainer.querySelector('.answer-input').focus(); // Focus on the first input (rightmost)
            }

            function checkAnswer() {
                let userAnswer = '';
                const inputs = Array.from(answerInputContainer.querySelectorAll('.answer-input')).reverse(); // Read from right to left
                inputs.forEach(input => {
                    userAnswer += input.value || ''; // Get value, handle empty input
                });

                if (userAnswer === '') {
                    feedbackDisplay.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹!';
                    feedbackDisplay.className = 'feedback incorrect';
                    return;
                }

                userAnswer = parseInt(userAnswer, 10);

                if (userAnswer === correctAnswer) {
                    feedbackDisplay.textContent = 'Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ¨';
                    feedbackDisplay.className = 'feedback correct';
                    score += 10;
                    stars++;
                    updateScoreBoard();
                    nextProblemBtn.style.display = 'inline-block';
                    checkAnswerBtn.style.display = 'none';
                } else {
                    feedbackDisplay.textContent = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø£Ù†Øª Ù‚Ø±ÙŠØ¨! ğŸ¤”';
                    feedbackDisplay.className = 'feedback incorrect';
                    showExplanationBtn.style.display = 'inline-block';
                }
            }

            function updateScoreBoard() {
                scoreDisplay.textContent = score;
                starsDisplay.textContent = stars;
            }

            function showExplanation() {
                explanationArea.style.display = 'block';
                explanationContent.innerHTML = ''; // Clear previous explanation

                const num1Arr = String(currentNum1).split('').map(Number);
                const num2Arr = String(currentNum2).split('').map(Number);
                const resultArr = [];
                const carries = new Array(Math.max(num1Arr.length, num2Arr.length) + 1).fill(0); // +1 for potential carry to new digit

                // Pad with zeros for vertical alignment
                const maxLength = Math.max(num1Arr.length, num2Arr.length);
                const paddedNum1 = Array(maxLength - num1Arr.length).fill(0).concat(num1Arr);
                const paddedNum2 = Array(maxLength - num2Arr.length).fill(0).concat(num2Arr);

                let explanationHtml = `
                    <p>Ù„Ù†Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©:</p>
                    <pre style="text-align: center;">
                    ${paddedNum1.join(' ')}
                  + ${paddedNum2.join(' ')}
                  -----
                    </pre>
                `;

                for (let i = maxLength - 1; i >= 0; i--) {
                    const digit1 = paddedNum1[i];
                    const digit2 = paddedNum2[i];
                    const currentCarry = carries[i + 1] || 0; // Carry from the previous column to the right

                    let sum = digit1 + digit2 + currentCarry;
                    let resultDigit = sum % 10;
                    let nextCarry = Math.floor(sum / 10);

                    resultArr.unshift(resultDigit); // Add to the beginning for correct order

                    explanationHtml += `<p><strong>Ø®Ø·ÙˆØ© ${maxLength - i}: Ø®Ø§Ù†Ø© ${getPlaceName(maxLength - i)}</strong></p>`;
                    explanationHtml += `<p>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø©: ${digit1} + ${digit2} ${currentCarry > 0 ? `+ ${currentCarry} (Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø§Ù„Ø³Ø§Ø¨Ù‚)` : ''} = ${sum}</p>`;

                    if (sum >= 10) {
                        explanationHtml += `<p>Ø§Ù„Ù†Ø§ØªØ¬ ${sum}ØŒ ÙˆÙ‡Ùˆ Ø£ÙƒØ¨Ø± Ù…Ù† 9. Ù†ÙƒØªØ¨ ${resultDigit} ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø©ØŒ Ùˆ<strong>Ù†Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø±Ù‚Ù… ${nextCarry}</strong> Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© ${getPlaceName(maxLength - i + 1)}.</p>`;
                    } else {
                        explanationHtml += `<p>Ø§Ù„Ù†Ø§ØªØ¬ ${sum}. Ù†ÙƒØªØ¨ ${resultDigit} ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø©.</p>`;
                    }
                    carries[i] = nextCarry; // Store carry for the next iteration (to the left)
                }

                // Handle final carry if any
                if (carries[0] > 0) {
                    resultArr.unshift(carries[0]);
                    explanationHtml += `<p><strong>Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:</strong> Ù‡Ù†Ø§Ùƒ Ø§Ø­ØªÙØ§Ø¸ Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø¬Ù…Ø¹ Ù‡Ùˆ ${carries[0]}. Ù†Ø¶Ø¹Ù‡ ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø±.</p>`;
                }

                explanationHtml += `<p><strong>Ø¥Ø°Ù†ØŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‡ÙŠ: ${correctAnswer}</strong></p>`;
                explanationContent.innerHTML = explanationHtml;
            }

            function getPlaceName(index) {
                switch (index) {
                    case 1: return 'Ø§Ù„Ø¢Ø­Ø§Ø¯';
                    case 2: return 'Ø§Ù„Ø¹Ø´Ø±Ø§Øª';
                    case 3: return 'Ø§Ù„Ù…Ø¦Ø§Øª';
                    case 4: return 'Ø§Ù„Ø¢Ù„Ø§Ù';
                    default: return 'Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ù„Ù‰';
                }
            }


            // --- Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ---

            easyBtn.addEventListener('click', () => {
                currentLevel = 'easy';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            mediumBtn.addEventListener('click', () => {
                currentLevel = 'medium';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            hardBtn.addEventListener('click', () => {
                currentLevel = 'hard';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            checkAnswerBtn.addEventListener('click', checkAnswer);

            nextProblemBtn.addEventListener('click', generateProblem);

            showExplanationBtn.addEventListener('click', showExplanation);

            showHelpBtn.addEventListener('click', () => {
                helpContent.style.display = 'block';
                showHelpBtn.style.display = 'none';
            });

            hideHelpBtn.addEventListener('click', () => {
                helpContent.style.display = 'none';
                showHelpBtn.style.display = 'block';
            });
        });
    </script>
</body>
</html>