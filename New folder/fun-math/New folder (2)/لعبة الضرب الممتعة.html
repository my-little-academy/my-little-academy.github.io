<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ù…Ù…ØªØ¹Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS for the game --- */
        body {
            font-family: 'Cairo', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(to right, #90EE90, #ADD8E6); /* Light green to light blue gradient */
            color: #333;
            direction: rtl;
            text-align: right;
            background-image: url('http://googleusercontent.com/image_generation_content/0'); /* Playful background */
            background-size: cover;
            background-repeat: no-repeat;
        }

        .game-container {
            background-color: #F8F8FF; /* Ghost White */
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 600px;
            width: 90%;
            margin: 20px;
        }

        h1 {
            color: #4B0082; /* Indigo */
            font-size: 2.5em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #DAA520; /* Goldenrod */
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .level-selection button,
        .action-button {
            background-color: #FF6347; /* Tomato */
            color: #FFFFFF;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .level-selection button:hover,
        .action-button:hover {
            background-color: #FF4500; /* OrangeRed */
            transform: translateY(-3px);
        }

        .level-button {
            min-width: 180px;
        }

        .game-area {
            margin-top: 30px;
            border: 3px dashed #3CB371; /* Medium Sea Green */
            padding: 20px;
            border-radius: 15px;
            background-color: #F0FFF0; /* Honeydew */
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            font-size: 1.1em;
            color: #2E8B57; /* Sea Green */
            margin-bottom: 20px;
            background-color: #E0FFFF; /* Light Cyan */
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .problem-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 3em;
            font-weight: bold;
            color: #8A2BE2; /* Blue Violet */
            margin-bottom: 20px;
            position: relative;
        }

        .problem-display .number {
            margin: -10px 0;
            min-width: 150px;
            text-align: center;
        }

        .problem-display .operator {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
        }

        hr {
            border: 2px solid #5F9EA0; /* Cadet Blue */
            width: 80%;
            margin: 15px 0;
        }

        .answer-input-container {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        .answer-input {
            width: 60px;
            height: 60px;
            font-size: 2em;
            text-align: center;
            margin: 0 5px;
            border: 3px solid #6495ED; /* Cornflower Blue */
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
            color: #333;
        }

        .answer-input:focus {
            border-color: #DC143C; /* Crimson */
        }

        .feedback {
            margin-top: 20px;
            font-size: 1.5em;
            font-weight: bold;
            min-height: 40px;
        }

        .feedback.correct {
            color: #32CD32; /* Lime Green */
        }

        .feedback.incorrect {
            color: #FF0000; /* Red */
        }

        .explanation-area {
            background-color: #F5FFFA; /* Mint Cream */
            border: 2px solid #20B2AA; /* Light Sea Green */
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: right;
        }

        .explanation-area h3 {
            color: #4682B4; /* Steel Blue */
            margin-bottom: 10px;
        }

        .explanation-area p {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
        }

        .help-section {
            margin-top: 30px;
            width: 100%;
        }

        .help-button {
            background-color: #BA55D3; /* Medium Orchid */
            color: white;
            font-size: 1.2em;
        }

        .help-content {
            background-color: #E6E6FA; /* Lavender */
            border: 2px solid #9932CC; /* Dark Orchid */
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            text-align: right;
        }

        .help-content h3 {
            color: #4B0082; /* Indigo */
            margin-bottom: 15px;
        }

        .help-content p {
            font-size: 1.1em;
            line-height: 1.6;
            color: #444;
            margin-bottom: 10px;
        }

        .help-content pre {
            background-color: #DDA0DD; /* Plum */
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
            font-size: 0.9em;
            text-align: left;
            direction: ltr;
        }

        .help-content ol {
            padding-right: 25px;
            color: #555;
        }

        .help-content ol li {
            margin-bottom: 8px;
        }

        /* For smaller screens */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            .level-selection button {
                font-size: 1em;
                padding: 12px 20px;
                margin: 8px;
            }
            .problem-display {
                font-size: 2.5em;
            }
            .answer-input {
                width: 50px;
                height: 50px;
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ù…Ù…ØªØ¹Ø©</h1>

        <div class="level-selection">
            <h2>Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</h2>
            <button id="easyBtn" class="level-button">Ù…Ø¨ØªØ¯Ø¦ (Ø¬Ø¯Ø§ÙˆÙ„ Ø¨Ø³ÙŠØ·Ø©)</button>
            <button id="mediumBtn" class="level-button">Ù…ØªÙˆØ³Ø· (Ø±Ù‚Ù… ÙÙŠ Ø±Ù‚Ù…ÙŠÙ†)</button>
            <button id="hardBtn" class="level-button">Ù…ØªÙ‚Ø¯Ù… (Ø±Ù‚Ù…ÙŠÙ† ÙÙŠ Ø±Ù‚Ù…ÙŠÙ†)</button>
        </div>

        <div class="game-area" style="display: none;">
            <div class="score-board">
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
                <span>Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="stars">0</span> â­</span>
            </div>

            <div class="problem-display">
                <p class="number" id="num1"></p>
                <p class="operator">Ã—</p>
                <p class="number" id="num2"></p>
                <hr>
                <div class="answer-input-container">
                    </div>
                <button id="checkAnswerBtn" class="action-button">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
                <button id="nextProblemBtn" class="action-button" style="display: none;">Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
            </div>

            <div class="feedback" id="feedback"></div>
            <button id="showExplanationBtn" class="action-button" style="display: none;">Ø´Ø±Ø­ Ø§Ù„Ø­Ù„</button>

            <div class="explanation-area" id="explanationArea" style="display: none;">
                <h3>Ø´Ø±Ø­ Ø§Ù„Ø­Ù„:</h3>
                <div id="explanationContent"></div>
            </div>
        </div>

        <div class="help-section" id="helpSection">
            <button id="showHelpBtn" class="action-button help-button">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            <div class="help-content" style="display: none;">
                <h3>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©: ÙÙ‡Ù… Ø§Ù„Ø¶Ø±Ø¨</h3>
                <p>Ø§Ù„Ø¶Ø±Ø¨ Ù‡Ùˆ Ø·Ø±ÙŠÙ‚Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©!</p>
                <p>ØªØ®ÙŠÙ„ Ø£Ù† Ù„Ø¯ÙŠÙƒ 3 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø§Ù„ØªÙØ§Ø­ØŒ ÙˆÙÙŠ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© 4 ØªÙØ§Ø­Ø§Øª. ÙƒÙ… ØªÙØ§Ø­Ø© Ù„Ø¯ÙŠÙƒ Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ØŸ</p>
                <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªÙ‚ÙˆÙ„: 4 + 4 + 4 = 12 ØªÙØ§Ø­Ø©.</p>
                <p>Ø£Ùˆ Ø¨Ø¨Ø³Ø§Ø·Ø© ØªÙ‚ÙˆÙ„: 3 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ã— 4 ØªÙØ§Ø­Ø§Øª ÙÙŠ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© = 12 ØªÙØ§Ø­Ø©.</p>
                <p><strong>Ù…Ø«Ø§Ù„: 5 Ã— 3 = 15</strong> (ÙŠØ¹Ù†ÙŠ 5 + 5 + 5 Ø£Ùˆ 3 + 3 + 3 + 3 + 3)</p>
                
                <h4>Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ (Ù„Ø±Ù‚Ù…ÙŠÙ† Ø£Ùˆ Ø£ÙƒØ«Ø±):</h4>
                <p>Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø¶Ø±Ø¨ Ø£Ø±Ù‚Ø§Ù…Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ:</p>
                <pre>
   2  3
Ã—  4
-----
                </pre>
                <ol>
                    <li><strong>Ø§Ø¨Ø¯Ø£ Ø¨Ø¶Ø±Ø¨ Ø§Ù„Ø¢Ø­Ø§Ø¯:</strong> Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³ÙÙ„ÙŠ (4) ÙÙŠ Ø¢Ø­Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ (3). 4 Ã— 3 = 12.</li>
                    <li><strong>Ø§ÙƒØªØ¨ ÙˆØ§Ø­ØªÙØ¸:</strong> Ø§ÙƒØªØ¨ 2 ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ø­Ø§Ø¯ ØªØ­Øª Ø§Ù„Ø®Ø·ØŒ ÙˆØ§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ù€ 1 (Ø§Ù„Ø¹Ø´Ø±Ø©) ÙÙˆÙ‚ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ.</li>
                    <li><strong>Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø¹Ø´Ø±Ø§Øª:</strong> Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³ÙÙ„ÙŠ (4) ÙÙŠ Ø¹Ø´Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù„ÙˆÙŠ (2). 4 Ã— 2 = 8.</li>
                    <li><strong>Ø£Ø¶Ù Ø§Ù„Ø§Ø­ØªÙØ§Ø¸:</strong> Ø£Ø¶Ù Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø§Ø­ØªÙØ¸Øª Ø¨Ù‡ (1) Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø§ØªØ¬: 8 + 1 = 9.</li>
                    <li><strong>Ø§ÙƒØªØ¨ Ø§Ù„Ù†Ø§ØªØ¬:</strong> Ø§ÙƒØªØ¨ 9 ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¹Ø´Ø±Ø§Øª.</li>
                    <li><strong>Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> 92.</li>
                </ol>
                <button id="hideHelpBtn" class="action-button">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript for the game ---
        document.addEventListener('DOMContentLoaded', () => {
            const easyBtn = document.getElementById('easyBtn');
            const mediumBtn = document.getElementById('mediumBtn');
            const hardBtn = document.getElementById('hardBtn');
            const levelSelection = document.querySelector('.level-selection');
            const gameArea = document.querySelector('.game-area');
            const num1Display = document.getElementById('num1');
            const num2Display = document.getElementById('num2');
            const answerInputContainer = document.querySelector('.answer-input-container');
            const checkAnswerBtn = document.getElementById('checkAnswerBtn');
            const nextProblemBtn = document.getElementById('nextProblemBtn');
            const feedbackDisplay = document.getElementById('feedback');
            const scoreDisplay = document.getElementById('score');
            const starsDisplay = document.getElementById('stars');
            const showExplanationBtn = document.getElementById('showExplanationBtn');
            const explanationArea = document.getElementById('explanationArea');
            const explanationContent = document.getElementById('explanationContent');
            const showHelpBtn = document.getElementById('showHelpBtn');
            const hideHelpBtn = document.getElementById('hideHelpBtn');
            const helpContent = document.querySelector('.help-content');

            let currentLevel = 'easy';
            let currentNum1, currentNum2, correctAnswer;
            let score = 0;
            let stars = 0;

            function generateProblem() {
                feedbackDisplay.textContent = '';
                explanationArea.style.display = 'none';
                showExplanationBtn.style.display = 'none';
                nextProblemBtn.style.display = 'none';
                checkAnswerBtn.style.display = 'inline-block';

                if (currentLevel === 'easy') {
                    currentNum1 = Math.floor(Math.random() * 10) + 1; // 1-10
                    currentNum2 = Math.floor(Math.random() * 5) + 1;  // 1-5 for simpler tables
                    // Ensure tables of 2,3,5,10
                    const easyMultipliers = [2, 3, 5, 10];
                    currentNum2 = easyMultipliers[Math.floor(Math.random() * easyMultipliers.length)];
                } else if (currentLevel === 'medium') {
                    currentNum1 = Math.floor(Math.random() * 90) + 10; // Two-digit
                    currentNum2 = Math.floor(Math.random() * 9) + 1;  // Single-digit
                } else if (currentLevel === 'hard') {
                    currentNum1 = Math.floor(Math.random() * 90) + 10; // Two-digit
                    currentNum2 = Math.floor(Math.random() * 90) + 10; // Two-digit
                }

                correctAnswer = currentNum1 * currentNum2;

                num1Display.textContent = currentNum1;
                num2Display.textContent = currentNum2;

                createAnswerInputs();
            }

            function createAnswerInputs() {
                answerInputContainer.innerHTML = '';
                const answerString = String(correctAnswer);
                // Determine max length for inputs (result can be longer than numbers themselves)
                const maxLen = Math.max(String(currentNum1).length, String(currentNum2).length, answerString.length);

                for (let i = 0; i < answerString.length; i++) { // Create inputs only for the length of the actual answer
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.max = '9';
                    input.maxLength = '1';
                    input.classList.add('answer-input');
                    // data-digit-index helps if we need to map to specific digits later, but for user input, just order them.
                    input.dataset.digitIndex = answerString.length - 1 - i; 
                    answerInputContainer.prepend(input); // Add to the beginning to maintain right-to-left order visually
                    
                    input.addEventListener('input', function() {
                        if (this.value.length >= this.maxLength) {
                            const nextInput = this.nextElementSibling;
                            if (nextInput) {
                                nextInput.focus();
                            } else {
                                checkAnswerBtn.focus();
                            }
                        }
                        this.value = this.value.replace(/\D/g, ''); // Ensure only digits
                    });
                }
                answerInputContainer.querySelector('.answer-input').focus();
            }

            function checkAnswer() {
                let userAnswer = '';
                const inputs = Array.from(answerInputContainer.querySelectorAll('.answer-input')).reverse(); // Read from right to left
                inputs.forEach(input => {
                    userAnswer += input.value || '';
                });

                if (userAnswer === '') {
                    feedbackDisplay.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹!';
                    feedbackDisplay.className = 'feedback incorrect';
                    return;
                }

                userAnswer = parseInt(userAnswer, 10);

                if (userAnswer === correctAnswer) {
                    feedbackDisplay.textContent = 'Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ¨';
                    feedbackDisplay.className = 'feedback correct';
                    score += 10;
                    stars++;
                    updateScoreBoard();
                    nextProblemBtn.style.display = 'inline-block';
                    checkAnswerBtn.style.display = 'none';
                } else {
                    feedbackDisplay.textContent = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø£Ù†Øª Ù‚Ø±ÙŠØ¨! ğŸ¤”';
                    feedbackDisplay.className = 'feedback incorrect';
                    showExplanationBtn.style.display = 'inline-block';
                }
            }

            function updateScoreBoard() {
                scoreDisplay.textContent = score;
                starsDisplay.textContent = stars;
            }

            function showExplanation() {
                explanationArea.style.display = 'block';
                explanationContent.innerHTML = '';

                let explanationHtml = `<p>Ù„Ù†Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©: <strong>${currentNum1} Ã— ${currentNum2}</strong></p>`;

                if (currentLevel === 'easy') {
                    explanationHtml += `<p>Ø§Ù„Ø¶Ø±Ø¨ Ù‡Ùˆ <strong>Ø¬Ù…Ø¹ Ù…ØªÙƒØ±Ø±</strong>.</p>`;
                    explanationHtml += `<p> ${currentNum1} Ã— ${currentNum2} ÙŠØ¹Ù†ÙŠ Ø¬Ù…Ø¹ ${currentNum1} Ø¨Ù†ÙØ³Ù‡Ø§ ${currentNum2} Ù…Ø±Ø©:</p>`;
                    let sumString = '';
                    for(let i = 0; i < currentNum2; i++) {
                        sumString += currentNum1;
                        if (i < currentNum2 - 1) {
                            sumString += ' + ';
                        }
                    }
                    explanationHtml += `<pre style="text-align: center;">${sumString} = ${correctAnswer}</pre>`;
                } else {
                    // Vertical multiplication explanation for medium/hard levels
                    const num1Str = String(currentNum1);
                    const num2Str = String(currentNum2);
                    const num1Len = num1Str.length;
                    const num2Len = num2Str.length;

                    explanationHtml += `<p>Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ:</p>`;
                    explanationHtml += `<pre style="text-align: center;">`;
                    explanationHtml += `   ${num1Str}\n`;
                    explanationHtml += `Ã—  ${num2Str}\n`;
                    explanationHtml += `-----\n`;

                    let intermediateSteps = [];
                    let carry = 0;
                    let fullIntermediateSum = 0;

                    for (let i = num2Len - 1; i >= 0; i--) {
                        const digit2 = parseInt(num2Str[i]);
                        let partialProduct = '';
                        let currentCarry = 0;
                        let lineProduct = 0;
                        let lineExplanation = '';

                        // Add zeros for place value
                        let trailingZeros = '';
                        for (let z = 0; z < (num2Len - 1 - i); z++) {
                            trailingZeros += '0';
                        }
                        
                        explanationHtml += `<p><strong>Ø§Ù„Ø®Ø·ÙˆØ© ${num2Len - i}: Ø§Ø¶Ø±Ø¨ ${digit2} ÙÙŠ ${num1Str}</strong></p>`;
                        lineExplanation += `${digit2} Ã— ${num1Str}: `;

                        for (let j = num1Len - 1; j >= 0; j--) {
                            const digit1 = parseInt(num1Str[j]);
                            let product = digit2 * digit1 + currentCarry;
                            let resultDigit = product % 10;
                            currentCarry = Math.floor(product / 10);
                            partialProduct = resultDigit + partialProduct;
                            lineExplanation += `${digit2} Ã— ${digit1} = ${product}. `;
                            if (currentCarry > 0) {
                                lineExplanation += `Ù†Ø­ØªÙØ¸ Ø¨Ù€ ${currentCarry}. `;
                            }
                        }
                        if (currentCarry > 0) {
                            partialProduct = currentCarry + partialProduct;
                            lineExplanation += `Ø£Ø¶Ù Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ ${currentCarry}.`;
                        }

                        let intermediateValue = parseInt(partialProduct + trailingZeros);
                        intermediateSteps.push(intermediateValue);
                        explanationHtml += `<p>${lineExplanation} Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ø¬Ø²Ø¦ÙŠ Ù‡Ùˆ: ${partialProduct}${trailingZeros}</p>`;
                        explanationHtml += `<pre style="text-align: center;">  ${' '.repeat(num2Len - 1 - i)}${partialProduct}${trailingZeros}</pre>`;
                    }

                    if (num2Len > 1) {
                        explanationHtml += `<p><strong>Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©: Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†ÙˆØ§ØªØ¬ Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</strong></p>`;
                        explanationHtml += `<pre style="text-align: center;">`;
                        for(let k = intermediateSteps.length -1 ; k >=0; k--){ // Display from top to bottom
                             explanationHtml += `${String(intermediateSteps[k]).padStart(String(correctAnswer).length + num2Len -1, ' ')}\n`;
                            if(k > 0) explanationHtml += `+\n`;
                        }
                        explanationHtml += `-----\n`;
                        explanationHtml += `${correctAnswer}\n`;
                        explanationHtml += `</pre>`;
                    }
                }

                explanationHtml += `<p><strong>Ø¥Ø°Ù†ØŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‡ÙŠ: ${correctAnswer}</strong></p>`;
                explanationContent.innerHTML = explanationHtml;
            }

            function getPlaceName(index) {
                switch (index) {
                    case 1: return 'Ø§Ù„Ø¢Ø­Ø§Ø¯';
                    case 2: return 'Ø§Ù„Ø¹Ø´Ø±Ø§Øª';
                    case 3: return 'Ø§Ù„Ù…Ø¦Ø§Øª';
                    case 4: return 'Ø§Ù„Ø¢Ù„Ø§Ù';
                    default: return 'Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ù„Ù‰';
                }
            }

            // --- Event Handlers ---

            easyBtn.addEventListener('click', () => {
                currentLevel = 'easy';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            mediumBtn.addEventListener('click', () => {
                currentLevel = 'medium';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            hardBtn.addEventListener('click', () => {
                currentLevel = 'hard';
                levelSelection.style.display = 'none';
                gameArea.style.display = 'block';
                score = 0;
                stars = 0;
                updateScoreBoard();
                generateProblem();
            });

            checkAnswerBtn.addEventListener('click', checkAnswer);
            nextProblemBtn.addEventListener('click', generateProblem);
            showExplanationBtn.addEventListener('click', showExplanation);

            showHelpBtn.addEventListener('click', () => {
                helpContent.style.display = 'block';
                showHelpBtn.style.display = 'none';
            });

            hideHelpBtn.addEventListener('click', () => {
                helpContent.style.display = 'none';
                showHelpBtn.style.display = 'block';
            });
        });
    </script>
</body>
</html>