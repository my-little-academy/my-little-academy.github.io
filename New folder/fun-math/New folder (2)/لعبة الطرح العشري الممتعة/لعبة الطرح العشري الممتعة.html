<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø·Ø±Ø­ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø§Ù„Ù…Ù…ØªØ¹Ø©</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --purple-color: #9b59b6;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
        }
        
        body {
            background-color: #f9f9f9;
            font-family: 'Arial Arabic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            text-align: right;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 850px;
            margin: 30px auto;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .game-container::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color), var(--purple-color));
        }
        
        h1 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 25px;
            font-size: 32px;
            position: relative;
            padding-bottom: 15px;
        }
        
        h1::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }
        
        .instructions {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-right: 5px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .instructions h3 {
            color: var(--dark-color);
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        
        .instructions h3::before {
            content: "ğŸ“";
            margin-left: 10px;
            font-size: 24px;
        }
        
        .instructions ol {
            padding-right: 20px;
            color: #555;
            line-height: 1.8;
        }
        
        .instructions li {
            margin-bottom: 8px;
            position: relative;
        }
        
        .instructions li::before {
            content: "";
            position: absolute;
            right: -20px;
            top: 10px;
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 50%;
        }
        
        .card-rows-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            position: relative;
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }
        
        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #7f8c8d, transparent);
            margin: 15px 0;
            width: 100%;
            border: none;
        }
        
        .card-row {
            display: flex;
            margin: 8px 0;
            justify-content: flex-end;
            align-items: center;
        }
        
        .card {
            width: 70px;
            height: 90px;
            color: white;
            margin: 0 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            cursor: pointer;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            user-select: none;
            position: relative;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
        }
        
        .place-row .card {
            background-color: var(--primary-color);
            font-size: 16px;
            height: 60px;
            font-weight: bold;
            cursor: default;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .minuend-row .card {
            background-color: var(--secondary-color);
            background-image: linear-gradient(to bottom right, var(--secondary-color), #27ae60);
        }
        
        .subtrahend-row .card {
            background-color: var(--danger-color);
            background-image: linear-gradient(to bottom right, var(--danger-color), #c0392b);
        }
        
        .result-row .card {
            background-color: var(--warning-color);
            background-image: linear-gradient(to bottom right, var(--warning-color), #e67e22);
        }
        
        .decimal-card {
            background-color: var(--purple-color) !important;
            background-image: linear-gradient(to bottom right, var(--purple-color), #8e44ad) !important;
            font-size: 36px;
            font-weight: bold;
        }
        
        .empty-card {
            background-color: var(--light-color) !important;
            color: var(--dark-color);
            border: 2px dashed #bdc3c7;
            background-image: none !important;
        }
        
        .card:hover:not(.place-row .card) {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .selected {
            border: 3px solid #FFD700;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .number-pad {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 25px 0;
            gap: 12px;
            max-width: 350px;
        }
        
        .number-btn {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .number-btn:hover {
            background-color: #2980b9;
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 25px;
        }
        
        .control-btn {
            padding: 12px 25px;
            background-color: var(--dark-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .control-btn:hover {
            background-color: #1a252f;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        #message {
            font-size: 20px;
            font-weight: bold;
            color: var(--dark-color);
            margin: 20px 0;
            height: 30px;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(52, 152, 219, 0.1);
            border-right: 4px solid var(--primary-color);
        }
        
        .row-label {
            width: 110px;
            text-align: center;
            font-weight: bold;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background-color: rgba(0,0,0,0.03);
            padding: 10px;
            border-radius: 8px;
            margin-left: 15px;
        }
        
        .borrow-circle {
            position: absolute;
            width: 36px;
            height: 36px;
            background-color: #ff4757;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            top: -18px;
            right: 17px;
            z-index: 10;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .borrow-circle:hover {
            transform: scale(1.15) translateY(-2px);
            background-color: #ff6b81;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .borrow-circle::after {
            content: "Ø§Ø³ØªÙ„Ù";
            position: absolute;
            bottom: -25px;
            right: 50%;
            transform: translateX(50%);
            font-size: 12px;
            color: #ff4757;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .borrow-circle:hover::after {
            opacity: 1;
        }
        
        .changed-digit {
            animation: pulse 0.5s 3;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .explanation-box {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            max-width: 600px;
            text-align: right;
            border-right: 5px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .explanation-box h3 {
            margin-top: 0;
            color: var(--dark-color);
            display: flex;
            align-items: center;
        }
        
        .explanation-box h3::before {
            content: "ğŸ”";
            margin-left: 10px;
            font-size: 24px;
        }
        
        .step-explanation {
            margin-bottom: 12px;
            padding: 12px;
            border-right: 4px solid var(--primary-color);
            background-color: #e8f4fc;
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .success-message {
            color: #27ae60;
            font-weight: bold;
            font-size: 22px;
            text-align: center;
            margin: 15px 0;
            animation: bounce 0.5s;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .floating-icon {
            position: absolute;
            font-size: 24px;
            opacity: 0.1;
            z-index: 0;
        }
        
        .floating-icon:nth-child(1) {
            top: 20px;
            left: 20px;
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-icon:nth-child(2) {
            bottom: 40px;
            right: 30px;
            animation: float 8s ease-in-out infinite 2s;
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                margin: 15px;
                border-radius: 15px;
            }
            
            .card {
                width: 50px;
                height: 70px;
                font-size: 22px;
                margin: 0 4px;
            }
            
            .row-label {
                width: 80px;
                font-size: 14px;
                margin-left: 10px;
            }
            
            .number-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .control-btn {
                padding: 10px 15px;
                min-width: 100px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="floating-icon">â—</div>
        <div class="floating-icon">â–</div>
        
        <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø·Ø±Ø­ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø§Ù„Ù…Ù…ØªØ¹Ø©</h1>
        
        <div class="instructions">
            <h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
            <ol>
                <li>Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‡Ùˆ Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø·Ø±Ø­ Ø§Ù„Ø¹Ø´Ø±ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</li>
                <li>Ø³ØªØ¸Ù‡Ø± Ù„Ùƒ Ù…Ø³Ø£Ù„Ø© Ø·Ø±Ø­ Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ù…Ù†Ø§Ø²Ù„ Ù…Ø®ØªÙ„ÙØ© (Ø¹Ø´Ø±Ø§ØªØŒ Ø¢Ø­Ø§Ø¯ØŒ Ø£Ø¹Ø´Ø§Ø±ØŒ ...)</li>
                <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</li>
                <li>Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ù„Ù„Ø§Ø³ØªÙ„Ø§ÙØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ ÙÙˆÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</li>
                <li>Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ù‚Ù‚" Ù„Ù…Ø¹Ø±ÙØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¥Ø¬Ø§Ø¨ØªÙƒ ØµØ­ÙŠØ­Ø©</li>
                <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…" ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</li>
            </ol>
        </div>
        
        <div class="card-rows-container">
            <!-- ØµÙ Ø§Ù„Ù…Ù†Ø§Ø²Ù„ -->
            <div class="card-row place-row">
                <div class="row-label">Ø§Ù„Ù…Ù†Ø§Ø²Ù„</div>
                <div class="card">Ø¹Ø´Ø±Ø§Øª</div>
                <div class="card">Ø¢Ø­Ø§Ø¯</div>
                <div class="card">ÙØ§ØµÙ„Ø©</div>
                <div class="card">Ø£Ø¹Ø´Ø§Ø±</div>
                <div class="card">Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø¦Ø©</div>
                <div class="card">Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø£Ù„Ù</div>
            </div>
            
            <!-- ØµÙ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡ -->
            <div class="card-row minuend-row">
                <div class="row-label">Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡</div>
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <!-- ØµÙ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ -->
            <div class="card-row subtrahend-row">
                <div class="row-label">Ø§Ù„Ù…Ø·Ø±ÙˆØ­</div>
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <!-- Ø®Ø· ÙØ§ØµÙ„ -->
            <div class="divider"></div>
            
            <!-- ØµÙ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
            <div class="card-row result-row">
                <div class="row-label">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
        </div>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
        <div class="number-pad">
            <button class="number-btn" data-number="0">0</button>
            <button class="number-btn" data-number="1">1</button>
            <button class="number-btn" data-number="2">2</button>
            <button class="number-btn" data-number="3">3</button>
            <button class="number-btn" data-number="4">4</button>
            <button class="number-btn" data-number="5">5</button>
            <button class="number-btn" data-number="6">6</button>
            <button class="number-btn" data-number="7">7</button>
            <button class="number-btn" data-number="8">8</button>
            <button class="number-btn" data-number="9">9</button>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="control-buttons">
            <button class="control-btn" id="check-btn">ØªØ­Ù‚Ù‚</button>
            <button class="control-btn" id="change-btn">ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</button>
        </div>
        
        <p id="message">Ø§Ø®ØªØ± Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</p>
        
        <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø´Ø±Ø­ -->
        <div class="explanation-box" id="explanation-box" style="display: none;">
            <h3>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„ Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù:</h3>
            <div id="explanation-steps"></div>
        </div>
    </div>

    <script>
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø¹Ø´Ø±Ø§Øª â† Ø¢Ø­Ø§Ø¯ â† ÙØ§ØµÙ„Ø© â† Ø£Ø¹Ø´Ø§Ø± â† Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø¦Ø© â† Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø£Ù„Ù
        const places = ["Ø¹Ø´Ø±Ø§Øª", "Ø¢Ø­Ø§Ø¯", "ÙØ§ØµÙ„Ø©", "Ø£Ø¹Ø´Ø§Ø±", "Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø¦Ø©", "Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø£Ù„Ù"];
        let minuends = [0, 0, '.', 0, 0, 0]; // Ø§Ù„ÙØ§ØµÙ„Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«
        let subtrahends = [0, 0, '.', 0, 0, 0]; // Ø§Ù„ÙØ§ØµÙ„Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«
        let results = ['', '', '.', '', '', '']; // ÙØ§Ø±ØºØ© Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„ÙØ§ØµÙ„Ø©
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        let selectedCard = null;
        let decimalPosition = 2; // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ§ØµÙ„Ø© (Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø«Ø§Ù„Ø« ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©)
        let borrowSteps = [];
        let currentStep = 0;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        function createCards() {
            const placeRow = document.querySelector('.place-row');
            const minuendRow = document.querySelector('.minuend-row');
            const subtrahendRow = document.querySelector('.subtrahend-row');
            const resultRow = document.querySelector('.result-row');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            while (placeRow.children.length > 1) placeRow.removeChild(placeRow.lastChild);
            while (minuendRow.children.length > 1) minuendRow.removeChild(minuendRow.lastChild);
            while (subtrahendRow.children.length > 1) subtrahendRow.removeChild(subtrahendRow.lastChild);
            while (resultRow.children.length > 1) resultRow.removeChild(resultRow.lastChild);
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø²Ù„
            places.forEach((place, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.textContent = place;
                placeRow.appendChild(card);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡ Ù…Ø¹ Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
            minuends.forEach((value, index) => {
                const card = document.createElement('div');
                card.className = index === decimalPosition ? 'card decimal-card' : 'card';
                card.textContent = value;
                card.dataset.type = 'minuend';
                card.dataset.index = index;
                
                // Ù†Ø¶ÙŠÙ Ø¯Ø§Ø¦Ø±Ø© Ø§Ø³ØªÙ„Ø§Ù Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ÙŠØ³Øª Ø§Ù„ÙØ§ØµÙ„Ø© ÙˆÙ„ÙŠØ³Øª Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø±
                if (index !== decimalPosition && index > 0) {
                    const borrowCircle = document.createElement('div');
                    borrowCircle.className = 'borrow-circle';
                    borrowCircle.textContent = 'â†“';
                    borrowCircle.title = 'Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù';
                    borrowCircle.dataset.index = index;
                    
                    borrowCircle.addEventListener('click', function(e) {
                        e.stopPropagation();
                        handleBorrow(this.dataset.index);
                    });
                    
                    card.appendChild(borrowCircle);
                }
                
                minuendRow.appendChild(card);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø·Ø±ÙˆØ­
            subtrahends.forEach((value, index) => {
                const card = document.createElement('div');
                card.className = index === decimalPosition ? 'card decimal-card' : 'card';
                card.textContent = value;
                card.dataset.type = 'subtrahend';
                card.dataset.index = index;
                subtrahendRow.appendChild(card);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
            results.forEach((value, index) => {
                const card = document.createElement('div');
                if (index === decimalPosition) {
                    card.className = 'card decimal-card';
                    card.textContent = '.';
                } else {
                    card.className = 'card empty-card';
                    card.textContent = value;
                    card.dataset.type = 'result';
                    card.dataset.index = index;
                    card.addEventListener('click', function() {
                        selectResultCard(this);
                    });
                }
                resultRow.appendChild(card);
            });
        }
        
        // ØªÙˆÙ„ÙŠØ¯ Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­
        function generateRandomNumbers() {
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡
            minuends = minuends.map((val, index) => 
                index === decimalPosition ? '.' : Math.floor(Math.random() * 10)
            );
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡ ÙÙŠ ÙƒÙ„ Ø®Ø§Ù†Ø©
            subtrahends = subtrahends.map((val, index) => {
                if (index === decimalPosition) return '.';
                const max = parseInt(minuends[index]);
                return Math.floor(Math.random() * (max + 1));
            });
            
            // Ù†ØªØ§Ø¦Ø¬ ÙØ§Ø±ØºØ©
            results = results.map((val, index) => 
                index === decimalPosition ? '.' : ''
            );
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø§Ø³ØªÙ„Ø§Ù Ù…Ø·Ù„ÙˆØ¨ØŒ Ù†Ø®Ù„Ù‚ Ø­Ø§Ù„Ø© Ø§Ø³ØªÙ„Ø§Ù
            if (calculateBorrowSteps().length === 0) {
                createBorrowScenario();
            }
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„Ø© Ø§Ø³ØªÙ„Ø§Ù Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
        function createBorrowScenario() {
            // Ù†Ø®ØªØ§Ø± Ø®Ø§Ù†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø¹Ø¯Ø§ Ø§Ù„ÙØ§ØµÙ„Ø© ÙˆØ§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * (minuends.length - 2)) + 1;
            } while (randomIndex === decimalPosition);
            
            // Ù†Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡
            subtrahends[randomIndex] = parseInt(minuends[randomIndex]) + 1;
            
            // Ù†Ù‚Ù„Ù„ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡ ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
            const borrowFrom = randomIndex - (randomIndex === decimalPosition + 1 ? 2 : 1);
            if (borrowFrom >= 0 && borrowFrom !== decimalPosition) {
                minuends[borrowFrom] = Math.max(1, parseInt(minuends[borrowFrom]));
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
        function handleBorrow(index) {
            index = parseInt(index);
            
            // Ù†ØªØ­Ù‚Ù‚ Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù (Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­)
            if (parseInt(minuends[index]) >= parseInt(subtrahends[index])) {
                alert('Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù Ù‡Ù†Ø§ØŒ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£ÙƒØ¨Ø± Ø£Ùˆ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù…Ø·Ø±ÙˆØ­');
                return;
            }
            
            // Ù†ØªØ­Ù‚Ù‚ Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù Ù…Ù† Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ØªÙŠ Ù‚Ø¨Ù„Ù‡Ø§
            const borrowFrom = index - (index === decimalPosition + 1 ? 2 : 1);
            
            if (borrowFrom < 0 || parseInt(minuends[borrowFrom]) < 1) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù Ù…Ù† Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©');
                return;
            }
            
            // Ù†Ø¬Ø±ÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
            minuends[borrowFrom] = parseInt(minuends[borrowFrom]) - 1;
            minuends[index] = parseInt(minuends[index]) + 10;
            
            // Ù†Ø­Ø¯Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateMinuendDisplay();
            
            // Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
            document.getElementById('message').textContent = 
                `ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù: Ù†Ø§Ù‚Øµ 1 Ù…Ù† ${places[borrowFrom]} Ùˆ Ø§Ø¶ÙŠÙ 10 Ø¥Ù„Ù‰ ${places[index]}`;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡
        function updateMinuendDisplay() {
            const minuendRow = document.querySelector('.minuend-row');
            minuendRow.innerHTML = '<div class="row-label">Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡</div>';
            
            minuends.forEach((value, index) => {
                const card = document.createElement('div');
                card.className = index === decimalPosition ? 'card decimal-card' : 'card';
                card.textContent = value;
                card.dataset.type = 'minuend';
                card.dataset.index = index;
                
                if (index !== decimalPosition && index > 0) {
                    const borrowCircle = document.createElement('div');
                    borrowCircle.className = 'borrow-circle';
                    borrowCircle.textContent = 'â†“';
                    borrowCircle.title = 'Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù';
                    borrowCircle.dataset.index = index;
                    
                    borrowCircle.addEventListener('click', function(e) {
                        e.stopPropagation();
                        handleBorrow(this.dataset.index);
                    });
                    
                    card.appendChild(borrowCircle);
                }
                
                minuendRow.appendChild(card);
            });
        }
        
        // Ø­Ø³Ø§Ø¨ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
        function calculateBorrowSteps() {
            const steps = [];
            const minuendCopy = [...minuends];
            const subtrahendCopy = [...subtrahends];
            
            // Ù†ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ø®Ø§Ù†Ø© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± (Ù…Ù† Ø§Ù„Ø£ØµØºØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£ÙƒØ¨Ø±)
            for (let i = minuendCopy.length - 1; i >= 0; i--) {
                if (i === decimalPosition) continue; // Ù†ØªØ¬Ø§ÙˆØ² Ø§Ù„ÙØ§ØµÙ„Ø©
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡
                if (parseInt(subtrahendCopy[i]) > parseInt(minuendCopy[i])) {
                    // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ø®Ø§Ù†Ø© ÙŠØ³Ø§Ø±Ø§Ù‹ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù Ù…Ù†Ù‡Ø§
                    let borrowFrom = i - 1;
                    while (borrowFrom >= 0) {
                        if (borrowFrom === decimalPosition) {
                            borrowFrom--;
                            continue;
                        }
                        
                        if (parseInt(minuendCopy[borrowFrom]) > 0) {
                            // Ù†ÙˆØ¬Ø¯ Ø®Ø·ÙˆØ© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù
                            const step = {
                                from: borrowFrom,
                                to: i,
                                amount: 1,
                                oldValue: minuendCopy[i],
                                newValue: parseInt(minuendCopy[i]) + 10,
                                oldFromValue: minuendCopy[borrowFrom],
                                newFromValue: parseInt(minuendCopy[borrowFrom]) - 1
                            };
                            steps.push(step);
                            
                            // Ù†Ø­Ø¯Ø« Ø§Ù„Ù‚ÙŠÙ…
                            minuendCopy[borrowFrom] = step.newFromValue;
                            minuendCopy[i] = step.newValue;
                            break;
                        }
                        borrowFrom--;
                    }
                }
            }
            
            return steps;
        }
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        function selectResultCard(card) {
            if (selectedCard) {
                selectedCard.classList.remove('selected');
            }
            
            selectedCard = card;
            selectedCard.classList.add('selected');
            
            document.getElementById('message').textContent = 'Ø§Ø®ØªØ± Ø±Ù‚Ù…Ø§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…';
        }
        
        // Ø­Ø³Ø§Ø¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
        function calculatePlayerResult() {
            return (results[0] ? parseInt(results[0]) : 0) * 10 + 
                   (results[1] ? parseInt(results[1]) : 0) * 1 + 
                   (results[3] ? parseInt(results[3]) : 0) * 0.1 + 
                   (results[4] ? parseInt(results[4]) : 0) * 0.01 + 
                   (results[5] ? parseInt(results[5]) : 0) * 0.001;
        }
        
        // Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡
        function calculateMinuendValue() {
            return minuends[0] * 10 + 
                   minuends[1] * 1 + 
                   minuends[3] * 0.1 + 
                   minuends[4] * 0.01 + 
                   minuends[5] * 0.001;
        }
        
        // Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ø±ÙˆØ­
        function calculateSubtrahendValue() {
            return subtrahends[0] * 10 + 
                   subtrahends[1] * 1 + 
                   subtrahends[3] * 0.1 + 
                   subtrahends[4] * 0.01 + 
                   subtrahends[5] * 0.001;
        }
        
        // ØªÙ„ÙˆÙŠÙ† Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø©
        function colorResultCards(isCorrect) {
            const resultCards = document.querySelectorAll('.result-row .card:not(.decimal-card)');
            resultCards.forEach(card => {
                if (isCorrect) {
                    card.style.backgroundColor = '#2ecc71';
                    card.style.backgroundImage = 'linear-gradient(to bottom right, #2ecc71, #27ae60)';
                } else {
                    card.style.backgroundColor = '#e74c3c';
                    card.style.backgroundImage = 'linear-gradient(to bottom right, #e74c3c, #c0392b)';
                }
                card.classList.remove('empty-card');
            });
            
            if (isCorrect) {
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª! ğŸ‰';
                document.getElementById('message').after(successMsg);
                
                setTimeout(() => {
                    successMsg.style.opacity = '0';
                    successMsg.style.transform = 'translateY(-20px)';
                    setTimeout(() => successMsg.remove(), 500);
                }, 2000);
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            generateRandomNumbers();
            createCards();
            document.getElementById('message').textContent = 'Ø§Ø®ØªØ± Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…';
            document.getElementById('explanation-box').style.display = 'none';
            selectedCard = null;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ù†Ø¬Ø§Ø­ Ø³Ø§Ø¨Ù‚Ø©
            document.querySelectorAll('.success-message').forEach(msg => msg.remove());
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function initEvents() {
            document.querySelectorAll('.number-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (selectedCard) {
                        selectedCard.textContent = this.dataset.number;
                        results[selectedCard.dataset.index] = this.dataset.number;
                        selectedCard.classList.remove('selected');
                        selectedCard.classList.remove('empty-card');
                        selectedCard = null;
                    }
                });
            });
            
            document.getElementById('check-btn').addEventListener('click', checkAnswer);
            document.getElementById('change-btn').addEventListener('click', resetGame);
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        function checkAnswer() {
            const playerResultValue = calculatePlayerResult();
            const minuendValue = calculateMinuendValue();
            const subtrahendValue = calculateSubtrahendValue();
            const expectedResult = minuendValue - subtrahendValue;
            
            if (Math.abs(expectedResult - playerResultValue) < 0.0001) {
                document.getElementById('message').textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª!';
                colorResultCards(true);
            } else {
                document.getElementById('message').textContent = 
                    `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­: ${expectedResult.toFixed(3)}`;
                colorResultCards(false);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            generateRandomNumbers();
            createCards();
            initEvents();
        };
    </script>
</body>
</html>