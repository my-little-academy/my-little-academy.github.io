<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المونوبولي اللغوي: رحلة الإتقان</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset & Basic Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f8ff; /* Light sky blue */
            color: #333;
            display: grid;
            grid-template-columns: 1fr 320px; /* Game board + sidebar */
            grid-template-rows: auto 1fr auto; /* Header + main content + footer/tools */
            gap: 25px;
            min-height: 100vh;
            padding: 20px;
            direction: rtl; /* Right-to-left for Arabic */
        }

        /* Header Styles */
        header {
            grid-column: 1 / -1; /* Spans all columns */
            text-align: center;
            padding: 25px 0;
            background-color: #007bff; /* Primary blue */
            color: white;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Game Container (The Board) */
        .game-container {
            grid-column: 1; /* First column for the board */
            display: grid;
            grid-template-columns: repeat(11, 1fr); /* 11 columns for squares */
            grid-template-rows: repeat(11, 1fr); /* 11 rows for squares */
            border: 8px solid #4a148c; /* Deep purple border */
            background-color: #fdfdfd; /* White background for the board */
            max-width: 900px; /* Max width for square appearance */
            width: 100%; /* Make it responsive */
            margin: 0 auto;
            aspect-ratio: 1 / 1; /* Ensures it's always square */
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
            overflow: hidden; /* To keep corner elements within bounds */
        }

        /* Individual Rule Square */
        .rule-square {
            border: 1px solid #dcdcdc; /* Light grey border between squares */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 5px;
            background-color: #ffffff;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
            position: relative; /* For player token positioning */
        }

        .rule-square:hover {
            background-color: #e6f7ff; /* Light blue on hover */
            transform: translateY(-2px);
        }

        .rule-square img {
            width: 35px;
            height: 35px;
            margin-bottom: 5px;
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.2));
        }

        /* Specific Square Styles (like Monopoly corners) */
        .corner-square {
            background-color: #ffeb3b; /* Yellow for corners */
            font-size: 1.1em;
            font-weight: bold;
            color: #5d4037; /* Brownish text */
        }

        .start-square {
            grid-area: 11 / 11; /* Bottom-right corner for start */
            background-color: #28a745; /* Green */
            color: white;
            padding: 0; /* Remove padding to allow image to fill */
        }

        .start-square img {
            width: 100%;
            height: 100%;
            object-fit: cover;

            border-radius: 12px;
            filter: none;
        }

        .jail-square {
            grid-area: 1 / 11; /* Top-right corner */
            background-color: #6c757d; /* Grey */
            color: white;
        }

        .free-parking-square {
            grid-area: 1 / 1; /* Top-left corner */
            background-color: #17a2b8; /* Teal */
            color: white;
        }

        .go-to-jail-square {
            grid-area: 11 / 1; /* Bottom-left corner */
            background-color: #dc3545; /* Red */
            color: white;
        }

        /* Chance & Community Chest inspired squares */
        .chance-square {
            background-color: #ffc107; /* Orange/Amber */
        }

        .community-chest-square {
            background-color: #6f42c1; /* Purple */
            color: white;
        }

        /* Center of the board */
        .board-center {
            grid-area: 2 / 2 / 11 / 11; /* Fills the inner 9x9 grid */
            background-color: #e9ecef; /* Light grey */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            color: #555;
            font-weight: bold;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .board-center img {
            max-width: 80%;
            height: auto;
            opacity: 0.8;
        }

        /* Player Info Sidebar */
        .player-info {
            grid-column: 2; /* Second column for player info */
            background-color: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .player-info h2 {
            font-size: 1.8em;
            color: #4a148c; /* Deep purple */
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .player {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .player h3 {
            font-size: 1.4em;
            color: #007bff;
            margin-bottom: 8px;
        }

        .player p {
            font-size: 1em;
            margin-bottom: 5px;
        }

        .player span {
            font-weight: bold;
            color: #28a745;
        }

        /* Tools Area (Dice, Questions) */
        .tools-area {
            grid-column: 1 / -1; /* Spans all columns at the bottom */
            text-align: center;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.3em;
            background-color: #ff8c00; /* Dark orange */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        button:hover {
            background-color: #ff7f00; /* Slightly darker orange */
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #questionDisplay {
            min-height: 80px; /* Ensure space for question */
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
            text-align: center;
        }

        /* Player Token Styling (JavaScript will handle positioning) */
        .player-token {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.5s ease-in-out; /* Smooth movement */
            z-index: 10; /* Ensure tokens are above squares */
        }

        .player-token.player1 { background-color: #e74c3c; /* Red */ top: 5px; right: 5px; }
        .player-token.player2 { background-color: #3498db; /* Blue */ bottom: 5px; left: 5px; }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            body {
                grid-template-columns: 1fr 280px;
                gap: 20px;
            }
        }

        @media (max-width: 992px) {
            body {
                grid-template-columns: 1fr; /* Stack columns on smaller screens */
                grid-template-rows: auto auto 1fr auto; /* Header, Player Info, Board, Tools */
                padding: 15px;
            }
            .player-info {
                grid-column: 1;
                margin: 0 auto;
                width: 95%;
                max-width: 700px;
            }
            .game-container {
                grid-column: 1;
            }
            .tools-area {
                grid-column: 1;
                width: 95%;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2em;
            }
            header p {
                font-size: 1em;
            }
            .game-container {
                border-width: 5px;
            }
            .rule-square {
                font-size: 0.75em;
                padding: 3px;
            }
            .rule-square img {
                width: 25px;
                height: 25px;
            }
            .player-info h2 {
                font-size: 1.5em;
            }
            button {
                padding: 12px 25px;
                font-size: 1.1em;
            }
            #questionDisplay {
                font-size: 1em;
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
                gap: 15px;
            }
            header h1 {
                font-size: 1.8em;
            }
            header p {
                font-size: 0.9em;
            }
            .rule-square {
                font-size: 0.65em;
            }
            .player-info, .tools-area {
                padding: 15px;
            }
            button {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>المونوبولي اللغوي: رحلة إتقان العربية</h1>
        <p>انطلق في مغامرة شيقة لتعلم النحو والصرف والإعراب</p>
    </header>

    <div class="game-container" id="gameBoard">
        <div class="board-center">
            <img src="https://via.placeholder.com/200x200?text=شعار+المونوبولي+اللغوي" alt="شعار المونوبولي اللغوي">
            <p>المونوبولي اللغوي</p>
        </div>

        </div>

    <div class="player-info">
        <h2>اللاعبون</h2>
        <div class="player" id="player1Info">
            <h3>اللاعب الأول</h3>
            <p>النقاط: <span id="player1Score">0</span></p>
            <p>الموقع: <span id="player1Position">البداية</span></p>
            <p>القواعد المتقنة: <span id="player1RulesMastered">0</span></p>
        </div>
        <div class="player" id="player2Info">
            <h3>اللاعب الثاني</h3>
            <p>النقاط: <span id="player2Score">0</span></p>
            <p>الموقع: <span id="player2Position">البداية</span></p>
            <p>القواعد المتقنة: <span id="player2RulesMastered">0</span></p>
        </div>
    </div>

    <div class="tools-area">
        <button id="rollDiceButton">رمي النرد اللغوي!</button>
        <div id="questionDisplay">
            هنا سيظهر السؤال أو التحدي اللغوي بعد رمي النرد.
        </div>
        <button id="answerButton" style="display: none;">تحقق من الإجابة</button>
    </div>

    <script>
        const gameBoard = document.getElementById('gameBoard');
        const rollDiceButton = document.getElementById('rollDiceButton');
        const questionDisplay = document.getElementById('questionDisplay');
        const answerButton = document.getElementById('answerButton');

        const player1Score = document.getElementById('player1Score');
        const player1Position = document.getElementById('player1Position');
        const player1RulesMastered = document.getElementById('player1RulesMastered');

        const player2Score = document.getElementById('player2Score');
        const player2Position = document.getElementById('player2Position');
        const player2RulesMastered = document.getElementById('player2RulesMastered');

        // Game state
        let currentPlayer = 1;
        let playerPositions = {
            1: 0, // Player 1 starts at index 0 (Start square)
            2: 0
        };
        let playerScores = {
            1: 0,
            2: 0
        };
        let playerRulesMastered = {
            1: 0,
            2: 0
        };
        const boardSize = 11; // 11x11 grid
        const numSquares = (boardSize * 4) - 4; // Total squares around the perimeter

        // Define your game squares with categories and potential questions
        const squaresData = [
            { name: "البداية", type: "start", img: "https://via.placeholder.com/50x50/28a745/FFFFFF?text=GO", color: "#28a745" },
            { name: "المبتدأ والخبر", type: "rule", category: "نحو", question: "ما هي علامة رفع المبتدأ والخبر في حالة المثنى؟", answer: "الألف", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
            { name: "فرصة نحوية", type: "chance", img: "https://via.placeholder.com/50x50/ffc107/FFFFFF?text=؟" },
            { name: "الفعل الماضي", type: "rule", category: "صرف", question: "اذكر علامات بناء الفعل الماضي.", answer: "الفتح، الضم، السكون", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
            { name: "جمع المذكر السالم", type: "rule", category: "نحو", question: "كيف يُرفع جمع المذكر السالم ويُنصب ويُجر؟", answer: "يرفع بالواو وينصب ويجر بالياء", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
            { name: "السجن", type: "jail", img: "https://via.placeholder.com/50x50/6c757d/FFFFFF?text=سجن" },
            { name: "الأفعال الناسخة", type: "rule", category: "نحو", question: "ماذا تفعل كان وأخواتها بالاسم والخبر؟", answer: "ترفع الاسم وتنصب الخبر", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
            { name: "صندوق لغوي", type: "community_chest", img: "https://via.placeholder.com/50x50/6f42c1/FFFFFF?text=!" },
            { name: "المفاعيل", type: "rule", category: "نحو", question: "اذكر أنواع المفاعيل الخمسة في اللغة العربية.", answer: "المفعول به، المفعول المطلق، المفعول لأجله، المفعول فيه، المفعول معه", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
            { name: "اللام الشمسية والقمرية", type: "rule", category: "إملاء", question: "كلمة 'الشمس' هل اللام فيها شمسية أم قمرية ولماذا؟", answer: "شمسية لأن الحرف الذي يليها مشدد", img: "https://via.placeholder.com/50x50/fd7e14/FFFFFF?text=إملاء" },
            // Add more squares here to fill up the board perimeter
            // Example for one side (10 squares + 1 corner = 11 total for one side)
            // Go-To-Jail square needs to be at a specific index
            // This example creates a simple 4xN grid of squares for testing
        ];

        // Function to create board squares
        function createBoard() {
            // Top row (excluding corners, handled by specific styling)
            for (let i = 0; i < boardSize; i++) { // From start (11,11) to (1,11) then (1,10) to (1,1)
                const square = document.createElement('div');
                square.classList.add('rule-square');
                const index = i;
                square.dataset.index = index; // Store index for later use
                if (index < squaresData.length) {
                    const data = squaresData[index];
                    square.innerHTML = `<img src="${data.img}" alt="${data.name}"><p>${data.name}</p>`;
                    if (data.type === 'start') { square.classList.add('start-square'); }
                    else if (data.type === 'jail') { square.classList.add('jail-square'); }
                    else if (data.type === 'chance') { square.classList.add('chance-square'); }
                    else if (data.type === 'community_chest') { square.classList.add('community-chest-square'); }
                } else {
                     square.innerHTML = `<img src="https://via.placeholder.com/50x50/aaa/FFFFFF?text=قاعدة"><p>قاعدة ${index + 1}</p>`;
                }
                // Determine grid position based on index to form a spiral
                let row, col;
                if (index < boardSize) { // Top row (right to left)
                    row = 1;
                    col = boardSize - index;
                } else if (index < boardSize * 2 - 1) { // Left column (top to bottom)
                    row = 1 + (index - boardSize + 1);
                    col = 1;
                } else if (index < boardSize * 3 - 2) { // Bottom row (left to right)
                    row = boardSize;
                    col = 1 + (index - (boardSize * 2 - 2));
                } else { // Right column (bottom to top)
                    row = boardSize - (index - (boardSize * 3 - 3));
                    col = boardSize;
                }
                square.style.gridArea = `${row} / ${col}`;
                gameBoard.appendChild(square);
            }

            // More sophisticated square generation for full board perimeter
            // This is a simplified approach, a real Monopoly board has 40 squares
            // For a 11x11 grid, there are (11*4)-4 = 40 perimeter squares
            // We'll just populate some for demonstration.
            // For a full loop, you'd need to calculate grid-area for each of 40 squares.
            const totalSquares = (boardSize * 4) - 4; // 40 for 11x11
            const allSquaresData = [
                { name: "البداية", type: "start", img: "https://via.placeholder.com/50x50/28a745/FFFFFF?text=GO" },
                { name: "المبتدأ والخبر", type: "rule", category: "نحو", question: "ما هي علامة رفع المبتدأ والخبر في حالة المثنى؟", answer: "الألف", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الفعل المضارع", type: "rule", category: "صرف", question: "اذكر علامات رفع الفعل المضارع.", answer: "الضمة الظاهرة، الضمة المقدرة، ثبوت النون", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "فرصة نحوية", type: "chance", img: "https://via.placeholder.com/50x50/ffc107/FFFFFF?text=؟" },
                { name: "جمع المؤنث السالم", type: "rule", category: "نحو", question: "كيف يُنصب جمع المؤنث السالم؟", answer: "بالكسرة نيابة عن الفتحة", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الأفعال الخمسة", type: "rule", category: "صرف", question: "ما هي علامة نصب الأفعال الخمسة؟", answer: "حذف النون", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "السجن", type: "jail", img: "https://via.placeholder.com/50x50/6c757d/FFFFFF?text=سجن" }, // index 6
                { name: "الحروف الناسخة", type: "rule", category: "نحو", question: "ماذا تفعل إنّ وأخواتها بالاسم والخبر؟", answer: "تنصب الاسم وترفع الخبر", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "صندوق لغوي", type: "community_chest", img: "https://via.placeholder.com/50x50/6f42c1/FFFFFF?text=!" },
                { name: "المفعول المطلق", type: "rule", category: "نحو", question: "ما فائدة المفعول المطلق؟", answer: "توكيد الفعل، بيان نوعه، بيان عدده", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "المضاف والمضاف إليه", type: "rule", category: "نحو", question: "ما هو إعراب المضاف إليه دائماً؟", answer: "مجرور", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "موقف مجاني", type: "free_parking", img: "https://via.placeholder.com/50x50/17a2b8/FFFFFF?text=حر" }, // index 11
                { name: "المفعول لأجله", type: "rule", category: "نحو", question: "ما هو السؤال الذي نجيب عليه بالمفعول لأجله؟", answer: "لماذا؟", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "صندوق لغوي", type: "community_chest", img: "https://via.placeholder.com/50x50/6f42c1/FFFFFF?text=!" },
                { name: "الأسماء الموصولة", type: "rule", category: "نحو", question: "اذكر اسمين موصولين للعاقل وغير العاقل.", answer: "من، ما", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "فرصة نحوية", type: "chance", img: "https://via.placeholder.com/50x50/ffc107/FFFFFF?text=؟" },
                { name: "اسم الإشارة", type: "rule", category: "نحو", question: "ما هو اسم الإشارة للمثنى المذكر القريب؟", answer: "هذان", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "اذهب إلى السجن", type: "go_to_jail", img: "https://via.placeholder.com/50x50/dc3545/FFFFFF?text=!" }, // index 17
                { name: "التمييز", type: "rule", category: "نحو", question: "ما هو إعراب التمييز؟", answer: "منصوب", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "المنادى", type: "rule", category: "نحو", question: "اذكر أداة نداء للقريب والبعيد.", answer: "يا", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الممنوع من الصرف", type: "rule", category: "صرف", question: "ما هي علامة جر الممنوع من الصرف إذا لم يكن معرفاً بأل أو الإضافة؟", answer: "الفتحة نيابة عن الكسرة", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "صندوق لغوي", type: "community_chest", img: "https://via.placeholder.com/50x50/6f42c1/FFFFFF?text=!" },
                { name: "البدل", type: "rule", category: "نحو", question: "اذكر نوعين من أنواع البدل.", answer: "بدل كل من كل، بدل بعض من كل، بدل اشتمال", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "فرصة نحوية", type: "chance", img: "https://via.placeholder.com/50x50/ffc107/FFFFFF?text=؟" },
                { name: "الحال", type: "rule", category: "نحو", question: "كيف نسأل عن الحال؟", answer: "كيف؟", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "النعت", type: "rule", category: "نحو", question: "هل النعت يتبع المنعوت في الإعراب؟", answer: "نعم", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الفاعل ونائب الفاعل", type: "rule", category: "نحو", question: "ما هو إعراب الفاعل ونائب الفاعل؟", answer: "مرفوع", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الأفعال الناقصة", type: "rule", category: "صرف", question: "ما هي الأفعال الناقصة؟", answer: "كان وأخواتها", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "المفعول به", type: "rule", category: "نحو", question: "ما هو إعراب المفعول به؟", answer: "منصوب", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الأسماء الخمسة", type: "rule", category: "نحو", question: "ما هي علامة رفع الأسماء الخمسة؟", answer: "الواو", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "حروف الجر", type: "rule", category: "نحو", question: "اذكر ثلاثة من حروف الجر.", answer: "من، إلى، عن، على، في، الباء، الكاف، اللام", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "المفعول فيه", type: "rule", category: "نحو", question: "ما هو الاسم الآخر للمفعول فيه؟", answer: "ظرف الزمان والمكان", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الفعل الأمر", type: "rule", category: "صرف", question: "علامة بناء الفعل الأمر الصحيح الآخر.", answer: "السكون", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "صندوق لغوي", type: "community_chest", img: "https://via.placeholder.com/50x50/6f42c1/FFFFFF?text=!" },
                { name: "المصادر", type: "rule", category: "صرف", question: "ما هو المصدر؟", answer: "اسم يدل على حدث مجرد من الزمان", img: "https://via.placeholder.com/50x50/6c5ce7/FFFFFF?text=صرف" },
                { name: "المفعول معه", type: "rule", category: "نحو", question: "ماذا يأتي بعد واو المعية؟", answer: "اسم منصوب", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "فرصة نحوية", type: "chance", img: "https://via.placeholder.com/50x50/ffc107/FFFFFF?text=؟" },
                { name: "العدد والمعدود", type: "rule", category: "نحو", question: "كيف يوافق العدد 1 و 2 المعدود في التذكير والتأنيث؟", answer: "يوافقانه", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "الاستثناء", type: "rule", category: "نحو", question: "ما هي أدوات الاستثناء؟", answer: "إلا، غير، سوى، عدا، خلا، حاشا", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
                { name: "التوابع", type: "rule", category: "نحو", question: "اذكر أنواع التوابع الأربعة.", answer: "النعت، التوكيد، البدل، العطف", img: "https://via.placeholder.com/50x50/007bff/FFFFFF?text=نحو" },
            ];


            // Generate all squares around the perimeter
            for (let i = 0; i < totalSquares; i++) {
                const square = document.createElement('div');
                square.classList.add('rule-square');
                square.dataset.index = i; // Store index for later use

                const data = allSquaresData[i % allSquaresData.length]; // Cycle through available data
                square.innerHTML = `<img src="${data.img}" alt="${data.name}"><p>${data.name}</p>`;

                // Add specific classes for corners and special squares
                if (data.type === 'start') { square.classList.add('start-square', 'corner-square'); }
                else if (data.type === 'jail') { square.classList.add('jail-square', 'corner-square'); }
                else if (data.type === 'free_parking') { square.classList.add('free-parking-square', 'corner-square'); }
                else if (data.type === 'go_to_jail') { square.classList.add('go-to-jail-square', 'corner-square'); }
                else if (data.type === 'chance') { square.classList.add('chance-square'); }
                else if (data.type === 'community_chest') { square.classList.add('community-chest-square'); }

                // Calculate grid position for each square
                let row, col;
                if (i < boardSize) { // Top row (from right to left, including top-right corner)
                    row = 1;
                    col = boardSize - i;
                } else if (i < boardSize + boardSize - 2) { // Left column (from top-left corner to bottom-left)
                    row = 1 + (i - boardSize + 1);
                    col = 1;
                } else if (i < boardSize + boardSize - 2 + boardSize - 1) { // Bottom row (from bottom-left to bottom-right)
                    row = boardSize;
                    col = 1 + (i - (boardSize * 2 - 2));
                } else { // Right column (from bottom-right to top-right)
                    row = boardSize - (i - (boardSize * 3 - 3));
                    col = boardSize;
                }
                square.style.gridArea = `${row} / ${col}`;
                gameBoard.appendChild(square);
            }
        }

        // Function to create player tokens
        function createPlayerTokens() {
            const player1Token = document.createElement('div');
            player1Token.classList.add('player-token', 'player1');
            player1Token.id = 'player1Token';
            gameBoard.appendChild(player1Token);

            const player2Token = document.createElement('div');
            player2Token.classList.add('player-token', 'player2');
            player2Token.id = 'player2Token';
            gameBoard.appendChild(player2Token);

            updatePlayerTokenPosition(1);
            updatePlayerTokenPosition(2);
        }

        // Function to update player token position on the board
        function updatePlayerTokenPosition(playerNum) {
            const currentPositionIndex = playerPositions[playerNum];
            const targetSquare = document.querySelector(`.rule-square[data-index="${currentPositionIndex}"]`);

            if (targetSquare) {
                const token = document.getElementById(`player${playerNum}Token`);
                const squareRect = targetSquare.getBoundingClientRect();
                const boardRect = gameBoard.getBoundingClientRect();

                // Calculate position relative to gameBoard
                const offsetX = squareRect.left - boardRect.left;
                const offsetY = squareRect.top - boardRect.top;

                // Adjust for token size and padding within the square
                const tokenX = offsetX + (squareRect.width / 2) - (token.offsetWidth / 2);
                const tokenY = offsetY + (squareRect.height / 2) - (token.offsetHeight / 2);

                token.style.transform = `translate(${tokenX}px, ${tokenY}px)`;

                // Update UI text for position
                const squareData = allSquaresData[currentPositionIndex % allSquaresData.length];
                document.getElementById(`player${playerNum}Position`).textContent = squareData.name;
            }
        }

        // Function to handle rolling the dice
        rollDiceButton.addEventListener('click', () => {
            const diceRoll = Math.floor(Math.random() * 6) + 1; // Roll a 6-sided die
            questionDisplay.textContent = `لقد رميت النرد وتحركت ${diceRoll} خطوات.`;

            // Move current player
            let newPosition = (playerPositions[currentPlayer] + diceRoll) % totalSquares;
            playerPositions[currentPlayer] = newPosition;
            updatePlayerTokenPosition(currentPlayer);

            // Get current square data
            const currentSquareData = allSquaresData[newPosition];

            setTimeout(() => { // Delay for movement animation
                if (currentSquareData.type === 'rule') {
                    questionDisplay.innerHTML = `<h3>${currentSquareData.name}</h3><p>${currentSquareData.question}</p>`;
                    answerButton.style.display = 'block';
                    answerButton.onclick = () => checkAnswer(currentSquareData.answer);
                } else if (currentSquareData.type === 'chance') {
                    questionDisplay.innerHTML = `<h3>بطاقة فرصة نحوية!</h3><p>سؤال مفاجئ: ما هو إعراب كلمة 'قمر' في جملة 'رأيت قمراً يضيء السماء'؟</p>`;
                    answerButton.style.display = 'block';
                    answerButton.onclick = () => checkAnswer("مفعول به"); // Example hardcoded chance question
                } else if (currentSquareData.type === 'community_chest') {
                    questionDisplay.innerHTML = `<h3>صندوق لغوي!</h3><p>تهانينا! حصلت على 50 نقطة مكافأة.</p>`;
                    playerScores[currentPlayer] += 50;
                    updatePlayerScores();
                    answerButton.style.display = 'none';
                    setTimeout(switchPlayer, 2000);
                } else if (currentSquareData.type === 'jail') {
                    questionDisplay.innerHTML = `<h3>عفوًا، دخلت السجن!</h3><p>تخطى دورًا واحداً.</p>`;
                    answerButton.style.display = 'none';
                    setTimeout(switchPlayer, 2000); // Simple jail: skip turn
                } else if (currentSquareData.type === 'go_to_jail') {
                     questionDisplay.innerHTML = `<h3>اذهب إلى السجن مباشرة!</h3><p>ستنتقل إلى مربع السجن وتتخطى دورًا.</p>`;
                     playerPositions[currentPlayer] = 6; // Index of the jail square
                     updatePlayerTokenPosition(currentPlayer);
                     answerButton.style.display = 'none';
                     setTimeout(switchPlayer, 2000);
                } else { // Start or Free Parking
                    questionDisplay.innerHTML = `<h3>${currentSquareData.name}</h3><p>مكان استراحة أو بداية.</p>`;
                    answerButton.style.display = 'none';
                    setTimeout(switchPlayer, 2000);
                }
            }, 700); // Short delay for visual movement
        });

        // Function to check the answer
        function checkAnswer(correctAnswer) {
            const userAnswer = prompt("أدخل إجابتك:").trim();
            if (userAnswer && userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                questionDisplay.textContent = "إجابة صحيحة! أحسنت! +100 نقطة وإتقان قاعدة.";
                playerScores[currentPlayer] += 100;
                playerRulesMastered[currentPlayer]++;
            } else {
                questionDisplay.textContent = `إجابة خاطئة. الإجابة الصحيحة هي: "${correctAnswer}". -50 نقطة.`;
                playerScores[currentPlayer] = Math.max(0, playerScores[currentPlayer] - 50); // Don't go below 0
            }
            updatePlayerScores();
            answerButton.style.display = 'none';
            setTimeout(switchPlayer, 2000);
        }

        // Function to update player scores and mastered rules in UI
        function updatePlayerScores() {
            player1Score.textContent = playerScores[1];
            player1RulesMastered.textContent = playerRulesMastered[1];
            player2Score.textContent = playerScores[2];
            player2RulesMastered.textContent = playerRulesMastered[2];
        }

        // Function to switch player
        function switchPlayer() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            questionDisplay.textContent = `دور اللاعب ${currentPlayer}.`;
            // Highlight current player in sidebar
            document.getElementById('player1Info').style.border = (currentPlayer === 1) ? '2px solid #007bff' : '1px solid #ccc';
            document.getElementById('player2Info').style.border = (currentPlayer === 2) ? '2px solid #007bff' : '1px solid #ccc';
            rollDiceButton.disabled = false; // Enable dice for next player
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            createBoard();
            createPlayerTokens();
            updatePlayerScores();
            switchPlayer(); // Set initial player
        });
    </script>
</body>
</html>