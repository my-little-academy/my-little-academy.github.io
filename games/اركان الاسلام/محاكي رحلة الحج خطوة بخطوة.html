<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§ÙƒÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø¬: Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</title>
    <!-- ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ· Ù…Ù† Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=IBM+Plex+Sans+Arabic:wght[400,500]&display=swap" rel="stylesheet">
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ø³Ù… ÙˆØ§Ù„ØµÙØ­Ø© */
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background-color: #fcf8e3; /* Ù„ÙˆÙ† ÙƒØ±ÙŠÙ…ÙŠ ÙØ§ØªØ­ ÙŠØ±Ù…Ø² Ù„Ù„Ø³ÙƒÙŠÙ†Ø© */
            margin: 0;
            padding: 0;
            color: #333;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ©: Ø¯ÙˆØ§Ø¦Ø± Ù…ØªÙ…Ø±ÙƒØ²Ø© Ø®ÙÙŠÙØ© ØªØ­Ø§ÙƒÙŠ Ø§Ù„Ø·ÙˆØ§Ù Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø© */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            background: radial-gradient(circle at center, rgba(255, 235, 59, 0.05) 0%, transparent 20%),
                        radial-gradient(circle at center, rgba(255, 213, 79, 0.04) 20%, transparent 40%),
                        radial-gradient(circle at center, rgba(255, 193, 7, 0.03) 40%, transparent 60%);
            animation: concentricCircles 40s infinite linear;
            background-size: 200% 200%;
            background-repeat: no-repeat;
            background-position: center center;
        }

        @keyframes concentricCircles {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(360deg); opacity: 0.5; }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„ØªÙ…Ø¯Ø¯ */
            display: flex;
            flex-direction: column;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Header) */
        header {
            background: linear-gradient(135deg, #FFD700, #FFC107); /* ØªØ¯Ø±Ø¬ Ø°Ù‡Ø¨ÙŠ ÙŠØ±Ù…Ø² Ù„Ù„ÙƒØ¹Ø¨Ø© ÙˆØ¹Ø¸Ù…ØªÙ‡Ø§ */
            color: #333;
            padding: 30px;
            text-align: center;
            border-radius: 25px;
            margin-bottom: 40px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            border: 3px solid #FFAB00;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.4) 0%, transparent 70%);
            animation: headerSparkle 8s infinite ease-in-out alternate;
        }

        @keyframes headerSparkle {
            0% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.03); }
            100% { opacity: 0.7; transform: scale(1); }
        }

        h1 {
            font-family: 'Tajawal', sans-serif;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            margin: 0;
            font-size: 3.5em;
            animation: scaleIn 1s ease-out;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        header p {
            font-size: 1.2em;
            animation: fadeInUp 1s ease-out 0.3s forwards;
            opacity: 0;
            color: #555;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ø°ÙŠ ÙŠØªØ¨Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± */
        .kaaba-cursor {
            position: absolute;
            width: 50px;
            height: 50px;
            pointer-events: none;
            transition: transform 0.1s, opacity 0.1s;
            z-index: 1000;
            opacity: 0.9;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .game-area {
            background-color: #ffffff;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 3px solid #FFECB3;
            flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ù„ØªÙ…Ø¯Ø¯ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }

        .game-canvas {
            border: 2px solid #FFD700;
            border-radius: 15px;
            background-color: #fcfcfc;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
            width: 100%; /* Ø§Ø¬Ø¹Ù„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ ÙŠØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¶ */
            max-width: 700px; /* Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¹Ø±Ø¶ */
            height: 450px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø£Ùˆ Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© */
            display: block;
            margin-bottom: 20px;
        }

        .game-instructions {
            font-size: 1.3em;
            font-weight: bold;
            color: #E65100;
            margin-bottom: 20px;
            min-height: 30px; /* Ù„ØªØ¬Ù†Ø¨ Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„ØªØ®Ø·ÙŠØ· */
        }

        .game-feedback {
            font-size: 1.2em;
            color: #2e7d32;
            font-weight: bold;
            margin-top: 15px;
            min-height: 25px;
        }

        .game-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
            position: relative; /* Ù„ÙŠØ¹Ù…Ù„ z-index */
            z-index: 101; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù†ÙØ³Ù‡Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙØ§Ø¹Ù„ */
        }

        .action-button {
            background-color: #FFC107;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: all 0.2s ease-in-out;
            min-width: 120px;
            /* z-index: 100;  ØªÙ… Ù†Ù‚Ù„ z-index Ø¥Ù„Ù‰ game-controls */
        }

        .action-button:hover {
            background-color: #FFA000;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .action-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .hidden {
            display: none;
        }

        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Footer) */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #777;
            font-size: 1em;
            background-color: #fffaf0;
            border-top: 3px solid #FFECB3;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ÙŠØ© (Responsive Design) */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.8em;
            }
            header p {
                font-size: 1.1em;
            }
            .game-area {
                padding: 20px;
            }
            .game-canvas {
                height: 300px; /* Ø§Ø±ØªÙØ§Ø¹ Ø£Ù‚Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
            }
            .game-instructions {
                font-size: 1.1em;
            }
            .action-button {
                padding: 10px 20px;
                font-size: 1em;
                min-width: 100px;
            }
            .kaaba-cursor {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©: Ø¯ÙˆØ§Ø¦Ø± Ù…ØªÙ…Ø±ÙƒØ²Ø© Ø®ÙÙŠÙØ© ØªØ­Ø§ÙƒÙŠ Ø§Ù„Ø·ÙˆØ§Ù -->
    <div class="animated-background"></div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ø°ÙŠ ÙŠØªØ¨Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± -->
    <img id="kaabaCursor" class="kaaba-cursor hidden" src="../../images/New folder (4)/Untitled-1.png" alt="Ø§Ù„ÙƒØ¹Ø¨Ø©">

    <div class="container">
        <header>
            <h1>Ù…Ø­Ø§ÙƒÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø¬: Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</h1>
            <p>Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ø¸ÙŠÙ…Ø© Ø§Ù„Ø¢Ù†!</p>
        </header>

        <div class="game-area">
            <canvas id="hajjCanvas" class="game-canvas"></canvas>
            <p class="game-instructions" id="gameInstructions">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø­Ø¬! Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ùƒ.</p>
            <p class="game-feedback" id="gameFeedback"></p>
            <div class="game-controls" id="gameControls">
                <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© onclick Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ØªØµØ­ÙŠØ­ -->
                <button class="action-button" id="startButton">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© âœ¨</button>
                <button class="action-button hidden" id="nextButton">Ø§Ù„Ù…Ù†Ø³Ùƒ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
                <button class="action-button hidden" id="actionButton">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ</button>
            </div>
        </div>

        <footer>
            <p>Â© 2024 Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù… | Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø­Ø¬</p>
        </footer>
    </div>

    <script>
        console.log("Script loaded and DOMContentLoaded listener will be attached."); // Debug log at script load

        // Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ø°ÙŠ ÙŠØªØ¨Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø±
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOMContentLoaded fired. Initializing game elements."); // Debug log inside DOMContentLoaded

            const kaabaCursor = document.getElementById('kaabaCursor');
            let mouseX = 0, mouseY = 0;
            let cursorX = 0, cursorY = 0;
            let visible = false;

            const kaabaImages = [
                'https://cdn-icons-png.flaticon.com/512/3233/3233515.png', // Ø§Ù„ÙƒØ¹Ø¨Ø©
                'https://cdn-icons-png.flaticon.com/512/3233/3233529.png', // Ø®ÙŠÙ…Ø© Ø¹Ø±ÙØ©
                'https://cdn-icons-png.flaticon.com/512/3233/3233536.png'  // Ø­Ø¬Ø§Ø¬ ÙŠØ·ÙˆÙÙˆÙ†
            ];
            let currentKaabaImageIndex = 0;

            document.addEventListener('mousemove', function(e) {
                mouseX = e.clientX;
                mouseY = e.clientY;

                if (!visible) {
                    kaabaCursor.classList.remove('hidden');
                    visible = true;
                }
            });

            function animateCursor() {
                cursorX += (mouseX - cursorX - (kaabaCursor.offsetWidth / 2)) / 10;
                cursorY += (mouseY - cursorY - (kaabaCursor.offsetHeight / 2)) / 10;

                kaabaCursor.style.left = cursorX + 'px';
                kaabaCursor.style.top = cursorY + 'px';

                requestAnimationFrame(animateCursor);
            }

            animateCursor();

            kaabaCursor.addEventListener('click', function() {
                currentKaabaImageIndex = (currentKaabaImageIndex + 1) % kaabaImages.length;
                kaabaCursor.src = kaabaImages[currentKaabaImageIndex];
            });

            // Ù…Ù†Ø·Ù‚ Ù„Ø¹Ø¨Ø© Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø­Ø¬
            const canvas = document.getElementById('hajjCanvas');
            const ctx = canvas.getContext('2d');
            const instructionsElem = document.getElementById('gameInstructions');
            const feedbackElem = document.getElementById('gameFeedback');
            const startButton = document.getElementById('startButton');
            const nextButton = document.getElementById('nextButton');
            const actionButton = document.getElementById('actionButton');

            let currentStage = 0;
            let tawafCount = 0;
            let saiCount = 0;
            let jamaratCount = 0;
            let animationFrameId;

            // ØªØ¹Ø±ÙŠÙ Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ù‡Ù†Ø§ (ØªÙ… Ù†Ù‚Ù„Ù‡Ø§ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ReferenceError)
            const stages = [
                {
                    name: "Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ÙˆØ§Ù„Ù†ÙŠØ©",
                    instructions: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø¨Ø§Ù„Ø­Ø¬. Ø§Ù†ÙˆÙ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù†Ø³Ùƒ (Ø§Ù„Ø­Ø¬) ÙˆØ§Ø±ØªØ¯Ù Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¥Ø­Ø±Ø§Ù…. Ø«Ù… Ø§Ø¶ØºØ· 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ'.",
                    draw: drawIhramStage,
                    actionText: "Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ÙˆØ§Ù„Ù†ÙŠØ©",
                    action: () => {
                        feedbackElem.textContent = "Ø£Ø­Ø³Ù†Øª! Ù†ÙˆÙŠØª Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ÙˆØ¯Ø®Ù„Øª ÙÙŠ Ø§Ù„Ù†Ø³Ùƒ.";
                        actionButton.disabled = true;
                        nextButton.classList.remove('hidden');
                    }
                },
                {
                    name: "Ø§Ù„Ø·ÙˆØ§Ù Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø©",
                    instructions: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø·ÙˆØ§Ù Ù…Ù† Ø§Ù„Ø­Ø¬Ø± Ø§Ù„Ø£Ø³ÙˆØ¯. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ' Ù„Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø´ÙˆØ·. (7 Ø£Ø´ÙˆØ§Ø·)",
                    draw: drawTawafStage,
                    actionText: "Ø·ÙˆØ§Ù Ø´ÙˆØ·",
                    action: () => {
                        tawafCount++;
                        feedbackElem.textContent = `Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø´ÙˆØ· ${tawafCount} Ù…Ù† 7.`;
                        if (tawafCount === 7) {
                            feedbackElem.textContent = "Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø·ÙˆØ§Ù Ø¨Ù†Ø¬Ø§Ø­! ğŸ•‹";
                            actionButton.disabled = true;
                            nextButton.classList.remove('hidden');
                        }
                    }
                },
                {
                    name: "Ø§Ù„Ø³Ø¹ÙŠ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©",
                    instructions: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø³Ø¹ÙŠ Ù…Ù† Ø§Ù„ØµÙØ§. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ' Ù„Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø´ÙˆØ·. (7 Ø£Ø´ÙˆØ§Ø·)",
                    draw: drawSaiStage,
                    actionText: "Ø³Ø¹ÙŠ Ø´ÙˆØ·",
                    action: () => {
                        saiCount++;
                        feedbackElem.textContent = `Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø´ÙˆØ· ${saiCount} Ù…Ù† 7.`;
                        if (saiCount === 7) {
                            feedbackElem.textContent = "Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø³Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰";
                            actionButton.disabled = true;
                            nextButton.classList.remove('hidden');
                        }
                    }
                },
                {
                    name: "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ©",
                    instructions: "ÙŠÙˆÙ… Ø¹Ø±ÙØ© Ù‡Ùˆ Ø±ÙƒÙ† Ø§Ù„Ø­Ø¬ Ø§Ù„Ø£Ø¹Ø¸Ù…. Ø§Ù‚Ù ÙˆØ§Ø¯Ø¹Ù Ø§Ù„Ù„Ù‡ Ø¨Ù‚Ù„Ø¨ Ø®Ø§Ø´Ø¹. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ' Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆÙ.",
                    draw: drawArafatStage,
                    actionText: "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ© ÙˆØ§Ù„Ø¯Ø¹Ø§Ø¡",
                    action: () => {
                        feedbackElem.textContent = "ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ùƒ Ø§Ù„ÙˆÙ‚ÙˆÙ ÙˆØ§Ù„Ø¯Ø¹Ø§Ø¡ ÙÙŠ Ø¹Ø±ÙØ©. ğŸ¤²";
                        actionButton.disabled = true;
                        nextButton.classList.remove('hidden');
                    }
                },
                {
                    name: "Ø±Ù…ÙŠ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰",
                    instructions: "Ø§Ø±Ù…ÙŠ 7 Ø­ØµÙŠØ§Øª Ø¹Ù„Ù‰ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ' Ù„ÙƒÙ„ Ø­ØµØ§Ø©.",
                    draw: drawJamaratStage,
                    actionText: "Ø±Ù…ÙŠ Ø­ØµØ§Ø©",
                    action: () => {
                        jamaratCount++;
                        feedbackElem.textContent = `Ø±Ù…ÙŠØª ${jamaratCount} Ø­ØµØ§Ø© Ù…Ù† 7.`;
                        if (jamaratCount === 7) {
                            feedbackElem.textContent = "Ø£ØªÙ…Ù…Øª Ø±Ù…ÙŠ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø¨Ù†Ø¬Ø§Ø­! ğŸª¨";
                            actionButton.disabled = true;
                            nextButton.classList.remove('hidden');
                        }
                    }
                },
                {
                    name: "Ø§Ù„Ø­Ù„Ù‚ Ø£Ùˆ Ø§Ù„ØªÙ‚ØµÙŠØ±",
                    instructions: "Ø¨Ø¹Ø¯ Ø±Ù…ÙŠ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø©ØŒ Ø§Ø­Ù„Ù‚ Ø´Ø¹Ø±Ùƒ Ø£Ùˆ Ù‚ØµÙ‘Ø±Ù‡ Ù„Ù„ØªØ­Ù„Ù„ Ø§Ù„Ø£ØµØºØ±. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ'.",
                    draw: drawHairStage,
                    actionText: "Ø§Ù„Ø­Ù„Ù‚/Ø§Ù„ØªÙ‚ØµÙŠØ±",
                    action: () => {
                        feedbackElem.textContent = "Ø£ØªÙ…Ù…Øª Ø§Ù„ØªØ­Ù„Ù„ Ø§Ù„Ø£ØµØºØ±. Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒ! ğŸ’‡";
                        actionButton.disabled = true;
                        nextButton.classList.remove('hidden');
                    }
                },
                {
                    name: "Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹",
                    instructions: "Ø£Ø¯Ø§Ø¡ Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹ Ù‡Ùˆ Ø¢Ø®Ø± Ø¹Ù‡Ø¯Ùƒ Ø¨Ø§Ù„Ø¨ÙŠØª Ø§Ù„Ø­Ø±Ø§Ù…. Ø§Ù†Ù‚Ø± 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø³Ùƒ' Ù„Ø¥ÙƒÙ…Ø§Ù„ ÙƒÙ„ Ø´ÙˆØ·. (7 Ø£Ø´ÙˆØ§Ø·)",
                    draw: drawTawafStage, // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ù
                    actionText: "Ø·ÙˆØ§Ù Ø´ÙˆØ·",
                    action: () => {
                        tawafCount++; // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„ÙƒÙ† Ù†ÙØ¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ†Ù‡
                        feedbackElem.textContent = `Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø´ÙˆØ· ${tawafCount} Ù…Ù† 7.`;
                        if (tawafCount === 7) {
                            feedbackElem.textContent = "Ø£ØªÙ…Ù…Øª Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­! ğŸ•‹";
                            actionButton.disabled = true;
                            nextButton.classList.remove('hidden');
                        }
                    }
                }
            ];

            // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø³Ù… Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©
            function drawBackground() {
                ctx.fillStyle = '#fcfcfc';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            function drawPilgrim(x, y, radius = 10, color = '#f2f2f2') { // Ù„ÙˆÙ† Ø§Ù„Ø¥Ø­Ø±Ø§Ù…
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.closePath();
            }

            function drawKaaba(x, y, size = 100) {
                const halfSize = size / 2;
                ctx.fillStyle = '#333'; // Ù„ÙˆÙ† Ø§Ù„ÙƒØ¹Ø¨Ø©
                ctx.fillRect(x - halfSize, y - halfSize, size, size);
                ctx.strokeStyle = '#FFD700'; // Ø®Ø· Ø°Ù‡Ø¨ÙŠ
                ctx.lineWidth = 3;
                ctx.strokeRect(x - halfSize, y - halfSize, size, size);

                // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø¨Ø³ÙŠØ·Ø© (Ø¨Ø§Ø¨ Ø°Ù‡Ø¨ÙŠ)
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(x - (size * 0.15), y - halfSize, size * 0.3, size * 0.4);
            }

            function drawIhramStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                ctx.font = '20px Tajawal';
                ctx.fillStyle = '#555';
                ctx.textAlign = 'center'; // Align text to center for consistent positioning
                ctx.fillText('Ø§Ù„Ù…ÙŠÙ‚Ø§Øª', canvas.width / 2, canvas.height / 2 - 50);
                drawPilgrim(canvas.width / 2, canvas.height / 2 + 20, 20); // Ø´Ø®ØµÙŠØ© Ø¨Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¥Ø­Ø±Ø§Ù… (Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶/ÙØ§ØªØ­)
                ctx.fillText('Ø§Ø±ØªØ¯Ø§Ø¡ Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ÙˆØ§Ù„Ù†ÙŠØ©', canvas.width / 2, canvas.height / 2 + 60);
                ctx.textAlign = 'start'; // Reset for other drawings
            }

            function drawTawafStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText + ` (${tawafCount + 1}/7)`;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(canvas.width, canvas.height) / 2.5; // Make radius responsive

                // Ø±Ø³Ù… Ø§Ù„ÙƒØ¹Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
                drawKaaba(centerX, centerY, Math.min(canvas.width, canvas.height) / 5); // Make Kaaba size responsive

                // Ø±Ø³Ù… Ù…Ø³Ø§Ø± Ø§Ù„Ø·ÙˆØ§Ù (Ø¯Ø§Ø¦Ø±Ø© Ø®ÙÙŠÙØ©)
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]); // Ø®Ø· Ù…ØªÙ‚Ø·Ø¹
                ctx.stroke();
                ctx.setLineDash([]); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø§Ø¯ÙŠ

                // Ø±Ø³Ù… Ø§Ù„Ø­Ø¬Ø± Ø§Ù„Ø£Ø³ÙˆØ¯ (Ù†Ù‚Ø·Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø·ÙˆØ§Ù)
                ctx.beginPath();
                ctx.arc(centerX + radius, centerY, 8, 0, Math.PI * 2);
                ctx.fillStyle = 'black';
                ctx.fill();
                ctx.closePath();
                ctx.font = '14px IBM Plex Sans Arabic';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'right'; // Align text to right for consistent positioning
                ctx.fillText('Ø§Ù„Ø­Ø¬Ø± Ø§Ù„Ø£Ø³ÙˆØ¯', centerX + radius - 10, centerY + 25);
                ctx.textAlign = 'start'; // Reset for other drawings

                // Ø±Ø³Ù… Ø§Ù„Ø­Ø§Ø¬ (Ø§Ù„Ø­Ø±ÙƒØ© Ø³ØªÙƒÙˆÙ† Ø±Ù…Ø²ÙŠØ© Ø¨Ø§Ù„Ù†Ù‚Ø±)
                const angle = (tawafCount % 7) * (Math.PI * 2 / 7) - Math.PI / 2; // Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ø¬
                const pilgrimX = centerX + radius * Math.cos(angle);
                const pilgrimY = centerY + radius * Math.sin(angle);
                drawPilgrim(pilgrimX, pilgrimY, 15); // Ø´Ø®ØµÙŠØ© Ø§Ù„Ø­Ø§Ø¬
            }

            function drawSaiStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText + ` (${saiCount + 1}/7)`;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                const startX = canvas.width / 4;
                const endX = canvas.width * 3 / 4;
                const centerY = canvas.height / 2;
                const mountainHeight = Math.min(canvas.width, canvas.height) / 4;

                // Ø±Ø³Ù… Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©
                ctx.fillStyle = '#8B4513'; // Ù„ÙˆÙ† Ø¨Ù†ÙŠ
                ctx.fillRect(startX - 20, centerY - mountainHeight / 2, 40, mountainHeight); // Ø§Ù„ØµÙØ§
                ctx.fillRect(endX - 20, centerY - mountainHeight / 2, 40, mountainHeight); // Ø§Ù„Ù…Ø±ÙˆØ©

                ctx.font = '18px Tajawal';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.fillText('Ø§Ù„ØµÙØ§', startX, centerY - mountainHeight / 2 - 10);
                ctx.fillText('Ø§Ù„Ù…Ø±ÙˆØ©', endX, centerY - mountainHeight / 2 - 10);

                // Ø±Ø³Ù… Ù…Ø³Ø§Ø± Ø§Ù„Ø³Ø¹ÙŠ
                ctx.beginPath();
                ctx.moveTo(startX, centerY);
                ctx.lineTo(endX, centerY);
                ctx.strokeStyle = '#689F38'; // Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù…Ø³Ø§Ø±
                ctx.lineWidth = 3;
                ctx.stroke();

                // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‡Ø±ÙˆÙ„Ø© (Ø±Ù…Ø²ÙŠØ©)
                const herwalaWidth = (endX - startX) * 0.4;
                ctx.fillStyle = 'rgba(144, 238, 144, 0.3)'; // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ø´ÙØ§Ù
                ctx.fillRect(startX + (endX - startX - herwalaWidth) / 2, centerY - 20, herwalaWidth, 40);
                ctx.fillText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‡Ø±ÙˆÙ„Ø©', canvas.width / 2, centerY + 50);
                ctx.textAlign = 'start'; // Reset

                // Ø±Ø³Ù… Ø§Ù„Ø­Ø§Ø¬ (Ø§Ù„Ø­Ø±ÙƒØ© Ø³ØªÙƒÙˆÙ† Ø±Ù…Ø²ÙŠØ© Ø¨Ø§Ù„Ù†Ù‚Ø±)
                const pilgrimX = (saiCount % 2 === 0) ? startX + 50 : endX - 50; // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ§
                drawPilgrim(pilgrimX, centerY, 15);
            }

            function drawArafatStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                ctx.font = '24px Tajawal';
                ctx.fillStyle = '#555';
                ctx.textAlign = 'center';
                ctx.fillText('Ø¬Ø¨Ù„ Ø§Ù„Ø±Ø­Ù…Ø©', canvas.width / 2, canvas.height / 2 - 80);

                // Ø±Ø³Ù… Ø¬Ø¨Ù„ Ø¨Ø³ÙŠØ·
                const mountainBase = canvas.height * 0.8;
                const mountainPeakX = canvas.width / 2;
                const mountainPeakY = canvas.height / 2 - 50;
                const mountainWidth = canvas.width * 0.6;

                ctx.beginPath();
                ctx.moveTo(mountainPeakX - mountainWidth / 2, mountainBase);
                ctx.lineTo(mountainPeakX, mountainPeakY);
                ctx.lineTo(mountainPeakX + mountainWidth / 2, mountainBase);
                ctx.fillStyle = '#A9A9A9'; // Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù„Ù„Ø¬Ø¨Ù„
                ctx.fill();
                ctx.closePath();

                // Ø±Ø³Ù… Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø­ÙˆÙ„ Ø§Ù„Ø¬Ø¨Ù„
                drawPilgrim(canvas.width / 2 - 80, mountainBase - 50, 15);
                drawPilgrim(canvas.width / 2 + 80, mountainBase - 70, 15);
                drawPilgrim(canvas.width / 2, mountainBase - 100, 15);

                ctx.font = '18px IBM Plex Sans Arabic';
                ctx.fillStyle = '#333';
                ctx.fillText('ÙŠÙˆÙ… Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙˆØ§Ù„ÙˆÙ‚ÙˆÙ', canvas.width / 2, mountainBase + 50);
                ctx.textAlign = 'start'; // Reset
            }

            function drawJamaratStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText + ` (${jamaratCount + 1}/7)`;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                const jamarahX = canvas.width / 2;
                const jamarahY = canvas.height / 2;
                const jamarahWidth = 40;
                const jamarahHeight = 160;

                // Ø±Ø³Ù… Ø§Ù„Ø¬Ù…Ø±Ø© (Ø¹Ù…ÙˆØ¯ Ø¨Ø³ÙŠØ·)
                ctx.fillStyle = '#8B0000'; // Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ†
                ctx.fillRect(jamarahX - jamarahWidth / 2, jamarahY - jamarahHeight / 2, jamarahWidth, jamarahHeight);
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 2;
                ctx.strokeRect(jamarahX - jamarahWidth / 2, jamarahY - jamarahHeight / 2, jamarahWidth, jamarahHeight);

                ctx.font = '20px Tajawal';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.fillText('Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰', jamarahX, jamarahY - jamarahHeight / 2 - 20);

                // Ø±Ø³Ù… Ø§Ù„Ø­ØµÙ‰ (Ø±Ù…Ø²ÙŠØ©)
                for (let i = 0; i < jamaratCount; i++) {
                    ctx.beginPath();
                    ctx.arc(jamarahX + Math.random() * 30 - 15, jamarahY + Math.random() * 30 - 15 + (i * 5), 5, 0, Math.PI * 2);
                    ctx.fillStyle = '#696969'; // Ø±Ù…Ø§Ø¯ÙŠ Ù„Ù„Ø­ØµÙ‰
                    ctx.fill();
                    ctx.closePath();
                }

                drawPilgrim(jamarahX - 150, jamarahY + 50, 20); // Ø§Ù„Ø­Ø§Ø¬ ÙŠØ±Ù…ÙŠ
                ctx.font = '16px IBM Plex Sans Arabic';
                ctx.fillStyle = '#555';
                ctx.fillText('Ø§Ø±Ù…ÙŠ Ø§Ù„Ø­ØµÙ‰', jamarahX - 190, jamarahY + 100);
                ctx.textAlign = 'start'; // Reset
            }

            function drawHairStage() {
                drawBackground();
                instructionsElem.textContent = stages[currentStage].instructions;
                actionButton.textContent = stages[currentStage].actionText;
                actionButton.disabled = false;
                nextButton.classList.add('hidden');

                const pilgrimX = canvas.width / 2;
                const pilgrimY = canvas.height / 2;

                // Ø±Ø³Ù… Ø´Ø®ØµÙŠØ© Ù…Ø¨Ø³Ø·Ø©
                ctx.beginPath();
                ctx.arc(pilgrimX, pilgrimY - 30, 30, 0, Math.PI * 2); // Ø§Ù„Ø±Ø£Ø³
                ctx.fillStyle = '#f2f2f2';
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(pilgrimX - 40, pilgrimY, 80, 100); // Ø§Ù„Ø¬Ø³Ù…
                ctx.fillStyle = '#f2f2f2';
                ctx.fill();
                ctx.closePath();

                // Ø´Ø¹Ø± (Ù‚Ø¨Ù„ Ø§Ù„Ø­Ù„Ù‚)
                ctx.beginPath();
                ctx.arc(pilgrimX, pilgrimY - 55, 35, 0, Math.PI, true); // Ø´ÙƒÙ„ Ø´Ø¹Ø±
                ctx.fillStyle = '#8B4513'; // Ù„ÙˆÙ† Ø¨Ù†ÙŠ Ù„Ù„Ø´Ø¹Ø±
                ctx.fill();
                ctx.closePath();

                ctx.font = '20px Tajawal';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.fillText('Ø§Ù„Ø­Ù„Ù‚ Ø£Ùˆ Ø§Ù„ØªÙ‚ØµÙŠØ±', pilgrimX, pilgrimY + 150);
                ctx.textAlign = 'start'; // Reset
            }


            // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function startGame() {
                console.log("startGame() called. Hiding start button, showing game controls.");
                startButton.classList.add('hidden');
                nextButton.classList.remove('hidden');
                actionButton.classList.remove('hidden');
                currentStage = 0;
                tawafCount = 0;
                saiCount = 0;
                jamaratCount = 0;
                loadStage(currentStage);
            }

            function loadStage(stageIndex) {
                console.log("loadStage() called for stage:", stageIndex);
                if (stageIndex < stages.length) {
                    currentStage = stageIndex;
                    const stage = stages[currentStage];
                    instructionsElem.textContent = stage.instructions;
                    actionButton.textContent = stage.actionText;
                    actionButton.disabled = false;
                    nextButton.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
                    feedbackElem.textContent = ''; // Ù…Ø³Ø­ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø³Ø§Ø¨Ù‚Ø©

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ Ø°Ù„Ùƒ
                    if (stage.name === "Ø§Ù„Ø·ÙˆØ§Ù Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø©" || stage.name === "Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹") {
                        tawafCount = 0;
                        actionButton.textContent = stage.actionText + ` (${tawafCount + 1}/7)`;
                    } else if (stage.name === "Ø§Ù„Ø³Ø¹ÙŠ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©") {
                        saiCount = 0;
                        actionButton.textContent = stage.actionText + ` (${saiCount + 1}/7)`;
                    } else if (stage.name === "Ø±Ù…ÙŠ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰") {
                        jamaratCount = 0;
                        actionButton.textContent = stage.actionText + ` (${jamaratCount + 1}/7)`;
                    }

                    drawCurrentStage(); // Ø±Ø³Ù… Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                } else {
                    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
                    instructionsElem.textContent = "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬ Ø¨Ù†Ø¬Ø§Ø­! Ø­Ø¬ Ù…Ø¨Ø±ÙˆØ± ÙˆØ³Ø¹ÙŠ Ù…Ø´ÙƒÙˆØ± ÙˆØ°Ù†Ø¨ Ù…ØºÙÙˆØ±! ğŸ‰";
                    feedbackElem.textContent = "Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠØ±Ø²Ù‚Ù†Ø§ ÙˆØ¥ÙŠØ§ÙƒÙ… Ø­Ø¬ Ø¨ÙŠØªÙ‡ Ø§Ù„Ø­Ø±Ø§Ù….";
                    feedbackElem.style.color = '#FF8F00';
                    actionButton.classList.add('hidden');
                    nextButton.classList.add('hidden');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                    let restartButton = document.getElementById('restartButton');
                    if (!restartButton) { // Create only if it doesn't exist
                        restartButton = document.createElement('button');
                        restartButton.id = 'restartButton';
                        restartButton.classList.add('action-button');
                        restartButton.textContent = 'Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©';
                        restartButton.addEventListener('click', () => {
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                            currentStage = 0;
                            tawafCount = 0;
                            saiCount = 0;
                            jamaratCount = 0;
                            loadStage(currentStage);
                            restartButton.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                            startButton.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø£ØµÙ„ÙŠ
                            actionButton.classList.remove('hidden'); // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡
                            nextButton.classList.remove('hidden'); // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
                            instructionsElem.textContent = stages[0].instructions; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
                            feedbackElem.textContent = ''; // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                        });
                        document.getElementById('gameControls').appendChild(restartButton);
                    } else {
                        restartButton.classList.remove('hidden');
                    }
                }
            }

            function drawCurrentStage() {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† stages Ù…Ø¹Ø±ÙØ© Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§
                if (typeof stages === 'undefined' || !stages[currentStage]) {
                    console.error("Error: 'stages' array is not defined or currentStage is out of bounds.");
                    return;
                }
                console.log("drawCurrentStage() called for stage:", stages[currentStage].name);
                const stage = stages[currentStage];
                if (stage && stage.draw) {
                    stage.draw();
                }
            }

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            if (startButton) {
                startButton.addEventListener('click', function() { // Ø§Ø³ØªØ®Ø¯Ø§Ù… function() Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØµØ­ÙŠØ­
                    console.log("Start button clicked via event listener!");
                    startGame();
                });
            } else {
                console.error("Error: Start button element not found!");
            }

            if (nextButton) {
                nextButton.addEventListener('click', () => {
                    console.log("Next button clicked!");
                    loadStage(currentStage + 1);
                });
            } else {
                console.error("Error: Next button element not found!");
            }

            if (actionButton) {
                actionButton.addEventListener('click', () => {
                    console.log("Action button clicked!");
                    const stage = stages[currentStage];
                    if (stage && stage.action) {
                        stage.action();
                        drawCurrentStage();
                    }
                });
            } else {
                console.error("Error: Action button element not found!");
            }

            // Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            drawBackground();
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ø±Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù…Ø®ÙÙŠ
            if (startButton) startButton.classList.remove('hidden');
            if (nextButton) nextButton.classList.add('hidden');
            if (actionButton) actionButton.classList.add('hidden');
        });
    </script>
</body>
</html>
