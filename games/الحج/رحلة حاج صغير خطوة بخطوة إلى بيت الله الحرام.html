<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø­Ù„Ø© Ø­Ø§Ø¬ ØµØºÙŠØ±: Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ø¥Ù„Ù‰ Ø¨ÙŠØª Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø§Ù… ğŸ•‹</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-bg: #E0FFFF; /* Light Cyan */
            --header-bg: #20B2AA; /* Light Sea Green */
            --header-text: white;
            --container-bg: white;
            --section-bg: #F0F8FF; /* AliceBlue */
            --card-bg: #ADD8E6; /* Light Blue */
            --card-border: #87CEEB; /* Sky Blue */
            --button-primary: #32CD32; /* Lime Green */
            --button-hover: #228B22; /* Forest Green */
            --correct-color: #28A745; /* Green */
            --wrong-color: #DC3545; /* Red */
            --text-color: #333333;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-strong: rgba(0, 0, 0, 0.25);
            --border-radius-md: 15px;
            --border-radius-lg: 30px;
            --accent-color: #FFD700; /* Gold */
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--primary-bg);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            line-height: 1.8;
            overflow-x: hidden;
            direction: rtl;
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--header-bg) 0%, #1a8f8a 100%);
            color: var(--header-text);
            padding: 40px 20px;
            text-align: center;
            width: 100%;
            border-bottom-left-radius: var(--border-radius-lg);
            border-bottom-right-radius: var(--border-radius-lg);
            box-shadow: 0 5px 20px var(--shadow-strong);
            margin-bottom: 30px;
            animation: fadeInDown 1.2s ease-out;
        }

        h1 {
            font-family: 'Amiri', serif;
            font-size: 3.8rem;
            margin: 0;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.8rem;
            margin-top: 10px;
            color: var(--accent-color);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            font-weight: bold;
        }

        /* Main Container */
        .main-container {
            background-color: var(--container-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 25px var(--shadow-strong);
            padding: 30px;
            margin-bottom: 40px;
            width: 90%;
            max-width: 1200px;
            border: 4px solid var(--header-bg);
            animation: scaleIn 0.8s ease-out;
        }

        /* Sections */
        section {
            background-color: var(--section-bg);
            border-radius: var(--border-radius-md);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px var(--shadow-light);
            text-align: center;
        }

        h2 {
            font-size: 2.8rem;
            color: #20B2AA; /* Light Sea Green */
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 10px;
        }
        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background-color: var(--accent-color);
            border-radius: 2px;
        }

        .intro-text, .end-text {
            font-size: 1.5rem;
            line-height: 2.0;
            margin-bottom: 30px;
            color: #555;
        }

        .action-button {
            background-color: var(--button-primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: var(--border-radius-lg);
            font-size: 1.6rem;
            cursor: pointer;
            margin-top: 20px;
            display: inline-block;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .action-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-3px);
        }
        .action-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Game Area */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-status {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            border-radius: var(--border-radius-md);
            padding: 15px 25px;
            font-size: 1.6rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        .mansek-progress {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 30px;
            height: 25px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--button-primary);
            border-radius: 10px;
            transition: width 0.5s ease-out;
        }

        .game-map {
            position: relative;
            width: 100%;
            height: 500px; /* Adjust as needed */
            background-image: url('https://via.placeholder.com/1000x500/F5DEB3/000000?text=Ø®Ø±ÙŠØ·Ø©+Ù…Ù†Ø§Ø³Ùƒ+Ø§Ù„Ø­Ø¬'); /* Placeholder for a map image */
            background-size: cover;
            background-position: center;
            border-radius: var(--border-radius-md);
            box-shadow: 0 5px 15px var(--shadow-strong);
            margin-bottom: 30px;
        }

        .map-point {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: var(--accent-color);
            border: 4px solid #FF8C00; /* Darker Gold */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            transition: transform 0.2s ease-in-out, background-color 0.2s;
            z-index: 10;
        }
        .map-point:hover {
            transform: scale(1.1);
        }
        .map-point.active {
            background-color: var(--correct-color);
            border-color: #1a6d2f;
            animation: pulse 1s infinite alternate;
        }

        .pilgrim-character {
            position: absolute;
            width: 80px;
            height: 80px;
            background-image: url('https://via.placeholder.com/80x80/87CEEB/FFFFFF?text=ğŸš¶'); /* Pilgrim icon */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            left: 10%; /* Initial position */
            top: 50%;
            transform: translate(-50%, -50%);
            transition: all 1s ease-in-out; /* Smooth movement */
            z-index: 15;
        }

        /* Mansek Details Popup */
        .mansek-details-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s;
        }
        .mansek-details-popup.active {
            opacity: 1;
            visibility: visible;
        }
        .popup-content {
            background-color: var(--container-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-strong);
            transform: scale(0.9);
            transition: transform 0.3s ease-in-out;
        }
        .mansek-details-popup.active .popup-content {
            transform: scale(1);
        }

        .popup-content h3 {
            font-size: 2.5rem;
            color: var(--header-bg);
            margin-bottom: 20px;
        }
        .popup-img {
            max-width: 80%;
            height: 200px;
            object-fit: contain;
            margin-bottom: 20px;
            border-radius: var(--border-radius-md);
            box-shadow: 0 3px 10px var(--shadow-light);
        }
        .popup-content p {
            font-size: 1.4rem;
            line-height: 1.8;
            margin-bottom: 25px;
            color: #444;
        }

        /* Mini-Game Container */
        .mini-game-container {
            width: 100%;
            background-color: var(--section-bg);
            border-radius: var(--border-radius-md);
            padding: 30px;
            box-shadow: 0 3px 10px var(--shadow-light);
            margin-top: 20px;
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
        }
        .mini-game-container h3 {
            font-size: 2.2rem;
            color: #20B2AA;
            margin-bottom: 20px;
        }
        .mini-game-instruction {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #555;
        }

        /* Mini-Game Specific Styles (Examples) */
        /* Ihram Game */
        #ihram-game .ihram-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        #ihram-game .ihram-option-card {
            background-color: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: var(--border-radius-md);
            padding: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
        }
        #ihram-game .ihram-option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-light);
        }
        #ihram-game .ihram-option-card.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
        }
        #ihram-game .ihram-option-card.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
        }
        #ihram-game img {
            max-width: 100px;
            margin-bottom: 10px;
        }

        /* Tawaf Game */
        #tawaf-game .kaaba-area {
            position: relative;
            width: 300px;
            height: 300px;
            background-image: url('https://via.placeholder.com/300x300/BDB76B/FFFFFF?text=Ø§Ù„ÙƒØ¹Ø¨Ø©'); /* Kaaba placeholder */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #tawaf-game .tawaf-count {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-top: 15px;
        }
        #tawaf-game .pilgrim-icon {
            font-size: 5rem;
            color: #6A5ACD;
            cursor: pointer;
            animation: rotatePilgrim 4s linear infinite; /* Example animation */
        }
        @keyframes rotatePilgrim {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Jamarat Game */
        #jamarat-game .jamarat-targets {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        #jamarat-game .jamara-target {
            width: 120px;
            height: 120px;
            background-color: #ccc;
            border-radius: 50%;
            border: 3px dashed #888;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: #666;
            transition: background-color 0.2s, border-color 0.2s;
        }
        #jamarat-game .jamara-target.active {
            background-color: #FFDAB9;
            border-color: #FFA07A;
        }
        #jamarat-game .pebbles-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            min-height: 80px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: var(--border-radius-md);
        }
        #jamarat-game .pebble {
            width: 40px;
            height: 40px;
            background-color: #696969; /* Dim Gray */
            border-radius: 50%;
            cursor: grab;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .feedback-message {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
            min-height: 40px;
        }
        .end-img {
            max-width: 250px;
            height: auto;
            margin-top: 20px;
            border-radius: var(--border-radius-md);
            box-shadow: 0 5px 15px var(--shadow-strong);
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            opacity: 0;
            animation: confetti-fall 5s ease-out forwards, confetti-rotate 3s ease-in-out infinite;
        }
        @keyframes confetti-fall {
            0% { top: -20px; opacity: 1; }
            100% { top: 100vh; opacity: 0.7; }
        }
        @keyframes confetti-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes fadeInDown {
            0% { opacity: 0; transform: translateY(-50px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes scaleIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.7); }
            100% { transform: scale(1.05); box-shadow: 0 0 25px rgba(255, 215, 0, 1); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 { font-size: 2.8rem; }
            .subtitle { font-size: 1.5rem; }
            .main-container { padding: 20px; width: 95%; }
            h2 { font-size: 2rem; }
            .intro-text, .end-text { font-size: 1.2rem; }
            .action-button { font-size: 1.3rem; padding: 12px 30px; }
            .game-status { font-size: 1.4rem; padding: 10px 20px; }
            .game-map { height: 350px; }
            .map-point { width: 50px; height: 50px; font-size: 1rem; }
            .pilgrim-character { width: 60px; height: 60px; }
            .popup-content { padding: 20px; max-width: 90%; }
            .popup-content h3 { font-size: 2rem; }
            .popup-img { height: 150px; }
            .popup-content p { font-size: 1.2rem; }
            .mini-game-container h3 { font-size: 1.8rem; }
            .mini-game-instruction { font-size: 1.1rem; }
            #ihram-game .ihram-option-card { font-size: 1.2rem; padding: 10px; }
            #ihram-game img { max-width: 80px; }
            #tawaf-game .kaaba-area { width: 250px; height: 250px; }
            #tawaf-game .tawaf-count { font-size: 2rem; }
            #tawaf-game .pilgrim-icon { font-size: 4rem; }
            #jamarat-game .jamarat-targets { gap: 15px; }
            #jamarat-game .jamara-target { width: 100px; height: 100px; font-size: 1.5rem; }
            #jamarat-game .pebble { width: 30px; height: 30px; }
        }

        @media (max-width: 480px) {
            header { padding: 30px 10px; }
            h1 { font-size: 2.2rem; }
            .subtitle { font-size: 1.2rem; }
            .main-container { padding: 15px; }
            h2 { font-size: 1.8rem; }
            .intro-text, .end-text { font-size: 1rem; }
            .action-button { font-size: 1.1rem; padding: 10px 25px; }
            .game-status { font-size: 1.2rem; padding: 8px 15px; }
            .game-map { height: 250px; }
            .map-point { width: 40px; height: 40px; font-size: 0.8rem; }
            .pilgrim-character { width: 50px; height: 50px; }
            .popup-content h3 { font-size: 1.8rem; }
            .popup-img { height: 120px; }
            .popup-content p { font-size: 1rem; }
            .mini-game-container { padding: 15px; }
            .mini-game-container h3 { font-size: 1.6rem; }
            .mini-game-instruction { font-size: 0.9rem; }
            #ihram-game .ihram-options { flex-direction: column; gap: 10px; }
            #ihram-game .ihram-option-card { font-size: 1rem; padding: 8px; }
            #ihram-game img { max-width: 60px; }
            #tawaf-game .kaaba-area { width: 200px; height: 200px; }
            #tawaf-game .tawaf-count { font-size: 1.8rem; }
            #tawaf-game .pilgrim-icon { font-size: 3rem; }
            #jamarat-game .jamarat-targets { flex-direction: column; gap: 10px; }
            #jamarat-game .jamara-target { width: 80px; height: 80px; font-size: 1.2rem; }
            #jamarat-game .pebble { width: 25px; height: 25px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ø±Ø­Ù„Ø© Ø­Ø§Ø¬ ØµØºÙŠØ±: Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ø¥Ù„Ù‰ Ø¨ÙŠØª Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø§Ù… ğŸ•‹</h1>
        <div class="subtitle">ØªØ¹Ù„Ù… Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬ Ø¨Ù…ØªØ¹Ø© ÙˆÙ…ØºØ§Ù…Ø±Ø©!</div>
    </header>

    <div class="main-container">
        <section class="game-intro" id="game-intro">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø¬!</h2>
            <p class="intro-text">
                Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„ØªÙƒÙˆÙ† Ø­Ø§Ø¬Ø§Ù‹ ØµØºÙŠØ±Ø§Ù‹ ÙˆØªØªØ¹Ù„Ù… Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©ØŸ
                Ø³ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù…Ù† **Ø§Ù„Ù…ÙŠÙ‚Ø§Øª**ØŒ Ø«Ù… ØªØ²ÙˆØ± **Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙØ©**ØŒ ÙˆØªØ³Ø¹Ù‰ Ø¨ÙŠÙ† **Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©**ØŒ
                ÙˆØªØ°Ù‡Ø¨ Ø¥Ù„Ù‰ **Ù…Ù†Ù‰** Ùˆ**Ø¹Ø±ÙØ©** Ùˆ**Ù…Ø²Ø¯Ù„ÙØ©**ØŒ Ø«Ù… ØªØ±Ù…ÙŠ **Ø§Ù„Ø¬Ù…Ø±Ø§Øª**! Ù‡ÙŠØ§ Ø¨Ù†Ø§ Ù†Ù†Ø·Ù„Ù‚!
            </p>
            <button class="action-button" id="start-game-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¢Ù†! <i class="fas fa-play"></i></button>
        </section>

        <section class="game-area" id="game-area" style="display: none;">
            <div class="game-status">
                <span id="current-mansek-name"></span>
                <span id="score">Ù†Ù‚Ø§Ø·: 0</span>
            </div>
            <div class="mansek-progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>

            <div class="game-map" id="game-map">
                </div>

            <div class="mansek-details-popup" id="mansek-details-popup">
                <div class="popup-content">
                    <h3 id="popup-title"></h3>
                    <img id="popup-image" src="" alt="Ù…Ù†Ø³Ùƒ Ø§Ù„Ø­Ø¬" class="popup-img">
                    <p id="popup-description"></p>
                    <button class="action-button" id="start-mansek-task-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù†Ø³Ùƒ! <i class="fas fa-arrow-left"></i></button>
                    <button class="action-button" id="next-mansek-btn" style="display: none;">Ø§Ù„Ù…Ù†Ø³Ùƒ Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i></button>
                </div>
            </div>

            <div class="mini-game-container" id="mini-game-container">
                </div>

            <div class="feedback-message" id="game-feedback"></div>
        </section>

        <section class="game-end-screen" id="game-end-screen" style="display: none;">
            <h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬! ğŸ‰</h2>
            <p class="end-text">Ø£ØµØ¨Ø­Øª Ø­Ø§Ø¬Ø§Ù‹ ØµØºÙŠØ±Ø§Ù‹ Ø¨Ø·Ù„Ø§Ù‹! Ù„Ù‚Ø¯ ØªØ¹Ù„Ù…Øª Ø§Ù„ÙƒØ«ÙŠØ± Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒØ©.</p>
            <img src="https://via.placeholder.com/300x200/90EE90/000000?text=Ø­Ø§Ø¬+Ù…ÙƒØªÙ…Ù„+Ø§Ù„Ø±Ø­Ù„Ø©" alt="Ø­Ø§Ø¬ Ù…ÙƒØªÙ…Ù„ Ø§Ù„Ø±Ø­Ù„Ø©" class="end-img">
            <button class="action-button" id="restart-game-btn">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©! <i class="fas fa-redo"></i></button>
        </section>
    </div>

    <div class="confetti-container" id="confetti-container"></div>

    <script>
        // Utility Functions
        const startConfetti = () => {
            const confettiContainer = document.getElementById('confetti-container');
            const colors = ['#fce18a', '#f7b84b', '#e18a39', '#a8eb12', '#67ed28', '#28ed67', '#12eba8', '#39e1a8', '#4bdcf7', '#8ae4fc', '#FF69B4', '#DA70D6'];
            confettiContainer.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = Math.random() * -20 + 'vh';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = Math.random() * 3 + 4 + 's';
                confetti.style.transform = `scale(${Math.random() * 0.8 + 0.2})`;
                confettiContainer.appendChild(confetti);
                confetti.addEventListener('animationend', () => confetti.remove());
            }
        };

        const showFeedback = (message, isCorrect) => {
            const feedbackElement = document.getElementById('game-feedback');
            feedbackElement.textContent = message;
            feedbackElement.style.color = isCorrect ? 'var(--correct-color)' : 'var(--wrong-color)';
            setTimeout(() => {
                feedbackElement.textContent = '';
            }, 2000);
        };

        // Game Elements
        const gameIntroScreen = document.getElementById('game-intro');
        const gameArea = document.getElementById('game-area');
        const gameEndScreen = document.getElementById('game-end-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const currentMansekName = document.getElementById('current-mansek-name');
        const scoreDisplay = document.getElementById('score');
        const progressBar = document.getElementById('progress-bar');
        const gameMap = document.getElementById('game-map');
        const mansekDetailsPopup = document.getElementById('mansek-details-popup');
        const popupTitle = document.getElementById('popup-title');
        const popupImage = document.getElementById('popup-image');
        const popupDescription = document.getElementById('popup-description');
        const startMansekTaskBtn = document.getElementById('start-mansek-task-btn');
        const nextMansekBtn = document.getElementById('next-mansek-btn');
        const miniGameContainer = document.getElementById('mini-game-container');

        let score = 0;
        let currentMansekIndex = 0;
        let pilgrimCharacter = null; // Will be created dynamically

        const manasek = [
            {
                name: "Ø§Ù„Ù…ÙŠÙ‚Ø§Øª",
                description: "Ø§Ù„Ù…ÙŠÙ‚Ø§Øª Ù‡Ùˆ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØ­Ø±Ù… Ù…Ù†Ù‡ Ø§Ù„Ø­Ø§Ø¬. ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø¬ Ø£Ù† ÙŠÙ„Ø¨Ø³ Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ÙˆÙŠÙ†ÙˆÙŠ Ø§Ù„Ø­Ø¬ Ø£Ùˆ Ø§Ù„Ø¹Ù…Ø±Ø©.",
                image: "https://via.placeholder.com/300x200/ADD8E6/000000?text=Ø§Ù„Ù…ÙŠÙ‚Ø§Øª+ÙˆØ§Ù„Ø¥Ø­Ø±Ø§Ù…",
                coordinates: { top: '85%', left: '10%' },
                task: "ihram"
            },
            {
                name: "Ø§Ù„Ø·ÙˆØ§Ù Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø©",
                description: "Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙƒØ©ØŒ ÙŠØ·ÙˆÙ Ø§Ù„Ø­Ø§Ø¬ Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø© 7 Ø£Ø´ÙˆØ§Ø·ØŒ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø­Ø¬Ø± Ø§Ù„Ø£Ø³ÙˆØ¯ ÙˆØªÙ†ØªÙ‡ÙŠ Ø¹Ù†Ø¯Ù‡.",
                image: "https://via.placeholder.com/300x200/98FB98/000000?text=Ø§Ù„Ø·ÙˆØ§Ù+Ø­ÙˆÙ„+Ø§Ù„ÙƒØ¹Ø¨Ø©",
                coordinates: { top: '50%', left: '50%' }, // Center of the map
                task: "tawaf"
            },
            {
                name: "Ø§Ù„Ø³Ø¹ÙŠ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©",
                description: "ÙŠØ³Ø¹Ù‰ Ø§Ù„Ø­Ø§Ø¬ Ø¨ÙŠÙ† Ø¬Ø¨Ù„ÙŠ Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ© 7 Ø£Ø´ÙˆØ§Ø·ØŒ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ§ ÙˆØªÙ†ØªÙ‡ÙŠ Ø¨Ø§Ù„Ù…Ø±ÙˆØ©.",
                image: "https://via.placeholder.com/300x200/FFB6C1/000000?text=Ø§Ù„Ø³Ø¹ÙŠ+Ø¨ÙŠÙ†+Ø§Ù„ØµÙØ§+ÙˆØ§Ù„Ù…Ø±ÙˆØ©",
                coordinates: { top: '70%', left: '40%' },
                task: "saee"
            },
            {
                name: "Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ù…Ù†Ù‰ (ÙŠÙˆÙ… Ø§Ù„ØªØ±ÙˆÙŠØ©)",
                description: "ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù…Ù† Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©ØŒ ÙŠØªÙˆØ¬Ù‡ Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø¥Ù„Ù‰ Ù…Ù†Ù‰ ÙˆÙŠØ¨ÙŠØªÙˆÙ† ÙÙŠÙ‡Ø§.",
                image: "https://via.placeholder.com/300x200/DDA0DD/000000?text=Ù…Ù†Ù‰",
                coordinates: { top: '20%', left: '70%' },
                task: "simple_question"
            },
            {
                name: "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ©",
                description: "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ© Ù‡Ùˆ Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£Ø¹Ø¸Ù… Ù„Ù„Ø­Ø¬ØŒ ÙˆÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ø³Ø¹ Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©. ÙŠØ¯Ø¹Ùˆ Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø§Ù„Ù„Ù‡ ÙˆÙŠØªØ¶Ø±Ø¹ÙˆÙ† Ø¥Ù„ÙŠÙ‡.",
                image: "https://via.placeholder.com/300x200/FF6347/000000?text=Ø¹Ø±ÙØ©",
                coordinates: { top: '10%', left: '85%' },
                task: "simple_question"
            },
            {
                name: "Ø§Ù„Ù…Ø¨ÙŠØª Ø¨Ù…Ø²Ø¯Ù„ÙØ©",
                description: "Ø¨Ø¹Ø¯ ØºØ±ÙˆØ¨ Ø´Ù…Ø³ ÙŠÙˆÙ… Ø¹Ø±ÙØ©ØŒ ÙŠØªÙˆØ¬Ù‡ Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²Ø¯Ù„ÙØ© ÙˆÙŠØ¨ÙŠØªÙˆÙ† ÙÙŠÙ‡Ø§ØŒ ÙˆÙŠØ¬Ù…Ø¹ÙˆÙ† Ù…Ù†Ù‡Ø§ Ø§Ù„Ø­ØµÙ‰ Ù„Ø±Ù…ÙŠ Ø§Ù„Ø¬Ù…Ø±Ø§Øª.",
                image: "https://via.placeholder.com/300x200/FFD700/000000?text=Ù…Ø²Ø¯Ù„ÙØ©",
                coordinates: { top: '15%', left: '75%' },
                task: "simple_question"
            },
            {
                name: "Ø±Ù…ÙŠ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰",
                description: "ÙÙŠ ÙŠÙˆÙ… Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ (Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ø´Ø±)ØŒ ÙŠØ±Ù…ÙŠ Ø§Ù„Ø­Ø§Ø¬ Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø¨Ø³Ø¨Ø¹ Ø­ØµÙŠØ§Øª.",
                image: "https://via.placeholder.com/300x200/BDB76B/000000?text=Ø±Ù…ÙŠ+Ø§Ù„Ø¬Ù…Ø±Ø§Øª",
                coordinates: { top: '25%', left: '60%' },
                task: "jamarat"
            },
            {
                name: "Ø§Ù„Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹ÙŠ",
                description: "Ù‚Ø¨Ù„ Ù…ØºØ§Ø¯Ø±Ø© Ù…ÙƒØ©ØŒ ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø­Ø§Ø¬ Ø¨Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹ Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø© Ø³Ø¨Ø¹ Ø£Ø´ÙˆØ§Ø· Ù„ÙŠØ®ØªÙ… Ø¨Ù‡ Ù…Ù†Ø§Ø³ÙƒÙ‡.",
                image: "https://via.placeholder.com/300x200/87CEEB/000000?text=Ø·ÙˆØ§Ù+Ø§Ù„ÙˆØ¯Ø§Ø¹",
                coordinates: { top: '50%', left: '50%' }, // Back to Kaaba
                task: "tawaf_farewell" // Can be similar to tawaf or just a final task
            }
        ];

        function initializeGame() {
            score = 0;
            currentMansekIndex = 0;
            scoreDisplay.textContent = `Ù†Ù‚Ø§Ø·: ${score}`;
            progressBar.style.width = '0%';

            gameIntroScreen.style.display = 'block';
            gameArea.style.display = 'none';
            gameEndScreen.style.display = 'none';
            mansekDetailsPopup.classList.remove('active');
            miniGameContainer.style.display = 'none';
            miniGameContainer.innerHTML = '';
            
            // Clear existing map points and pilgrim
            gameMap.innerHTML = '';
            pilgrimCharacter = null;
        }

        function startGame() {
            gameIntroScreen.style.display = 'none';
            gameArea.style.display = 'flex';
            gameEndScreen.style.display = 'none';
            
            createPilgrimCharacter();
            loadMapPoints();
            loadMansek(currentMansekIndex);
        }

        function createPilgrimCharacter() {
            pilgrimCharacter = document.createElement('div');
            pilgrimCharacter.classList.add('pilgrim-character');
            gameMap.appendChild(pilgrimCharacter);
            // Set initial position from the first mansek
            const firstMansek = manasek[0];
            pilgrimCharacter.style.top = firstMansek.coordinates.top;
            pilgrimCharacter.style.left = firstMansek.coordinates.left;
        }

        function loadMapPoints() {
            manasek.forEach((mansek, index) => {
                const point = document.createElement('div');
                point.classList.add('map-point');
                point.textContent = index + 1; // Display order number
                point.style.top = mansek.coordinates.top;
                point.style.left = mansek.coordinates.left;
                point.dataset.index = index;
                gameMap.appendChild(point);
            });
        }

        function updateMapPointsActiveState() {
            document.querySelectorAll('.map-point').forEach((point, index) => {
                if (index === currentMansekIndex) {
                    point.classList.add('active');
                    // Move pilgrim to current point
                    pilgrimCharacter.style.top = manasek[index].coordinates.top;
                    pilgrimCharacter.style.left = manasek[index].coordinates.left;
                } else {
                    point.classList.remove('active');
                }
            });
        }

        function loadMansek(index) {
            if (index >= manasek.length) {
                endGame();
                return;
            }

            const mansek = manasek[index];
            currentMansekName.textContent = `Ø§Ù„Ù…Ù†Ø³Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${mansek.name}`;
            progressBar.style.width = ((index + 1) / manasek.length) * 100 + '%';
            updateMapPointsActiveState();

            popupTitle.textContent = mansek.name;
            popupImage.src = mansek.image;
            popupDescription.textContent = mansek.description;
            
            startMansekTaskBtn.style.display = 'block';
            nextMansekBtn.style.display = 'none';
            miniGameContainer.style.display = 'none';
            miniGameContainer.innerHTML = ''; // Clear previous mini-game

            mansekDetailsPopup.classList.add('active');
        }

        startMansekTaskBtn.addEventListener('click', () => {
            mansekDetailsPopup.classList.remove('active');
            startMansekTask();
        });

        nextMansekBtn.addEventListener('click', () => {
            currentMansekIndex++;
            loadMansek(currentMansekIndex);
        });

        function startMansekTask() {
            const mansek = manasek[currentMansekIndex];
            miniGameContainer.style.display = 'flex'; // Show mini-game area
            miniGameContainer.innerHTML = `<h3>Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ùƒ: ${mansek.name}</h3>`; // Title for mini-game

            switch (mansek.task) {
                case "ihram":
                    loadIhramGame();
                    break;
                case "tawaf":
                case "tawaf_farewell": // Re-use tawaf game for farewell tawaf
                    loadTawafGame(mansek.task);
                    break;
                case "saee":
                    loadSaeeGame();
                    break;
                case "simple_question":
                    loadSimpleQuestionGame(mansek.name);
                    break;
                case "jamarat":
                    loadJamaratGame();
                    break;
                default:
                    // No specific task, just proceed
                    showFeedback("Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ù†Ø³Ùƒ Ø¨Ù†Ø¬Ø§Ø­!", true);
                    setTimeout(completeMansekTask, 1500);
            }
        }

        function completeMansekTask() {
            score += 10; // Award points for completing a task
            scoreDisplay.textContent = `Ù†Ù‚Ø§Ø·: ${score}`;
            miniGameContainer.style.display = 'none'; // Hide mini-game
            nextMansekBtn.style.display = 'block'; // Show next mansek button in popup
            mansekDetailsPopup.classList.add('active'); // Show popup again to prompt next step
            startMansekTaskBtn.style.display = 'none'; // Hide task start button
        }

        function endGame() {
            gameArea.style.display = 'none';
            gameEndScreen.style.display = 'block';
            startConfetti();
        }

        // Mini-Games Implementations

        // 1. Ihram Game
        function loadIhramGame() {
            miniGameContainer.innerHTML = `
                <h3>Ù…Ù‡Ù…Ø© Ø§Ù„Ø¥Ø­Ø±Ø§Ù… ğŸ¥»</h3>
                <p class="mini-game-instruction">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø¥Ø­Ø±Ø§Ù… Ù„Ù„Ø±Ø¬Ù„.</p>
                <div id="ihram-options" class="ihram-options">
                    <div class="ihram-option-card" data-correct="false">
                        <img src="https://via.placeholder.com/80x80/FFC0CB/000000?text=Ù…Ù„Ø§Ø¨Ø³+Ø¹Ø§Ø¯ÙŠØ©" alt="Ù…Ù„Ø§Ø¨Ø³ Ø¹Ø§Ø¯ÙŠØ©">
                        <p>Ù…Ù„Ø§Ø¨Ø³ Ø¹Ø§Ø¯ÙŠØ©</p>
                    </div>
                    <div class="ihram-option-card" data-correct="true">
                        <img src="https://via.placeholder.com/80x80/FFFFFF/000000?text=Ø«ÙˆØ¨Ø§+Ø§Ù„Ø¥Ø­Ø±Ø§Ù…" alt="Ø«ÙˆØ¨Ø§ Ø§Ù„Ø¥Ø­Ø±Ø§Ù…">
                        <p>Ø«ÙˆØ¨Ø§ Ø§Ù„Ø¥Ø­Ø±Ø§Ù…</p>
                    </div>
                    <div class="ihram-option-card" data-correct="false">
                        <img src="https://via.placeholder.com/80x80/A9A9A9/000000?text=Ù…Ù„Ø§Ø¨Ø³+Ù…Ù„ÙˆÙ†Ø©" alt="Ù…Ù„Ø§Ø¨Ø³ Ù…Ù„ÙˆÙ†Ø©">
                        <p>Ù…Ù„Ø§Ø¨Ø³ Ù…Ù„ÙˆÙ†Ø©</p>
                    </div>
                </div>
                <div class="feedback-message" id="ihram-feedback"></div>
            `;

            document.querySelectorAll('#ihram-options .ihram-option-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const isCorrect = e.currentTarget.dataset.correct === 'true';
                    const ihramFeedback = document.getElementById('ihram-feedback');
                    if (isCorrect) {
                        ihramFeedback.textContent = "Ø£Ø­Ø³Ù†Øª! Ù‡Ø°Ù‡ Ù‡ÙŠ Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¥Ø­Ø±Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©.";
                        ihramFeedback.style.color = 'var(--correct-color)';
                        e.currentTarget.classList.add('correct');
                        document.querySelectorAll('#ihram-options .ihram-option-card').forEach(c => c.style.pointerEvents = 'none'); // Disable further clicks
                        setTimeout(completeMansekTask, 1500);
                    } else {
                        ihramFeedback.textContent = "Ù‡Ø°Ù‡ Ù„ÙŠØ³Øª Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¥Ø­Ø±Ø§Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
                        ihramFeedback.style.color = 'var(--wrong-color)';
                        e.currentTarget.classList.add('wrong');
                        setTimeout(() => e.currentTarget.classList.remove('wrong'), 800);
                    }
                });
            });
        }

        // 2. Tawaf Game
        let tawafCount = 0;
        const requiredTawaf = 7;
        function loadTawafGame(taskType) {
            tawafCount = 0;
            miniGameContainer.innerHTML = `
                <h3>Ù…Ù‡Ù…Ø© ${taskType === 'tawaf' ? 'Ø§Ù„Ø·ÙˆØ§Ù' : 'Ø·ÙˆØ§Ù Ø§Ù„ÙˆØ¯Ø§Ø¹'} Ø­ÙˆÙ„ Ø§Ù„ÙƒØ¹Ø¨Ø© ğŸ•‹</h3>
                <p class="mini-game-instruction">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ¹Ø¨Ø© ${requiredTawaf} Ù…Ø±Ø§Øª Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ù.</p>
                <div class="kaaba-area" id="kaaba-area">
                    <i class="fas fa-mosque pilgrim-icon"></i>
                    <div class="tawaf-count" id="tawaf-count">0 / ${requiredTawaf}</div>
                </div>
                <div class="feedback-message" id="tawaf-feedback"></div>
            `;

            const kaabaArea = document.getElementById('kaaba-area');
            const tawafCountDisplay = document.getElementById('tawaf-count');
            const tawafFeedback = document.getElementById('tawaf-feedback');

            kaabaArea.addEventListener('click', () => {
                if (tawafCount < requiredTawaf) {
                    tawafCount++;
                    tawafCountDisplay.textContent = `${tawafCount} / ${requiredTawaf}`;
                    if (tawafCount === requiredTawaf) {
                        tawafFeedback.textContent = "Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø§Ù„Ø·ÙˆØ§Ù Ø¨Ù†Ø¬Ø§Ø­!";
                        tawafFeedback.style.color = 'var(--correct-color)';
                        kaabaArea.style.pointerEvents = 'none'; // Disable further clicks
                        setTimeout(completeMansekTask, 1500);
                    }
                }
            });
        }

        // 3. Saee Game (similar to Tawaf, but with 2 points)
        let saeeCount = 0;
        const requiredSaee = 7;
        function loadSaeeGame() {
            saeeCount = 0;
            miniGameContainer.innerHTML = `
                <h3>Ù…Ù‡Ù…Ø© Ø§Ù„Ø³Ø¹ÙŠ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ© â›°ï¸</h3>
                <p class="mini-game-instruction">Ø§Ù†Ù‚Ø± Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ© ${requiredSaee} Ù…Ø±Ø§Øª.</p>
                <div style="display: flex; justify-content: center; gap: 50px; margin-top: 20px;">
                    <div class="saee-point" id="safa" style="background-color: #A9D18E; padding: 20px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.5rem;">Ø§Ù„ØµÙØ§</div>
                    <div class="saee-point" id="marwah" style="background-color: #F8CBAD; padding: 20px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.5rem;">Ø§Ù„Ù…Ø±ÙˆØ©</div>
                </div>
                <div class="tawaf-count" id="saee-count">0 / ${requiredSaee}</div>
                <div class="feedback-message" id="saee-feedback"></div>
            `;

            const safa = document.getElementById('safa');
            const marwah = document.getElementById('marwah');
            const saeeCountDisplay = document.getElementById('saee-count');
            const saeeFeedback = document.getElementById('saee-feedback');
            let lastClicked = null;

            const handleSaeeClick = (pointName) => {
                if (saeeCount < requiredSaee) {
                    if ((pointName === 'safa' && lastClicked === null) || (pointName === 'marwah' && lastClicked === 'safa') || (pointName === 'safa' && lastClicked === 'marwah')) {
                        saeeCount++;
                        saeeCountDisplay.textContent = `${saeeCount} / ${requiredSaee}`;
                        lastClicked = pointName;
                        if (saeeCount === requiredSaee) {
                            saeeFeedback.textContent = "Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø§Ù„Ø³Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­!";
                            saeeFeedback.style.color = 'var(--correct-color)';
                            safa.style.pointerEvents = 'none';
                            marwah.style.pointerEvents = 'none';
                            setTimeout(completeMansekTask, 1500);
                        }
                    } else {
                        saeeFeedback.textContent = "ÙŠØ¬Ø¨ Ø£Ù† ØªØ¶ØºØ· Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ§ ÙˆØ§Ù„Ù…Ø±ÙˆØ©.";
                        saeeFeedback.style.color = 'var(--wrong-color)';
                    }
                }
            };

            safa.addEventListener('click', () => handleSaeeClick('safa'));
            marwah.addEventListener('click', () => handleSaeeClick('marwah'));
        }


        // 4. Simple Question Game (for Mina, Arafah, Muzdalifah)
        function loadSimpleQuestionGame(mansekName) {
            let question = "";
            let correctAnswer = "";
            let options = [];

            if (mansekName === "Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ù…Ù†Ù‰ (ÙŠÙˆÙ… Ø§Ù„ØªØ±ÙˆÙŠØ©)") {
                question = "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠ ÙŠØªÙˆØ¬Ù‡ ÙÙŠÙ‡ Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø¥Ù„Ù‰ Ù…Ù†Ù‰ ÙˆÙŠØ¨ÙŠØªÙˆÙ† ÙÙŠÙ‡Ø§ØŸ";
                options = ["Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ø¹ Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©", "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù…Ù† Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©", "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ø³Ø¹ Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©"];
                correctAnswer = "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù…Ù† Ù…Ù† Ø°ÙŠ Ø§Ù„Ø­Ø¬Ø©";
            } else if (mansekName === "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ©") {
                question = "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£Ø¹Ø¸Ù… Ù„Ù„Ø­Ø¬ØŸ";
                options = ["Ø§Ù„Ø·ÙˆØ§Ù", "Ø§Ù„Ø³Ø¹ÙŠ", "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ©", "Ø±Ù…ÙŠ Ø§Ù„Ø¬Ù…Ø±Ø§Øª"];
                correctAnswer = "Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø¹Ø±ÙØ©";
            } else if (mansekName === "Ø§Ù„Ù…Ø¨ÙŠØª Ø¨Ù…Ø²Ø¯Ù„ÙØ©") {
                question = "Ù…Ø§Ø°Ø§ ÙŠØ¬Ù…Ø¹ Ø§Ù„Ø­Ø¬Ø§Ø¬ ÙÙŠ Ù…Ø²Ø¯Ù„ÙØ© Ù„Ø±Ù…ÙŠ Ø§Ù„Ø¬Ù…Ø±Ø§ØªØŸ";
                options = ["Ø§Ù„Ù…Ø§Ø¡", "Ø§Ù„Ø²ÙŠØª", "Ø§Ù„Ø­ØµÙ‰", "Ø§Ù„ØªÙ…Ø±"];
                correctAnswer = "Ø§Ù„Ø­ØµÙ‰";
            }

            miniGameContainer.innerHTML = `
                <h3>Ù…Ù‡Ù…Ø© ${mansekName} â“</h3>
                <p class="mini-game-instruction">${question}</p>
                <div id="question-options" class="ihram-options">
                    ${options.map(opt => `<div class="ihram-option-card" data-answer="${opt}">${opt}</div>`).join('')}
                </div>
                <div class="feedback-message" id="question-feedback"></div>
            `;

            document.querySelectorAll('#question-options .ihram-option-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const selectedAnswer = e.currentTarget.dataset.answer;
                    const questionFeedback = document.getElementById('question-feedback');
                    if (selectedAnswer === correctAnswer) {
                        questionFeedback.textContent = "ØµØ­ÙŠØ­! Ø£Ø­Ø³Ù†Øª!";
                        questionFeedback.style.color = 'var(--correct-color)';
                        e.currentTarget.classList.add('correct');
                        document.querySelectorAll('#question-options .ihram-option-card').forEach(c => c.style.pointerEvents = 'none');
                        setTimeout(completeMansekTask, 1500);
                    } else {
                        questionFeedback.textContent = `Ø®Ø·Ø£. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${correctAnswer}.`;
                        questionFeedback.style.color = 'var(--wrong-color)';
                        e.currentTarget.classList.add('wrong');
                        setTimeout(() => e.currentTarget.classList.remove('wrong'), 800);
                    }
                });
            });
        }

        // 5. Jamarat Game (Drag & Drop)
        let thrownPebbles = 0;
        const requiredPebbles = 7;
        function loadJamaratGame() {
            thrownPebbles = 0;
            miniGameContainer.innerHTML = `
                <h3>Ù…Ù‡Ù…Ø© Ø±Ù…ÙŠ Ø§Ù„Ø¬Ù…Ø±Ø§Øª ğŸª¨</h3>
                <p class="mini-game-instruction">Ø§Ø³Ø­Ø¨ ${requiredPebbles} Ø­ØµÙŠØ§Øª ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø¬Ù…Ø±Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰.</p>
                <div class="jamarat-targets">
                    <div class="jamara-target" id="jamara-target">Ø¬Ù…Ø±Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰</div>
                </div>
                <div class="pebbles-container" id="pebbles-container">
                    ${Array(requiredPebbles + 3).fill().map((_, i) => `<div class="pebble" draggable="true" id="pebble-${i}"></div>`).join('')}
                </div>
                <div class="feedback-message" id="jamarat-feedback"></div>
            `;

            const jamaraTarget = document.getElementById('jamara-target');
            const pebblesContainer = document.getElementById('pebbles-container');
            const jamaratFeedback = document.getElementById('jamarat-feedback');

            document.querySelectorAll('.pebble').forEach(pebble => {
                pebble.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/id', e.target.id);
                    e.target.classList.add('dragging');
                });
                pebble.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
            });

            jamaraTarget.addEventListener('dragover', (e) => {
                e.preventDefault();
                jamaraTarget.classList.add('active');
            });
            jamaraTarget.addEventListener('dragleave', () => {
                jamaraTarget.classList.remove('active');
            });
            jamaraTarget.addEventListener('drop', (e) => {
                e.preventDefault();
                jamaraTarget.classList.remove('active');
                const pebbleId = e.dataTransfer.getData('text/id');
                const draggedPebble = document.getElementById(pebbleId);

                if (draggedPebble && draggedPebble.parentNode === pebblesContainer) {
                    if (thrownPebbles < requiredPebbles) {
                        thrownPebbles++;
                        draggedPebble.style.display = 'none'; // Hide the pebble
                        jamaratFeedback.textContent = `Ø±Ù…ÙŠØª ${thrownPebbles} Ø­ØµÙŠØ§Øª!`;
                        jamaratFeedback.style.color = 'var(--text-color)';
                        if (thrownPebbles === requiredPebbles) {
                            jamaratFeedback.textContent = "Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø±Ù…ÙŠØª Ø§Ù„Ø¬Ù…Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!";
                            jamaratFeedback.style.color = 'var(--correct-color)';
                            jamaraTarget.style.pointerEvents = 'none'; // Disable further drops
                            pebblesContainer.style.pointerEvents = 'none'; // Disable dragging more
                            setTimeout(completeMansekTask, 1500);
                        }
                    } else {
                        jamaratFeedback.textContent = "Ù„Ù‚Ø¯ Ø±Ù…ÙŠØª Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ§ÙÙŠ Ù…Ù† Ø§Ù„Ø­ØµÙŠØ§Øª.";
                        jamaratFeedback.style.color = 'orange';
                    }
                }
            });
        }


        // Event Listeners for main game flow
        startGameBtn.addEventListener('click', startGame);
        restartGameBtn.addEventListener('click', initializeGame);

        // Initial game setup
        initializeGame();
    </script>
</body>
</html>