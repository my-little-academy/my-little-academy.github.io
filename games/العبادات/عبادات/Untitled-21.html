<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رحلتي الممتعة لتعلم الصلاة</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for general text -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a7e9ff, #d6ffb7); /* Playful gradient background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        .container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1, h2 {
            color: #4CAF50; /* Green */
            font-weight: 700;
            margin-bottom: 20px;
        }
        .nav-buttons button {
            background-color: #FFD700; /* Gold */
            color: #8B4513; /* Brown */
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 10px;
            border: 2px solid #FFA07A; /* Light Salmon */
        }
        .nav-buttons button:hover {
            background-color: #FFA07A; /* Light Salmon */
            color: #FFFFFF;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .section {
            display: none;
            padding: 20px 0;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .section.active {
            display: block;
        }
        .story-text, .prayer-step-text, .quiz-question-text {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 20px;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .quiz-options label {
            display: block;
            background-color: #f0f8ff; /* Alice Blue */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: 2px solid #ADD8E6; /* Light Blue */
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            color: #333;
        }
        .quiz-options label:hover {
            background-color: #e0f2f7;
            border-color: #87CEEB; /* Sky Blue */
        }
        .quiz-options input[type="radio"]:checked + label {
            background-color: #90EE90; /* Light Green */
            border-color: #3CB371; /* Medium Sea Green */
            color: #333;
            font-weight: 600;
        }
        .quiz-feedback {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .correct {
            color: #28A745; /* Green */
        }
        .incorrect {
            color: #DC3545; /* Red */
        }
        .game-area {
            background-color: #fffacd; /* Lemon Chiffon */
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .prayer-steps-game-item {
            background-color: #ffe4e1; /* Misty Rose */
            border: 2px solid #ff6347; /* Tomato */
            border-radius: 15px;
            padding: 15px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            font-weight: 600;
            color: #8B0000; /* Dark Red */
            text-align: center;
            width: 150px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .prayer-steps-game-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .prayer-steps-game-item.selected {
            background-color: #90EE90; /* Light Green */
            border-color: #3CB371; /* Medium Sea Green */
        }
        .prayer-steps-game-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 5px;
        }
        .game-selected-order {
            margin-top: 20px;
            padding: 15px;
            background-color: #e6e6fa; /* Lavender */
            border-radius: 10px;
            border: 2px dashed #b0c4de; /* Light Steel Blue */
            min-height: 80px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        .game-selected-order span {
            background-color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 0.9rem;
            color: #444;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .game-buttons button {
            background-color: #8A2BE2; /* Blue Violet */
            color: #FFFFFF;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 10px;
            border: none;
        }
        .game-buttons button:hover {
            background-color: #9370DB; /* Medium Purple */
            transform: translateY(-2px);
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .popup-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        .popup-overlay.show .popup-content {
            transform: scale(1);
        }
        .popup-content h3 {
            color: #4CAF50;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        .popup-content p {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 20px;
        }
        .popup-content button {
            background-color: #FFD700;
            color: #8B4513;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .popup-content button:hover {
            background-color: #FFA07A;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl">رحلتي الممتعة لتعلم الصلاة</h1>

        <div class="nav-buttons mb-8">
            <button onclick="showSection('intro')">المقدمة</button>
            <button onclick="showSection('story')">القصة المشوقة</button>
            <button onclick="showSection('how-to-pray')">كيف نصلي؟</button>
            <button onclick="showSection('quiz')">اختبر فهمك</button>
            <button onclick="showSection('games')">ألعاب تفاعلية</button>
        </div>

        <!-- Introduction Section -->
        <div id="intro" class="section active">
            <h2 class="text-3xl">مرحباً يا أصدقائي الصغار!</h2>
            <p class="story-text">هل أنتم مستعدون لرحلة رائعة مليئة بالمرح والمعرفة؟ في هذه الصفحة، سننطلق معًا في مغامرة شيقة لنتعلم كل شيء عن الصلاة، ركن أساسي في ديننا الحنيف. هيا بنا نبدأ!</p>
            <img src="https://placehold.co/400x200/ADD8E6/000000?text=مرحباً+بالأبطال" alt="مرحباً بالأبطال" class="mx-auto image-container">
        </div>

        <!-- Story Section -->
        <div id="story" class="section">
            <h2 class="text-3xl">قصتنا المشوقة: مغامرة بطل الصلاة</h2>
            <p class="story-text">في قديم الزمان، كان هناك طفل ذكي وفضولي اسمه "صالح". كان صالح يحب اللعب والمرح، لكنه كان يحلم أيضًا بأن يصبح بطلًا في عبادته. في يوم من الأيام، بينما كان صالح يتصفح كتابًا قديمًا عن الأنبياء، لمح صورة مسجد جميل، وشعر بفضول كبير تجاه الصلاة.</p>
            <img src="https://placehold.co/400x200/90EE90/000000?text=صالح+والمسجد" alt="صالح والمسجد" class="mx-auto image-container">
            <p class="story-text">قرر صالح أن يبدأ رحلته لتعلم الصلاة. التقى بصديقه الحكيم "أحمد"، الذي كان يصلي بانتظام، وسأله عن كيفية الصلاة. ابتسم أحمد وقال: "الصلاة يا صالح هي حوار جميل مع الله، وهي خمس مرات في اليوم، وفيها نجد الراحة والسعادة."</p>
            <img src="https://placehold.co/400x200/FFD700/000000?text=صالح+وأحمد" alt="صالح وأحمد" class="mx-auto image-container">
            <p class="story-text">بدأ أحمد يشرح لصالح خطوات الصلاة بالتفصيل، من الوضوء إلى التكبير، ومن الركوع إلى السجود. كان صالح يصغي باهتمام، ويحاول تقليد حركات أحمد بحماس. تعلم صالح أن الصلاة ليست مجرد حركات، بل هي خشوع وتأمل وذكر لله.</p>
            <p class="story-text">وفي كل يوم، كان صالح يتعلم شيئًا جديدًا عن الصلاة:</p>
            <ul class="list-disc list-inside text-right story-text mx-auto max-w-md">
                <li>**عدد الصلوات:** عرف صالح أن هناك خمس صلوات في اليوم: الفجر، والظهر، والعصر، والمغرب، والعشاء.</li>
                <li>**أذكار الصلاة:** تعلم صالح الأذكار التي تقال في كل ركن من أركان الصلاة، مثل "سبحان ربي العظيم" في الركوع، و"سبحان ربي الأعلى" في السجود.</li>
                <li>**أهمية الصلاة:** أدرك صالح أن الصلاة تجعله أقرب إلى الله، وتطهّر قلبه، وتمنحه القوة لمواجهة تحديات الحياة.</li>
            </ul>
        </div>

        <!-- How to Pray Section -->
        <div id="how-to-pray" class="section">
            <h2 class="text-3xl">كيف نصلي؟ خطوات الصلاة الصحيحة</h2>
            <p class="prayer-step-text">هيا نتعرف على خطوات الصلاة خطوة بخطوة، لتصبح صلاتنا صحيحة ومقبولة بإذن الله:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                <div class="bg-blue-100 p-6 rounded-xl shadow-md border-2 border-blue-300">
                    <img src="https://placehold.co/100x100/ADD8E6/000000?text=النية" alt="النية" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">1. النية وتكبيرة الإحرام</h3>
                    <p class="text-gray-700">ننوي الصلاة بقلوبنا، ثم نرفع أيدينا ونقول: "الله أكبر".</p>
                </div>
                <div class="bg-green-100 p-6 rounded-xl shadow-md border-2 border-green-300">
                    <img src="https://placehold.co/100x100/90EE90/000000?text=الفاتحة" alt="الفاتحة" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-green-800 mb-2">2. قراءة الفاتحة وسورة</h3>
                    <p class="text-gray-700">نقرأ سورة الفاتحة، ثم سورة قصيرة من القرآن الكريم.</p>
                </div>
                <div class="bg-yellow-100 p-6 rounded-xl shadow-md border-2 border-yellow-300">
                    <img src="https://placehold.co/100x100/FFD700/000000?text=الركوع" alt="الركوع" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-2">3. الركوع</h3>
                    <p class="text-gray-700">ننحني بظهورنا ونضع أيدينا على ركبنا، ونقول: "سبحان ربي العظيم" ثلاث مرات.</p>
                </div>
                <div class="bg-purple-100 p-6 rounded-xl shadow-md border-2 border-purple-300">
                    <img src="https://placehold.co/100x100/E6E6FA/000000?text=الرفع" alt="الرفع" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-purple-800 mb-2">4. الرفع من الركوع</h3>
                    <p class="text-gray-700">نرفع رؤوسنا وظهورنا ونقول: "سمع الله لمن حمده، ربنا ولك الحمد".</p>
                </div>
                <div class="bg-red-100 p-6 rounded-xl shadow-md border-2 border-red-300">
                    <img src="https://placehold.co/100x100/FFA07A/000000?text=السجود" alt="السجود" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-red-800 mb-2">5. السجود</h3>
                    <p class="text-gray-700">نسجد على سبعة أعضاء (الجبهة والأنف، الكفين، الركبتين، أطراف القدمين) ونقول: "سبحان ربي الأعلى" ثلاث مرات.</p>
                </div>
                <div class="bg-teal-100 p-6 rounded-xl shadow-md border-2 border-teal-300">
                    <img src="https://placehold.co/100x100/AFEEEE/000000?text=التشهد" alt="التشهد" class="mx-auto mb-4 rounded-full">
                    <h3 class="text-xl font-semibold text-teal-800 mb-2">6. الجلوس والتشهد والتسليم</h3>
                    <p class="text-gray-700">نجلس بين السجدتين، ثم نكرر الركعة الثانية، وفي الركعة الأخيرة نجلس للتشهد ونسلم يمينًا ويسارًا.</p>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quiz" class="section">
            <h2 class="text-3xl">اختبر فهمك: هل أنت بطل الصلاة؟</h2>
            <p class="quiz-question-text">الآن بعد أن استمعنا لقصة صالح الممتعة وتعرفنا على خطوات الصلاة، حان وقت اختبار معلوماتك! أجب عن الأسئلة التالية لتثبت أنك أصبحت بطلًا في تعلم الصلاة:</p>
            <div id="quiz-question-container" class="mt-6">
                <!-- Quiz question will be loaded here by JS -->
            </div>
            <div class="quiz-feedback" id="quiz-feedback"></div>
            <button id="next-question-btn" class="mt-6 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-full font-bold shadow-lg transition-all" onclick="nextQuestion()">السؤال التالي</button>
            <button id="restart-quiz-btn" class="mt-6 bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-full font-bold shadow-lg transition-all hidden" onclick="resetQuiz()">إعادة الاختبار</button>
        </div>

        <!-- Games Section -->
        <div id="games" class="section">
            <h2 class="text-3xl">ألعاب تفاعلية: لنثبت ما تعلمناه!</h2>
            <p class="story-text">بعد أن اختبرت معلوماتك بنجاح، حان وقت المرح! هيا بنا نلعب لعبة "الصلاة الصحيحة" التي تساعدنا على تثبيت معلوماتنا عن خطوات الصلاة:</p>

            <div class="game-area">
                <h3 class="text-2xl font-bold text-orange-700 mb-4">لعبة "الصلاة الصحيحة": رتب الخطوات!</h3>
                <p class="text-gray-600 mb-6">اضغط على صور خطوات الصلاة بالترتيب الصحيح.</p>
                <div id="game-items-container" class="flex flex-wrap justify-center gap-4 mb-6">
                    <!-- Game items will be loaded here by JS -->
                </div>
                <div class="game-selected-order" id="game-selected-order">
                    <p class="text-gray-500">الترتيب الذي اخترته سيظهر هنا...</p>
                </div>
                <div class="game-feedback mt-4 text-lg font-semibold" id="game-feedback"></div>
                <div class="game-buttons mt-6">
                    <button onclick="checkGameOrder()">تحقق من الترتيب</button>
                    <button onclick="resetGame()">إعادة اللعب</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal/Popup for alerts -->
    <div id="custom-popup-overlay" class="popup-overlay">
        <div class="popup-content">
            <h3 id="popup-title"></h3>
            <p id="popup-message"></p>
            <button onclick="closePopup()">حسناً</button>
        </div>
    </div>

    <script>
        // Function to show custom popup
        function showPopup(title, message) {
            document.getElementById('popup-title').innerText = title;
            document.getElementById('popup-message').innerText = message;
            document.getElementById('custom-popup-overlay').classList.add('show');
        }

        // Function to close custom popup
        function closePopup() {
            document.getElementById('custom-popup-overlay').classList.remove('show');
        }

        // --- Section Management ---
        let currentSection = 'intro';

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            // Show the requested section
            document.getElementById(sectionId).classList.add('active');
            currentSection = sectionId;

            // Specific actions for sections
            if (sectionId === 'quiz') {
                resetQuiz(); // Ensure quiz is reset when navigated to
            } else if (sectionId === 'games') {
                resetGame(); // Ensure game is reset when navigated to
            }
        }

        // --- Quiz Logic ---
        const quizQuestions = [
            {
                question: "كم عدد الصلوات المفروضة في اليوم؟",
                options: ["ثلاث", "أربع", "خمس"],
                answer: "خمس"
            },
            {
                question: "ماذا نقول في الركوع؟",
                options: ["سبحان ربي الأعلى", "سبحان ربي العظيم", "الحمد لله"],
                answer: "سبحان ربي العظيم"
            },
            {
                question: "ما هي أول خطوة قبل البدء بالصلاة؟",
                options: ["قراءة القرآن", "الوضوء", "الأكل"],
                answer: "الوضوء"
            },
            {
                question: "ما هي آخر خطوة في الصلاة؟",
                options: ["السجود", "الركوع", "التسليم"],
                answer: "التسليم"
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;

        function displayQuestion() {
            const container = document.getElementById('quiz-question-container');
            const feedback = document.getElementById('quiz-feedback');
            const nextBtn = document.getElementById('next-question-btn');
            const restartBtn = document.getElementById('restart-quiz-btn');

            feedback.innerText = ''; // Clear previous feedback
            nextBtn.innerText = 'تحقق من الإجابة'; // Change button text

            if (currentQuestionIndex < quizQuestions.length) {
                const q = quizQuestions[currentQuestionIndex];
                let html = `<p class="text-xl font-bold mb-4">${currentQuestionIndex + 1}. ${q.question}</p>`;
                html += `<div class="quiz-options text-right">`;
                q.options.forEach((option, index) => {
                    html += `
                        <div>
                            <input type="radio" id="option${index}" name="quiz-option" value="${option}" class="hidden">
                            <label for="option${index}">${option}</label>
                        </div>
                    `;
                });
                html += `</div>`;
                container.innerHTML = html;
                nextBtn.classList.remove('hidden');
                restartBtn.classList.add('hidden');
            } else {
                // Quiz finished
                container.innerHTML = `<p class="text-2xl font-bold text-green-700">لقد أكملت الاختبار!</p><p class="text-xl mt-2">نقاطك: ${score} من ${quizQuestions.length}</p>`;
                if (score === quizQuestions.length) {
                    feedback.innerHTML = `<p class="correct text-2xl mt-4">أحسنت! أنت بطل الصلاة!</p>`;
                } else {
                    feedback.innerHTML = `<p class="incorrect text-2xl mt-4">حاول مرة أخرى لتصبح بطلًا!</p>`;
                }
                nextBtn.classList.add('hidden');
                restartBtn.classList.remove('hidden');
            }
        }

        function nextQuestion() {
            const selectedOption = document.querySelector('input[name="quiz-option"]:checked');
            const feedback = document.getElementById('quiz-feedback');
            const nextBtn = document.getElementById('next-question-btn');

            if (!selectedOption && currentQuestionIndex < quizQuestions.length) {
                showPopup("تنبيه", "الرجاء اختيار إجابة قبل المتابعة.");
                return;
            }

            if (nextBtn.innerText === 'تحقق من الإجابة') {
                // Check answer phase
                const correctAnswer = quizQuestions[currentQuestionIndex].answer;
                if (selectedOption.value === correctAnswer) {
                    feedback.innerHTML = `<p class="correct"><i class="fas fa-check-circle"></i> إجابة صحيحة! أحسنت.</p>`;
                    score++;
                } else {
                    feedback.innerHTML = `<p class="incorrect"><i class="fas fa-times-circle"></i> إجابة خاطئة. الإجابة الصحيحة هي: ${correctAnswer}.</p>`;
                }
                nextBtn.innerText = 'السؤال التالي'; // Change button text for next question
            } else {
                // Move to next question phase
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            displayQuestion();
            document.getElementById('restart-quiz-btn').classList.add('hidden');
            document.getElementById('next-question-btn').classList.remove('hidden');
            document.getElementById('next-question-btn').innerText = 'تحقق من الإجابة';
        }

        // --- Game Logic: "الصلاة الصحيحة" (Click to Order) ---
        const prayerStepsGameData = [
            { id: 'step1', name: 'النية وتكبيرة الإحرام', img: 'https://placehold.co/100x100/ADD8E6/000000?text=النية' },
            { id: 'step2', name: 'الركوع', img: 'https://placehold.co/100x100/FFD700/000000?text=الركوع' },
            { id: 'step3', name: 'الرفع من الركوع', img: 'https://placehold.co/100x100/E6E6FA/000000?text=الرفع' },
            { id: 'step4', name: 'السجود', img: 'https://placehold.co/100x100/FFA07A/000000?text=السجود' },
            { id: 'step5', name: 'الجلوس بين السجدتين', img: 'https://placehold.co/100x100/90EE90/000000?text=الجلوس' },
            { id: 'step6', name: 'التسليم', img: 'https://placehold.co/100x100/AFEEEE/000000?text=التسليم' }
        ];

        let selectedGameOrder = []; // Stores IDs of selected steps in order
        let gameCorrectOrder = ['step1', 'step2', 'step3', 'step4', 'step5', 'step6']; // The correct sequence

        function initializeGame() {
            const gameItemsContainer = document.getElementById('game-items-container');
            gameItemsContainer.innerHTML = '';
            // Shuffle the steps for the game display
            const shuffledSteps = [...prayerStepsGameData].sort(() => Math.random() - 0.5);

            shuffledSteps.forEach(step => {
                const itemDiv = document.createElement('div');
                itemDiv.id = `game-${step.id}`;
                itemDiv.classList.add('prayer-steps-game-item');
                itemDiv.innerHTML = `<img src="${step.img}" alt="${step.name}"><span>${step.name}</span>`;
                itemDiv.onclick = () => selectGameStep(step.id, step.name, itemDiv);
                gameItemsContainer.appendChild(itemDiv);
            });
            updateSelectedOrderDisplay();
        }

        function selectGameStep(id, name, element) {
            if (selectedGameOrder.includes(id)) {
                // If already selected, remove it (toggle)
                selectedGameOrder = selectedGameOrder.filter(item => item !== id);
                element.classList.remove('selected');
            } else {
                // Add to selected order
                selectedGameOrder.push(id);
                element.classList.add('selected');
            }
            updateSelectedOrderDisplay();
        }

        function updateSelectedOrderDisplay() {
            const displayArea = document.getElementById('game-selected-order');
            if (selectedGameOrder.length === 0) {
                displayArea.innerHTML = '<p class="text-gray-500">الترتيب الذي اخترته سيظهر هنا...</p>';
                return;
            }
            displayArea.innerHTML = selectedGameOrder.map(id => {
                const step = prayerStepsGameData.find(d => d.id === id);
                return `<span>${step ? step.name : ''}</span>`;
            }).join('');
        }

        function checkGameOrder() {
            const feedback = document.getElementById('game-feedback');
            if (selectedGameOrder.length !== gameCorrectOrder.length) {
                feedback.innerHTML = `<p class="incorrect"><i class="fas fa-times-circle"></i> الترتيب غير مكتمل أو به خطوات زائدة. حاول مرة أخرى!</p>`;
                return;
            }

            let isCorrect = true;
            for (let i = 0; i < gameCorrectOrder.length; i++) {
                if (selectedGameOrder[i] !== gameCorrectOrder[i]) {
                    isCorrect = false;
                    break;
                }
            }

            if (isCorrect) {
                feedback.innerHTML = `<p class="correct"><i class="fas fa-check-circle"></i> أحسنت! هذا هو الترتيب الصحيح للصلاة. أنت بطل!</p>`;
                showPopup("تهانينا!", "لقد رتبت خطوات الصلاة بشكل صحيح! أنت رائع!");
            } else {
                feedback.innerHTML = `<p class="incorrect"><i class="fas fa-times-circle"></i> هذا ليس الترتيب الصحيح. حاول مرة أخرى!</p>`;
                showPopup("حاول مرة أخرى", "الترتيب الذي اخترته غير صحيح. تذكر خطوات الصلاة جيداً!");
            }
        }

        function resetGame() {
            selectedGameOrder = [];
            document.querySelectorAll('.prayer-steps-game-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('game-feedback').innerHTML = '';
            initializeGame(); // Re-initialize to shuffle items again
        }

        // Initialize the quiz and game when the page loads
        window.onload = function() {
            showSection('intro'); // Start with the introduction section
            displayQuestion(); // Initialize the first quiz question
            initializeGame(); // Initialize the game
        };
    </script>
</body>
</html>
