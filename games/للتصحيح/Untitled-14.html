<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة الذاكرة الإسلامية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00BCD4; /* أزرق سماوي */
            --secondary-color: #80DEEA; /* أزرق سماوي فاتح */
            --accent-color: #FFC107; /* أصفر ذهبي */
            --background-light: #E0F7FA; /* أزرق فاتح جداً */
            --text-color: #37474F; /* رمادي أزرق غامق */
            --card-bg: #FFFFFF;
            --card-front-bg: #E0F2F7; /* لون فاتح لوجه البطاقة */
            --card-back-bg: #00796B; /* لون خلفية البطاقة */
            --modal-bg: rgba(255, 255, 255, 0.95);
            --correct-answer-color: #4CAF50; /* أخضر */
            --wrong-answer-color: #F44336; /* أحمر */
            --shadow-color: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--background-light) 0%, #B2EBF2 100%); /* تدرج أزرق */
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Prevent scrollbar from animated elements */
            position: relative;
        }

        .container {
            width: 95%;
            max-width: 1000px;
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 15px 40px var(--shadow-color);
            text-align: center;
            animation: fadeInScale 1s ease-out;
            position: relative;
            z-index: 2; /* Above background elements */
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Animated Background Elements */
        .animated-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0; /* Ensures it stays behind content */
        }

        .bg-shape {
            position: absolute;
            background: rgba(0, 188, 212, 0.1); /* Transparent primary color */
            border-radius: 50%;
            animation: floatAndFade 25s infinite linear;
            filter: blur(10px);
        }

        .bg-shape:nth-child(1) { width: 120px; height: 120px; top: 10%; left: -5%; animation-duration: 22s; }
        .bg-shape:nth-child(2) { width: 90px; height: 90px; top: 70%; left: 10%; animation-duration: 18s; transform: rotate(30deg); }
        .bg-shape:nth-child(3) { width: 150px; height: 150px; top: 20%; right: -5%; animation-duration: 25s; transform: rotate(-45deg); }
        .bg-shape:nth-child(4) { width: 110px; height: 110px; top: 85%; right: 15%; animation-duration: 20s; }
        .bg-shape:nth-child(5) { width: 100px; height: 100px; top: 5%; left: 40%; animation-duration: 23s; }
        .bg-shape:nth-child(6) { width: 70px; height: 70px; top: 50%; left: -3%; animation-duration: 28s; }
        .bg-shape:nth-child(7) { width: 130px; height: 130px; top: 30%; right: -8%; animation-duration: 26s; }

        @keyframes floatAndFade {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-70px) translateX(30px) rotate(180deg); opacity: 0.5; }
            100% { transform: translateY(0) translateX(0) rotate(360deg); opacity: 0.3; }
        }

        /* Header */
        h1 {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.1);
            animation: bounceInDown 1s ease-out;
        }

        .game-description-text {
            font-size: 1.8rem;
            color: #546E7A;
            margin-bottom: 40px;
            line-height: 1.7;
            animation: fadeIn 1.2s ease-out;
        }

        /* Game Info Bar (Moves & Time) */
        .game-info {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: var(--text-color);
            font-weight: bold;
            animation: fadeIn 1.5s ease-out;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--card-front-bg);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .info-item i {
            color: var(--primary-color);
            font-size: 2.2rem;
        }

        /* Memory Grid */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 columns for 16 cards */
            gap: 15px;
            width: 100%;
            max-width: 800px; /* Adjust as needed for grid size */
            margin: 0 auto 30px auto;
            perspective: 1000px; /* For 3D flip effect */
            min-height: 400px; /* To prevent collapse before cards load */
            display: none; /* Hidden by default until game starts */
        }

        /* Card styles */
        .memory-card {
            width: 100%;
            padding-bottom: 100%; /* Makes cards square based on width */
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d; /* For 3D flip */
            transition: transform 0.5s ease;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Ensure card is responsive within its grid cell */
        .memory-card-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.5s ease;
            transform-style: preserve-3d;
            border-radius: 15px;
        }

        .memory-card.flipped .memory-card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Hide back face when flipped */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            font-size: 4rem; /* Icon size */
            color: var(--primary-color);
            font-weight: 800;
        }

        .card-back {
            background-color: var(--card-back-bg);
            color: white;
            transform: rotateY(0deg); /* Default state */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Tajawal" font-size="40" fill="%23FFFFFF">?</text></svg>'); /* Simple question mark */
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
        }

        .card-front {
            background-color: var(--card-front-bg);
            transform: rotateY(180deg); /* Flipped state */
        }
        .card-front i {
            font-size: 4rem; /* Icon size for Font Awesome */
            color: var(--text-color);
        }
        /* Optional: for text content on cards */
        .card-front span {
            font-size: 2.5rem;
            color: var(--text-color);
        }

        .memory-card.matched .memory-card-inner {
            box-shadow: 0 0 20px 5px var(--correct-answer-color); /* Glow effect */
            animation: pulse 1s infinite alternate; /* Gentle pulse */
        }
        .memory-card.matched {
            pointer-events: none; /* Disable clicks on matched cards */
            opacity: 0.7; /* Slightly dim matched cards */
        }

        @keyframes pulse {
            from { box-shadow: 0 0 15px 3px var(--correct-answer-color); }
            to { box-shadow: 0 0 25px 7px var(--correct-answer-color); }
        }

        /* Buttons */
        .game-button {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-decoration: none; /* For anchor tags */
            display: inline-flex; /* Use inline-flex for button and icon alignment */
            align-items: center;
            gap: 8px;
            margin-top: 20px; /* Add margin for consistency */
        }

        .game-button:hover {
            background-color: #00838F; /* أغمق قليلاً */
            transform: translateY(-3px);
        }

        .hidden {
            display: none !important; /* Use !important to ensure override */
        }

        /* Top Home Button */
        .top-home-button {
            position: absolute;
            top: 25px;
            right: 25px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            padding: 10px 18px;
            border-radius: 15px;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .top-home-button:hover {
            background-color: #4DD0E1;
            transform: translateY(-3px);
        }

        .top-home-button i {
            font-size: 1.5rem;
            color: var(--text-color);
        }

        /* Music Toggle Button */
        .music-toggle-button {
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            z-index: 100; 
            background: var(--accent-color); 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 50px; 
            height: 50px; 
            font-size: 1.8rem; 
            cursor: pointer; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .music-toggle-button:hover {
            background-color: #F57C00;
            transform: translateY(-3px);
        }

        /* End Screen */
        .end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            text-align: center;
            color: white;
            animation: fadeIn 0.5s ease-out;
        }

        .end-screen h2 {
            font-size: 4.5rem;
            color: var(--accent-color);
            margin-bottom: 25px;
            animation: rubberBand 1s;
        }

        .end-screen p {
            font-size: 2.2rem;
            margin-bottom: 40px;
        }
        
        .end-screen .game-button {
            background-color: var(--accent-color);
            color: var(--text-color); /* Darker text for yellow button */
            font-weight: bold;
        }
        .end-screen .game-button:hover {
            background-color: #FFB300;
        }

        .navigation-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 3rem; margin-bottom: 10px; }
            .game-description-text { font-size: 1.4rem; margin-bottom: 30px; }
            .container { padding: 25px; border-radius: 20px; }
            .game-info { font-size: 1.4rem; gap: 30px; }
            .info-item i { font-size: 1.8rem; }
            .memory-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns for smaller screens */
                max-width: 500px;
            }
            .card-face { font-size: 3rem; }
            .card-front i { font-size: 3rem; }
            .card-front span { font-size: 2rem; }
            .game-button { padding: 12px 25px; font-size: 1.4rem; }
            .end-screen h2 { font-size: 3.5rem; }
            .end-screen p { font-size: 1.8rem; }
            .top-home-button { top: 15px; right: 15px; padding: 8px 15px; font-size: 1rem; }
            .top-home-button i { font-size: 1.2rem; }
            .music-toggle-button { width: 45px; height: 45px; font-size: 1.6rem; bottom: 15px; left: 15px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 2.5rem; }
            .game-description-text { font-size: 1.2rem; }
            .game-info { font-size: 1.2rem; gap: 20px; }
            .info-item { padding: 8px 15px; }
            .info-item i { font-size: 1.5rem; }
            .memory-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 columns for very small screens */
                max-width: 300px;
                gap: 10px;
            }
            .card-face { font-size: 2.5rem; }
            .card-front i { font-size: 2.5rem; }
            .card-front span { font-size: 1.5rem; }
            .game-button { padding: 10px 20px; font-size: 1.2rem; }
            .end-screen h2 { font-size: 2.8rem; }
            .end-screen p { font-size: 1.4rem; }
            .music-toggle-button { width: 40px; height: 40px; font-size: 1.4rem; bottom: 10px; left: 10px; }
        }
    </style>
</head>
<body>
    <div class="animated-bg">
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
    </div>

    <a href="games_page.html" class="top-home-button animate__animated animate__bounceInRight">
        <i class="fas fa-home"></i>
        <span>العودة للألعاب</span>
    </a>

    <div class="container">
        <h1 class="animate__animated animate__flipInX">لعبة الذاكرة الإسلامية!</h1>
        <p class="game-description-text animate__animated animate__fadeIn">
            اكتشف الأزواج المتطابقة من المفاهيم الإسلامية. اختبر ذاكرتك!
        </p>

        <div class="game-info">
            <div class="info-item">
                <i class="fas fa-redo-alt"></i>
                <span id="movesCount">0</span> محاولة
            </div>
            <div class="info-item">
                <i class="fas fa-hourglass-half"></i>
                <span id="timer">00:00</span>
            </div>
        </div>

        <div class="memory-grid" id="memoryGrid">
            </div>

        <button class="game-button animate__animated animate__pulse animate__infinite" id="startGameButton">
            <i class="fas fa-play"></i> ابدأ اللعبة
        </button>
    </div>

    <div id="endScreen" class="end-screen hidden">
        <h2 class="animate__animated animate__tada">تهانينا! لقد ربحت!</h2>
        <p class="animate__animated animate__fadeIn">لقد أكملت اللعبة في <span id="finalTime">00:00</span> و <span id="finalMoves">0</span> محاولة.</p>
        <div class="navigation-buttons">
            <button class="game-button" id="restartGameButton"><i class="fas fa-redo"></i> العب مرة أخرى</button>
            <a href="games_page.html" class="game-button"><i class="fas fa-gamepad"></i> العودة لقائمة الألعاب</a>
        </div>
    </div>

    <audio id="cardFlipSound" src="sounds/card_flip.mp3" preload="auto"></audio>
    <audio id="matchSound" src="sounds/match_sound.mp3" preload="auto"></audio>
    <audio id="noMatchSound" src="sounds/no_match_sound.mp3" preload="auto"></audio>
    <audio id="winSound" src="sounds/win_sound.mp3" preload="auto"></audio>
    <audio id="backgroundMusic" src="sounds/background_music.mp3" loop preload="auto"></audio>
    
    <button id="musicToggleButton" class="music-toggle-button">
        <i class="fas fa-music"></i>
    </button>

    <script>
        const memoryGrid = document.getElementById('memoryGrid');
        const movesCountSpan = document.getElementById('movesCount');
        const timerSpan = document.getElementById('timer');
        const startGameButton = document.getElementById('startGameButton');
        const endScreen = document.getElementById('endScreen');
        const finalTimeSpan = document.getElementById('finalTime');
        const finalMovesSpan = document.getElementById('finalMoves');
        const restartGameButton = document.getElementById('restartGameButton');

        // Audio elements
        const cardFlipSound = document.getElementById('cardFlipSound');
        const matchSound = document.getElementById('matchSound');
        const noMatchSound = document.getElementById('noMatchSound');
        const winSound = document.getElementById('winSound');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicToggleButton = document.getElementById('musicToggleButton');
        let isMusicPlaying = false;

        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timer = 0;
        let timerInterval;
        let lockBoard = false; // To prevent clicking more than 2 cards

        // Game content (icons from Font Awesome)
        // You can customize these with more relevant Islamic concepts or text
        const gameIcons = [
            'fa-mosque', // مسجد
            'fa-kaaba',  // كعبة
            'fa-moon',   // هلال
            'fa-star-and-crescent', // نجمة وهلال
            'fa-quran',  // قرآن
            'fa-prayer-hand', // دعاء (أو يدين تدعوان)
            'fa-hands-praying', // أيدي تدعو
            'fa-book-open' // كتاب مفتوح (للعلم أو الحديث)
        ];

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to play sound safely
        function playSound(audioElement) {
            audioElement.currentTime = 0; // Reset to start
            audioElement.play().catch(e => console.error("Error playing sound:", e));
        }

        function createBoard() {
            // Duplicate icons to create pairs
            const cardContent = shuffle([...gameIcons, ...gameIcons]);
            memoryGrid.innerHTML = ''; // Clear previous cards
            cards = []; // Clear previous card elements

            cardContent.forEach((iconClass, index) => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.icon = iconClass; // Store the icon to identify pairs

                // Inner card container for flip effect
                const inner = document.createElement('div');
                inner.classList.add('memory-card-inner');

                const frontFace = document.createElement('div');
                frontFace.classList.add('card-face', 'card-front');
                frontFace.innerHTML = `<i class="fas ${iconClass}"></i>`;

                const backFace = document.createElement('div');
                backFace.classList.add('card-face', 'card-back');

                inner.appendChild(frontFace);
                inner.appendChild(backFace);
                card.appendChild(inner);

                card.addEventListener('click', () => flipCard(card));
                memoryGrid.appendChild(card);
                cards.push(card);
            });
        }

        function flipCard(card) {
            if (lockBoard) return; // Prevent flipping more cards when 2 are already flipped
            if (card === flippedCards[0]) return; // Prevent double clicking the same card

            playSound(cardFlipSound);
            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                moves++;
                movesCountSpan.textContent = moves;
                lockBoard = true; // Lock board while checking
                checkForMatch();
            }
        }

        function checkForMatch() {
            const [firstCard, secondCard] = flippedCards;
            const isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            playSound(matchSound);
            flippedCards[0].classList.add('matched');
            flippedCards[1].classList.add('matched');
            matchedPairs++;
            resetBoard();
            checkWin();
        }

        function unflipCards() {
            playSound(noMatchSound);
            setTimeout(() => {
                flippedCards[0].classList.remove('flipped');
                flippedCards[1].classList.remove('flipped');
                resetBoard();
            }, 1000); // Wait for 1 second before flipping back
        }

        function resetBoard() {
            [flippedCards, lockBoard] = [[], false];
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timer++;
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                timerSpan.textContent = `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function checkWin() {
            if (matchedPairs === gameIcons.length) {
                stopTimer();
                playSound(winSound);
                finalTimeSpan.textContent = timerSpan.textContent;
                finalMovesSpan.textContent = movesCountSpan.textContent;
                endScreen.classList.remove('hidden');
                // Hide game elements to show end screen clearly
                memoryGrid.classList.add('hidden');
                startGameButton.classList.add('hidden');
                document.querySelector('.game-info').classList.add('hidden');
            }
        }

        function resetGame() {
            stopTimer();
            moves = 0;
            timer = 0;
            matchedPairs = 0;
            movesCountSpan.textContent = '0';
            timerSpan.textContent = '00:00';
            endScreen.classList.add('hidden');
            memoryGrid.classList.add('hidden'); // Ensure it's hidden before new game
            document.querySelector('.game-info').classList.remove('hidden'); // Show game info again
            startGameButton.classList.remove('hidden'); // Show start button
        }

        function startGame() {
            moves = 0;
            timer = 0;
            matchedPairs = 0;
            movesCountSpan.textContent = '0';
            timerSpan.textContent = '00:00';
            flippedCards = [];
            lockBoard = false;

            memoryGrid.classList.remove('hidden'); // Show the grid
            startGameButton.classList.add('hidden'); // Hide the start button
            
            createBoard(); // Create and shuffle cards
            startTimer(); // Start the timer

            // Attempt to play background music on game start (requires user interaction)
            if (!isMusicPlaying) {
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggleButton.innerHTML = '<i class="fas fa-music"></i>';
                }).catch(e => {
                    console.warn("Background music autoplay blocked. User interaction needed:", e);
                    musicToggleButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
                });
            }
        }

        function toggleBackgroundMusic() {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicToggleButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else {
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggleButton.innerHTML = '<i class="fas fa-music"></i>';
                }).catch(e => {
                    console.error("Background music play failed:", e);
                    musicToggleButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    isMusicPlaying = false;
                });
            }
        }

        // Event Listeners
        startGameButton.addEventListener('click', startGame);
        restartGameButton.addEventListener('click', resetGame);
        musicToggleButton.addEventListener('click', toggleBackgroundMusic);

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            // The grid starts hidden, shown only when game starts.
            // No need to call createBoard() initially as startGame() will handle it.
            resetGame(); // Ensure initial state is ready for starting
        });

    </script>
</body>
</html>